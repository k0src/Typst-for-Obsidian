/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var y=Object.defineProperty;var I=Object.getOwnPropertyDescriptor;var N=Object.getOwnPropertyNames;var F=Object.prototype.hasOwnProperty;var D=(c,o)=>{for(var e in o)y(c,e,{get:o[e],enumerable:!0})},H=(c,o,e,r)=>{if(o&&typeof o=="object"||typeof o=="function")for(let a of N(o))!F.call(c,a)&&a!==e&&y(c,a,{get:()=>o[a],enumerable:!(r=I(o,a))||r.enumerable});return c};var P=c=>H(y({},"__esModule",{value:!0}),c);var J={};D(J,{default:()=>b});module.exports=P(J);var i=require("obsidian");var n=require("@codemirror/view"),k=require("@codemirror/state");var V=require("@codemirror/view"),p=require("@codemirror/language"),t=require("@lezer/highlight"),A="#e5c07b",x="#e06c75",z="#56b6c2",q="#ffffff",m="#abb2bf",C="#7d8799",K="#61afef",O="#98c379",M="#d19a66",W="#c678dd",G="#21252b",L="#2c313a",T="#282c34",v="#353a42",R="#3E4451",S="#528bff";var $=V.EditorView.theme({"&":{color:m,backgroundColor:T},".cm-content":{caretColor:S},".cm-cursor, .cm-dropCursor":{borderLeftColor:S},"&.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground, .cm-selectionBackground, .cm-content ::selection":{backgroundColor:R},".cm-panels":{backgroundColor:G,color:m},".cm-panels.cm-panels-top":{borderBottom:"2px solid black"},".cm-panels.cm-panels-bottom":{borderTop:"2px solid black"},".cm-searchMatch":{backgroundColor:"#72a1ff59",outline:"1px solid #457dff"},".cm-searchMatch.cm-searchMatch-selected":{backgroundColor:"#6199ff2f"},".cm-activeLine":{backgroundColor:"#6699ff0b"},".cm-selectionMatch":{backgroundColor:"#aafe661a"},"&.cm-focused .cm-matchingBracket, &.cm-focused .cm-nonmatchingBracket":{backgroundColor:"#bad0f847"},".cm-gutters":{backgroundColor:T,color:C,border:"none"},".cm-activeLineGutter":{backgroundColor:L},".cm-foldPlaceholder":{backgroundColor:"transparent",border:"none",color:"#ddd"},".cm-tooltip":{border:"none",backgroundColor:v},".cm-tooltip .cm-tooltip-arrow:before":{borderTopColor:"transparent",borderBottomColor:"transparent"},".cm-tooltip .cm-tooltip-arrow:after":{borderTopColor:v,borderBottomColor:v},".cm-tooltip-autocomplete":{"& > ul > li[aria-selected]":{backgroundColor:L,color:m}}},{dark:!0}),j=p.HighlightStyle.define([{tag:t.tags.keyword,color:W},{tag:[t.tags.name,t.tags.deleted,t.tags.character,t.tags.propertyName,t.tags.macroName],color:x},{tag:[t.tags.function(t.tags.variableName),t.tags.labelName],color:K},{tag:[t.tags.color,t.tags.constant(t.tags.name),t.tags.standard(t.tags.name)],color:M},{tag:[t.tags.definition(t.tags.name),t.tags.separator],color:m},{tag:[t.tags.typeName,t.tags.className,t.tags.number,t.tags.changed,t.tags.annotation,t.tags.modifier,t.tags.self,t.tags.namespace],color:A},{tag:[t.tags.operator,t.tags.operatorKeyword,t.tags.url,t.tags.escape,t.tags.regexp,t.tags.link,t.tags.special(t.tags.string)],color:z},{tag:[t.tags.meta,t.tags.comment],color:C},{tag:t.tags.strong,fontWeight:"bold"},{tag:t.tags.emphasis,fontStyle:"italic"},{tag:t.tags.strikethrough,textDecoration:"line-through"},{tag:t.tags.link,color:C,textDecoration:"underline"},{tag:t.tags.heading,fontWeight:"bold",color:x},{tag:[t.tags.atom,t.tags.bool,t.tags.special(t.tags.variableName)],color:M},{tag:[t.tags.processingInstruction,t.tags.string,t.tags.inserted],color:O},{tag:t.tags.invalid,color:q}]),B=[$,(0,p.syntaxHighlighting)(j)];var s=require("@codemirror/commands"),g=require("@codemirror/language"),f=require("@codemirror/search"),u=class{constructor(o,e,r){this.editorView=null;this.content="";this.container=o,this.app=e,this.onContentChange=r}initialize(o=""){this.content=o,this.createEditor()}createEditor(){this.container.empty();let o=this.container.createDiv("typst-editor-container"),e=document.body.classList.contains("theme-dark"),r=[(0,n.lineNumbers)(),(0,g.foldGutter)(),(0,n.drawSelection)(),(0,n.dropCursor)(),(0,n.rectangularSelection)(),(0,n.highlightActiveLine)(),(0,s.history)(),(0,g.bracketMatching)(),(0,f.highlightSelectionMatches)(),k.EditorState.allowMultipleSelections.of(!0),n.keymap.of([s.indentWithTab,...s.defaultKeymap,...f.searchKeymap]),...e?[B]:[],n.EditorView.theme({"&":{fontSize:"var(--font-text-size)",fontFamily:"var(--font-monospace-theme)",height:"100%"},".cm-content":{padding:"var(--file-margins)",lineHeight:"var(--line-height-normal)",caretColor:"var(--text-accent)",minHeight:"100%"},".cm-editor":{height:"100%",backgroundColor:"transparent"},".cm-editor.cm-focused":{outline:"none"},".cm-line":{padding:"0"},".cm-gutters":{backgroundColor:"transparent",color:"var(--text-faint)",border:"none",paddingLeft:"var(--file-margins)"},".cm-lineNumbers .cm-gutterElement":{color:"var(--text-faint)",fontSize:"var(--font-ui-smaller)"},".cm-activeLineGutter":{backgroundColor:"transparent"},".cm-activeLine":{backgroundColor:"var(--background-primary-alt)"},".cm-cursor":{borderLeftColor:"var(--text-accent)"},".cm-selectionBackground":{backgroundColor:"var(--text-selection) !important"},"&.cm-focused .cm-selectionBackground":{backgroundColor:"var(--text-selection) !important"},".cm-searchMatch":{backgroundColor:"var(--text-highlight-bg)",outline:"1px solid var(--text-accent)"},".cm-searchMatch.cm-searchMatch-selected":{backgroundColor:"var(--text-accent)",color:"var(--text-on-accent)"}},{dark:e}),n.EditorView.updateListener.of(l=>{l.docChanged&&(this.content=l.state.doc.toString(),this.onContentChange&&this.onContentChange(this.content))})],a=k.EditorState.create({doc:this.content,extensions:r});this.editorView=new n.EditorView({state:a,parent:o})}getContent(){return this.editorView?this.editorView.state.doc.toString():this.content}setContent(o){if(this.editorView){let e=this.editorView.state.update({changes:{from:0,to:this.editorView.state.doc.length,insert:o}});this.editorView.dispatch(e)}this.content=o}focus(){var o;(o=this.editorView)==null||o.focus()}destroy(){this.editorView&&(this.editorView.destroy(),this.editorView=null)}};var b=class extends i.Plugin{async onload(){this.registerExtensions(["typ"],"typst-view"),this.registerView("typst-view",o=>new w(o)),this.addCommand({id:"create-typst-file",name:"Create new Typst file",callback:()=>{new E(this.app,this).open()}})}onunload(){}},w=class extends i.TextFileView{constructor(){super(...arguments);this.currentMode="source";this.modeIconContainer=null;this.typstEditor=null;this.fileContent=""}getViewType(){return"typst-view"}getDisplayText(){var e;return((e=this.file)==null?void 0:e.basename)||"Typst File"}async onOpen(){await super.onOpen(),this.addModeIcon()}onClose(){return this.typstEditor&&(this.typstEditor.destroy(),this.typstEditor=null),super.onClose()}addModeIcon(){let e=this.containerEl.querySelector(".view-actions");e&&(this.modeIconContainer=e.createDiv("clickable-icon view-action"),this.modeIconContainer.setAttribute("aria-label","Toggle between source and reading mode"),e.insertBefore(this.modeIconContainer,e.firstChild),this.updateModeIcon(),this.modeIconContainer.addEventListener("click",()=>{this.toggleMode()}))}toggleMode(){this.currentMode==="source"&&this.typstEditor&&(this.fileContent=this.typstEditor.getContent()),this.currentMode=this.currentMode==="source"?"reading":"source",this.updateModeIcon(),this.currentMode==="source"?this.showSourceMode():this.showReadingMode(),console.log(`Switched to ${this.currentMode} mode`)}updateModeIcon(){this.modeIconContainer&&(this.modeIconContainer.empty(),this.currentMode==="source"?((0,i.setIcon)(this.modeIconContainer,"pencil-line"),this.modeIconContainer.setAttribute("aria-label","Currently in source mode. Click to switch to reading mode.")):((0,i.setIcon)(this.modeIconContainer,"book-open"),this.modeIconContainer.setAttribute("aria-label","Currently in reading mode. Click to switch to source mode.")))}async setViewData(e,r){this.fileContent=e,this.currentMode==="source"?this.showSourceMode():this.showReadingMode()}getViewData(){return this.currentMode==="source"&&this.typstEditor?this.typstEditor.getContent():this.fileContent}showSourceMode(){let e=this.containerEl.querySelector(".view-content");e&&(e.empty(),this.typstEditor&&(this.typstEditor.destroy(),this.typstEditor=null),this.typstEditor=new u(e,this.app,r=>{this.fileContent=r,this.requestSave()}),this.typstEditor.initialize(this.fileContent))}showReadingMode(){let e=this.containerEl.querySelector(".view-content");if(e){e.empty();let r=e.createEl("pre",{text:this.fileContent,cls:"typst-reading-mode"})}}clear(){this.fileContent="",this.typstEditor&&(this.typstEditor.destroy(),this.typstEditor=null)}},E=class extends i.Modal{constructor(e,r){super(e);this.fileName="";this.plugin=r}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"New Typst file"}),new i.Setting(e).setName("File name").setDesc("Enter the name of the Typst file (without .typ extension)").addText(d=>{d.setPlaceholder("note").setValue(this.fileName).onChange(h=>{this.fileName=h}),d.inputEl.focus(),d.inputEl.select(),d.inputEl.addEventListener("keydown",h=>{h.key==="Enter"&&this.createFile()})});let r=e.createDiv("modal-button-container");r.createEl("button",{text:"Cancel"}).addEventListener("click",()=>{this.close()}),r.createEl("button",{text:"Create",cls:"mod-cta"}).addEventListener("click",()=>{this.createFile()})}async createFile(){if(!this.fileName.trim()){new i.Notice("Please enter a file name");return}try{let e=this.fileName.trim(),r=(0,i.normalizePath)(`${e}.typ`),a=this.app.vault.getAbstractFileByPath(r);if(a&&a instanceof i.TFile){new i.Notice("File already exists"),this.app.workspace.getLeaf(!0).openFile(a),this.close();return}let l=await this.app.vault.create(r,"",{});this.app.workspace.getLeaf(!0).openFile(l),this.close()}catch(e){console.error("Error creating Typst file:",e),new i.Notice("Error creating file")}}onClose(){let{contentEl:e}=this;e.empty()}};
