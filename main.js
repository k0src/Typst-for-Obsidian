/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var Xe=Object.defineProperty;var Sr=Object.getOwnPropertyDescriptor;var kr=Object.getOwnPropertyNames;var Cr=Object.prototype.hasOwnProperty;var Er=(n,e,t)=>e in n?Xe(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var W=(n,e)=>()=>(n&&(e=n(n=0)),e);var re=(n,e)=>{for(var t in e)Xe(n,t,{get:e[t],enumerable:!0})},Ir=(n,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of kr(e))!Cr.call(n,i)&&i!==t&&Xe(n,i,{get:()=>e[i],enumerable:!(r=Sr(e,i))||r.enumerable});return n};var Tr=n=>Ir(Xe({},"__esModule",{value:!0}),n);var f=(n,e,t)=>(Er(n,typeof e!="symbol"?e+"":e,t),t);function ln(){return le([],{assets:!1})}function gn(n){return le([],n)}function qr(n){var t,r,i;let e=[];if(n&&(n==null?void 0:n.assets)!==!1&&((t=n==null?void 0:n.assets)!=null&&t.length)&&((r=n==null?void 0:n.assets)==null?void 0:r.length)>0){let o={text:"https://cdn.jsdelivr.net/gh/typst/typst-assets@v0.13.1/files/fonts/",_:"https://cdn.jsdelivr.net/gh/typst/typst-dev-assets@v0.13.1/files/fonts/"},s=(i=n.assetUrlPrefix)!=null?i:o;typeof s=="string"?s={_:s}:s={...o,...s};for(let d of Object.keys(s)){let l=s[d];l[l.length-1]!=="/"&&(s[d]=l+"/")}let c=(d,l)=>l.map(p=>(s[d]||s._)+p);for(let d of n.assets)switch(d){case"text":e.push(...c(d,Vr));break;case"cjk":e.push(...c(d,zr));break;case"emoji":e.push(...c(d,Ur));break}}return e}function le(n,e){let t=qr(e),r=async(i,{ref:o,builder:s})=>{e!=null&&e.fetcher&&o.setFetcher(e.fetcher),await o.loadFonts(s,[...n,...t])};return r._preloadRemoteFontOptions=e,r._kind="fontLoader",r}function Ue(n){return async(e,{builder:t})=>new Promise(r=>{t.set_package_registry(n,function(i){return n.resolve(i,this)}),r()})}function ft(n){return async(e,t)=>{var r;if(t.alreadySetAccessModel)throw new Error(`already set some assess model before: ${(r=t.alreadySetAccessModel.constructor)==null?void 0:r.name}(${t.alreadySetAccessModel})`);return t.alreadySetAccessModel=n,new Promise(i=>{t.builder.set_access_model(n,o=>{let s=n.getMTime(o);return s?s.getTime():0},o=>n.isFile(o)||!1,o=>n.getRealPath(o)||o,o=>n.readAll(o)),i()})}}var ao,Vr,zr,Ur,pt=W(()=>{ao=Symbol("beforeBuild"),Vr=["DejaVuSansMono-Bold.ttf","DejaVuSansMono-BoldOblique.ttf","DejaVuSansMono-Oblique.ttf","DejaVuSansMono.ttf","LibertinusSerif-Bold.otf","LibertinusSerif-BoldItalic.otf","LibertinusSerif-Italic.otf","LibertinusSerif-Regular.otf","LibertinusSerif-Semibold.otf","LibertinusSerif-SemiboldItalic.otf","NewCM10-Bold.otf","NewCM10-BoldItalic.otf","NewCM10-Italic.otf","NewCM10-Regular.otf","NewCMMath-Bold.otf","NewCMMath-Book.otf","NewCMMath-Regular.otf"],zr=["InriaSerif-Bold.ttf","InriaSerif-BoldItalic.ttf","InriaSerif-Italic.ttf","InriaSerif-Regular.ttf","Roboto-Regular.ttf","NotoSerifCJKsc-Regular.otf"],Ur=["TwitterColorEmoji.ttf","NotoColorEmoji-Regular-COLR.subset.ttf"]});function Zr(){return pn||(pn=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Hr(){return wn||(wn=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}function Gr(n){let e=new Promise((t,r)=>{let i=()=>{n.removeEventListener("success",o),n.removeEventListener("error",s)},o=()=>{t(ie(n.result)),i()},s=()=>{r(n.error),i()};n.addEventListener("success",o),n.addEventListener("error",s)});return e.then(t=>{t instanceof IDBCursor&&hn.set(t,n)}).catch(()=>{}),mt.set(e,n),e}function Yr(n){if(ht.has(n))return;let e=new Promise((t,r)=>{let i=()=>{n.removeEventListener("complete",o),n.removeEventListener("error",s),n.removeEventListener("abort",s)},o=()=>{t(),i()},s=()=>{r(n.error||new DOMException("AbortError","AbortError")),i()};n.addEventListener("complete",o),n.addEventListener("error",s),n.addEventListener("abort",s)});ht.set(n,e)}function mn(n){bt=n(bt)}function Jr(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){let r=n.call(qe(this),e,...t);return bn.set(r,e.sort?e.sort():[e]),ie(r)}:Hr().includes(n)?function(...e){return n.apply(qe(this),e),ie(hn.get(this))}:function(...e){return ie(n.apply(qe(this),e))}}function Kr(n){return typeof n=="function"?Jr(n):(n instanceof IDBTransaction&&Yr(n),Nr(n,Zr())?new Proxy(n,bt):n)}function ie(n){if(n instanceof IDBRequest)return Gr(n);if(wt.has(n))return wt.get(n);let e=Kr(n);return e!==n&&(wt.set(n,e),mt.set(e,n)),e}var Nr,pn,wn,hn,ht,bn,wt,mt,bt,qe,yt=W(()=>{Nr=(n,e)=>e.some(t=>n instanceof t);hn=new WeakMap,ht=new WeakMap,bn=new WeakMap,wt=new WeakMap,mt=new WeakMap;bt={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return ht.get(n);if(e==="objectStoreNames")return n.objectStoreNames||bn.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return ie(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};qe=n=>mt.get(n)});function yn(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(vt.get(e))return vt.get(e);let t=e.replace(/FromIndex$/,""),r=e!==t,i=ti.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(i||ei.includes(t)))return;let o=async function(s,...c){let d=this.transaction(s,i?"readwrite":"readonly"),l=d.store;return r&&(l=l.index(c.shift())),(await Promise.all([l[t](...c),i&&d.done]))[0]};return vt.set(e,o),o}var ei,ti,vt,vn=W(()=>{yt();yt();ei=["get","getKey","getAll","getAllKeys","count"],ti=["put","add","delete","clear"],vt=new Map;mn(n=>({...n,get:(e,t,r)=>yn(e,t)||n.get(e,t,r),has:(e,t)=>!!yn(e,t)||n.has(e,t)}))});async function Ne(n,e,t,r){var i;return await e.init((i=n==null?void 0:n.getModule)==null?void 0:i.call(n)),await new Ot().build(n,new t,r)}var Ot,xt=W(()=>{vn();Ot=class{constructor(){f(this,"loadedFonts",new Set);f(this,"fetcher",fetch)}setFetcher(e){this.fetcher=e}async loadFonts(e,t){let r=new Function("m","return import(m)"),i=this.fetcher||(this.fetcher=await async function(){let{fetchBuilder:c,FileSystemCache:d}=await r("node-fetch-cache"),l=new d({cacheDirectory:".cache/typst/fonts"}),p=c.withCache(l);return function(y,M){let A=setTimeout(()=>{console.warn("font fetching is stucking:",y)},15e3);return p(y,M).finally(()=>{clearTimeout(A)})}}()),o=t.filter(c=>c instanceof Uint8Array?!0:this.loadedFonts.has(c)?!1:(this.loadedFonts.add(c),!0)),s=await Promise.all(o.map(async c=>{if(c instanceof Uint8Array){await e.add_raw_font(c);return}return new Uint8Array(await(await i(c)).arrayBuffer())}));for(let c of s)c&&await e.add_raw_font(c)}async build(e,t,r){var s;let i={ref:this,builder:t,hooks:r};for(let c of(s=e==null?void 0:e.beforeBuild)!=null?s:[])await c(void 0,i);return r.latelyBuild&&r.latelyBuild(i),await t.build()}}});var k,fe,Te=W(()=>{k=Symbol.for("reflexo-obj");(function(n){n[n.PIXEL_PER_PT=3]="PIXEL_PER_PT"})(fe||(fe={}))});var ri,pe,Pt=W(()=>{ri=n=>{let e=!1,t;return()=>e?t:(e=!0,t=n())},pe=class{constructor(e){f(this,"wasmBin");f(this,"initOnce");if(typeof e!="function")throw new Error("initFn is not a function");this.initOnce=ri(async()=>{await e(this.wasmBin)})}async init(e){this.wasmBin=e,await this.initOnce()}}});function b(n){return ee[n]}function O(n){je===ee.length&&ee.push(ee.length+1);let e=je;return je=ee[e],ee[e]=n,e}function we(n,e){try{return n.apply(this,e)}catch(t){u.__wbindgen_export_0(O(t))}}function he(){return(Re===null||Re.byteLength===0)&&(Re=new Uint8Array(u.memory.buffer)),Re}function G(n,e){return n=n>>>0,kn.decode(he().subarray(n,n+e))}function ii(n){n<132||(ee[n]=je,je=n)}function E(n){let e=b(n);return ii(n),e}function F(n,e,t){if(t===void 0){let c=He.encode(n),d=e(c.length,1)>>>0;return he().subarray(d,d+c.length).set(c),R=c.length,d}let r=n.length,i=e(r,1)>>>0,o=he(),s=0;for(;s<r;s++){let c=n.charCodeAt(s);if(c>127)break;o[i+s]=c}if(s!==r){s!==0&&(n=n.slice(s)),i=t(i,r,r=s+n.length*3,1)>>>0;let c=he().subarray(i+s,i+r),d=oi(n,c);s+=d.written,i=t(i,r,s,1)>>>0}return R=s,i}function x(){return(oe===null||oe.buffer.detached===!0||oe.buffer.detached===void 0&&oe.buffer!==u.memory.buffer)&&(oe=new DataView(u.memory.buffer)),oe}function B(n){return n==null}function si(n,e,t,r){let i={a:n,b:e,cnt:1,dtor:t},o=(...s)=>{i.cnt++;let c=i.a;i.a=0;try{return r(c,i.b,...s)}finally{--i.cnt===0?(u.__wbindgen_export_4.get(i.dtor)(c,i.b),On.unregister(i)):i.a=c}};return o.original=i,On.register(o,i,i),o}function kt(n){let e=typeof n;if(e=="number"||e=="boolean"||n==null)return`${n}`;if(e=="string")return`"${n}"`;if(e=="symbol"){let i=n.description;return i==null?"Symbol":`Symbol(${i})`}if(e=="function"){let i=n.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(n)){let i=n.length,o="[";i>0&&(o+=kt(n[0]));for(let s=1;s<i;s++)o+=", "+kt(n[s]);return o+="]",o}let t=/\[object ([^\]]+)\]/.exec(toString.call(n)),r;if(t&&t.length>1)r=t[1];else return toString.call(n);if(r=="Object")try{return"Object("+JSON.stringify(n)+")"}catch(i){return"Object"}return n instanceof Error?`${n.name}: ${n.message}
${n.stack}`:r}function ai(n){let e=u.get_font_info(O(n));return E(e)}function Cn(n,e){let t=e(n.length*1,1)>>>0;return he().set(n,t/1),R=n.length,t}function ci(n,e){n=n>>>0;let t=x(),r=[];for(let i=n;i<n+4*e;i+=4)r.push(E(t.getUint32(i,!0)));return r}function Ze(n,e){let t=e(n.length*4,4)>>>0,r=x();for(let i=0;i<n.length;i++)r.setUint32(t+4*i,O(n[i]),!0);return R=n.length,t}function _i(n,e){if(!(n instanceof e))throw new Error(`expected instance of ${e.name}`)}function ui(n,e){return n=n>>>0,he().subarray(n/1,n/1+e)}function di(n,e,t){u.__wbindgen_export_5(n,e,O(t))}function li(n,e,t,r){u.__wbindgen_export_6(n,e,O(t),O(r))}async function gi(n,e){if(typeof Response=="function"&&n instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(n,e)}catch(r){if(n.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",r);else throw r}let t=await n.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{let t=await WebAssembly.instantiate(n,e);return t instanceof WebAssembly.Instance?{instance:t,module:n}:t}}function En(){let n={};return n.wbg={},n.wbg.__wbg_buffer_609cc3eee51ed158=function(e){let t=b(e).buffer;return O(t)},n.wbg.__wbg_call_672a4d21634d4a24=function(){return we(function(e,t){let r=b(e).call(b(t));return O(r)},arguments)},n.wbg.__wbg_call_7cccdd69e0791ae2=function(){return we(function(e,t,r){let i=b(e).call(b(t),b(r));return O(i)},arguments)},n.wbg.__wbg_call_b8adc8b1d0a0d8eb=function(){return we(function(e,t,r,i,o){let s=b(e).call(b(t),b(r),b(i),b(o));return O(s)},arguments)},n.wbg.__wbg_done_769e5ede4b31c67b=function(e){return b(e).done},n.wbg.__wbg_entries_3265d4158b33e5dc=function(e){let t=Object.entries(b(e));return O(t)},n.wbg.__wbg_error_13f62fdb4fc06f92=function(e,t,r){console.error(b(e),b(t),b(r))},n.wbg.__wbg_error_7534b8e9a36f1ab4=function(e,t){let r,i;try{r=e,i=t,console.error(G(e,t))}finally{u.__wbindgen_export_1(r,i,1)}},n.wbg.__wbg_getTimezoneOffset_6b5752021c499c47=function(e){return b(e).getTimezoneOffset()},n.wbg.__wbg_get_67b2ba62fc30de12=function(){return we(function(e,t){let r=Reflect.get(b(e),b(t));return O(r)},arguments)},n.wbg.__wbg_get_b9b93047fe3cf45b=function(e,t){let r=b(e)[t>>>0];return O(r)},n.wbg.__wbg_getwithrefkey_1dc361bd10053bfe=function(e,t){let r=b(e)[b(t)];return O(r)},n.wbg.__wbg_info_3daf2e093e091b66=function(e){console.info(b(e))},n.wbg.__wbg_instanceof_ArrayBuffer_e14585432e3737fc=function(e){let t;try{t=b(e)instanceof ArrayBuffer}catch(i){t=!1}return t},n.wbg.__wbg_instanceof_Map_f3469ce2244d2430=function(e){let t;try{t=b(e)instanceof Map}catch(i){t=!1}return t},n.wbg.__wbg_instanceof_Object_7f2dcef8f78644a4=function(e){let t;try{t=b(e)instanceof Object}catch(i){t=!1}return t},n.wbg.__wbg_instanceof_Uint8Array_17156bcf118086a9=function(e){let t;try{t=b(e)instanceof Uint8Array}catch(i){t=!1}return t},n.wbg.__wbg_isArray_a1eab7e0d067391b=function(e){return Array.isArray(b(e))},n.wbg.__wbg_isSafeInteger_343e2beeeece1bb0=function(e){return Number.isSafeInteger(b(e))},n.wbg.__wbg_iterator_9a24c88df860dc65=function(){return O(Symbol.iterator)},n.wbg.__wbg_length_a446193dc22c12f8=function(e){return b(e).length},n.wbg.__wbg_length_e2d2a49132c1b256=function(e){return b(e).length},n.wbg.__wbg_log_53ca6abb454c8644=function(e,t,r){console.log(b(e),b(t),b(r))},n.wbg.__wbg_new_23a2665fac83c611=function(e,t){try{var r={a:e,b:t},i=(s,c)=>{let d=r.a;r.a=0;try{return li(d,r.b,s,c)}finally{r.a=d}};let o=new Promise(i);return O(o)}finally{r.a=r.b=0}},n.wbg.__wbg_new_31a97dac4f10fab7=function(e){let t=new Date(b(e));return O(t)},n.wbg.__wbg_new_405e22f390576ce2=function(){let e=new Object;return O(e)},n.wbg.__wbg_new_78feb108b6472713=function(){let e=new Array;return O(e)},n.wbg.__wbg_new_8a6f238a6ece86ea=function(){let e=new Error;return O(e)},n.wbg.__wbg_new_a12002a7f91c75be=function(e){let t=new Uint8Array(b(e));return O(t)},n.wbg.__wbg_new_c68d7209be747379=function(e,t){let r=new Error(G(e,t));return O(r)},n.wbg.__wbg_new_e3b321dcfef89fc7=function(e){let t=new Uint32Array(b(e));return O(t)},n.wbg.__wbg_newnoargs_105ed471475aaf50=function(e,t){let r=new Function(G(e,t));return O(r)},n.wbg.__wbg_newwithargs_ab6ffe8cd6c19c04=function(e,t,r,i){let o=new Function(G(e,t),G(r,i));return O(o)},n.wbg.__wbg_newwithbyteoffsetandlength_d97e637ebe145a9a=function(e,t,r){let i=new Uint8Array(b(e),t>>>0,r>>>0);return O(i)},n.wbg.__wbg_newwithbyteoffsetandlength_f1dead44d1fc7212=function(e,t,r){let i=new Uint32Array(b(e),t>>>0,r>>>0);return O(i)},n.wbg.__wbg_next_25feadfc0913fea9=function(e){let t=b(e).next;return O(t)},n.wbg.__wbg_next_6574e1a8a62d1055=function(){return we(function(e){let t=b(e).next();return O(t)},arguments)},n.wbg.__wbg_now_807e54c39636c349=function(){return Date.now()},n.wbg.__wbg_proxycontext_new=function(e){let t=be.__wrap(e);return O(t)},n.wbg.__wbg_push_737cfc8c1432c2c6=function(e,t){return b(e).push(b(t))},n.wbg.__wbg_queueMicrotask_97d92b4fcc8a61c5=function(e){queueMicrotask(b(e))},n.wbg.__wbg_queueMicrotask_d3219def82552485=function(e){let t=b(e).queueMicrotask;return O(t)},n.wbg.__wbg_resolve_4851785c9c5f573d=function(e){let t=Promise.resolve(b(e));return O(t)},n.wbg.__wbg_set_37837023f3d740e8=function(e,t,r){b(e)[t>>>0]=E(r)},n.wbg.__wbg_set_3f1d0b984ed272ed=function(e,t,r){b(e)[E(t)]=E(r)},n.wbg.__wbg_set_65595bdd868b3009=function(e,t,r){b(e).set(b(t),r>>>0)},n.wbg.__wbg_set_bb8cecf6a62b9f46=function(){return we(function(e,t,r){return Reflect.set(b(e),b(t),b(r))},arguments)},n.wbg.__wbg_stack_0ed75d68575b0f3c=function(e,t){let r=b(t).stack,i=F(r,u.__wbindgen_export_2,u.__wbindgen_export_3),o=R;x().setInt32(e+4*1,o,!0),x().setInt32(e+4*0,i,!0)},n.wbg.__wbg_static_accessor_GLOBAL_88a902d13a557d07=function(){let e=typeof globalThis=="undefined"?null:globalThis;return B(e)?0:O(e)},n.wbg.__wbg_static_accessor_GLOBAL_THIS_56578be7e9f832b0=function(){let e=typeof globalThis=="undefined"?null:globalThis;return B(e)?0:O(e)},n.wbg.__wbg_static_accessor_SELF_37c5d418e4bf5819=function(){let e=typeof self=="undefined"?null:self;return B(e)?0:O(e)},n.wbg.__wbg_static_accessor_WINDOW_5de37043a91a9c40=function(){let e=typeof window=="undefined"?null:window;return B(e)?0:O(e)},n.wbg.__wbg_then_44b73946d2fb3e7d=function(e,t){let r=b(e).then(b(t));return O(r)},n.wbg.__wbg_typstcompiler_new=function(e){let t=me.__wrap(e);return O(t)},n.wbg.__wbg_value_cd1ffa7b1ab794f1=function(e){let t=b(e).value;return O(t)},n.wbg.__wbindgen_as_number=function(e){return+b(e)},n.wbg.__wbindgen_bigint_from_i64=function(e){return O(e)},n.wbg.__wbindgen_bigint_from_u64=function(e){let t=BigInt.asUintN(64,e);return O(t)},n.wbg.__wbindgen_bigint_get_as_i64=function(e,t){let r=b(t),i=typeof r=="bigint"?r:void 0;x().setBigInt64(e+8*1,B(i)?BigInt(0):i,!0),x().setInt32(e+4*0,!B(i),!0)},n.wbg.__wbindgen_boolean_get=function(e){let t=b(e);return typeof t=="boolean"?t?1:0:2},n.wbg.__wbindgen_cb_drop=function(e){let t=E(e).original;return t.cnt--==1?(t.a=0,!0):!1},n.wbg.__wbindgen_closure_wrapper794=function(e,t,r){let i=si(e,t,219,di);return O(i)},n.wbg.__wbindgen_debug_string=function(e,t){let r=kt(b(t)),i=F(r,u.__wbindgen_export_2,u.__wbindgen_export_3),o=R;x().setInt32(e+4*1,o,!0),x().setInt32(e+4*0,i,!0)},n.wbg.__wbindgen_error_new=function(e,t){let r=new Error(G(e,t));return O(r)},n.wbg.__wbindgen_in=function(e,t){return b(e)in b(t)},n.wbg.__wbindgen_is_bigint=function(e){return typeof b(e)=="bigint"},n.wbg.__wbindgen_is_function=function(e){return typeof b(e)=="function"},n.wbg.__wbindgen_is_object=function(e){let t=b(e);return typeof t=="object"&&t!==null},n.wbg.__wbindgen_is_string=function(e){return typeof b(e)=="string"},n.wbg.__wbindgen_is_undefined=function(e){return b(e)===void 0},n.wbg.__wbindgen_jsval_eq=function(e,t){return b(e)===b(t)},n.wbg.__wbindgen_jsval_loose_eq=function(e,t){return b(e)==b(t)},n.wbg.__wbindgen_memory=function(){let e=u.memory;return O(e)},n.wbg.__wbindgen_number_get=function(e,t){let r=b(t),i=typeof r=="number"?r:void 0;x().setFloat64(e+8*1,B(i)?0:i,!0),x().setInt32(e+4*0,!B(i),!0)},n.wbg.__wbindgen_number_new=function(e){return O(e)},n.wbg.__wbindgen_object_clone_ref=function(e){let t=b(e);return O(t)},n.wbg.__wbindgen_object_drop_ref=function(e){E(e)},n.wbg.__wbindgen_string_get=function(e,t){let r=b(t),i=typeof r=="string"?r:void 0;var o=B(i)?0:F(i,u.__wbindgen_export_2,u.__wbindgen_export_3),s=R;x().setInt32(e+4*1,s,!0),x().setInt32(e+4*0,o,!0)},n.wbg.__wbindgen_string_new=function(e,t){let r=G(e,t);return O(r)},n.wbg.__wbindgen_throw=function(e,t){throw new Error(G(e,t))},n}function In(n,e){return u=n.exports,Tn.__wbindgen_wasm_module=e,oe=null,Re=null,u}function fi(n){if(u!==void 0)return u;typeof n!="undefined"&&(Object.getPrototypeOf(n)===Object.prototype?{module:n}=n:console.warn("using deprecated parameters for `initSync()`; pass a single object instead"));let e=En();n instanceof WebAssembly.Module||(n=new WebAssembly.Module(n));let t=new WebAssembly.Instance(n,e);return In(t,n)}async function Tn(n){if(u!==void 0)return u;typeof n!="undefined"&&(Object.getPrototypeOf(n)===Object.prototype?{module_or_path:n}=n:console.warn("using deprecated parameters for the initialization function; pass a single object instead")),typeof n=="undefined"&&(n=jn("typst_ts_web_compiler_bg.wasm",pi.url));let e=En();(typeof n=="string"||typeof Request=="function"&&n instanceof Request||typeof URL=="function"&&n instanceof URL)&&(n=fetch(n));let{instance:t,module:r}=await gi(await n,e);return In(t,r)}function Et(n){jn=n}var pi,u,ee,je,kn,Re,R,He,oi,oe,On,xn,se,St,be,Pn,me,Sn,Ct,Rn,jn,Ge=W(()=>{pi={},ee=new Array(128).fill(void 0);ee.push(void 0,null,!0,!1);je=ee.length;kn=typeof TextDecoder!="undefined"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder!="undefined"&&kn.decode();Re=null;R=0,He=typeof TextEncoder!="undefined"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},oi=typeof He.encodeInto=="function"?function(n,e){return He.encodeInto(n,e)}:function(n,e){let t=He.encode(n);return e.set(t),{read:n.length,written:t.length}};oe=null;On=typeof FinalizationRegistry=="undefined"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>{u.__wbindgen_export_4.get(n.dtor)(n.a,n.b)});xn=typeof FinalizationRegistry=="undefined"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>u.__wbg_incrserver_free(n>>>0,1)),se=class{static __wrap(e){e=e>>>0;let t=Object.create(se.prototype);return t.__wbg_ptr=e,xn.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){let e=this.__wbg_ptr;return this.__wbg_ptr=0,xn.unregister(this),e}free(){let e=this.__destroy_into_raw();u.__wbg_incrserver_free(e,0)}set_attach_debug_info(e){u.incrserver_set_attach_debug_info(this.__wbg_ptr,e)}current(){try{let r=u.__wbindgen_add_to_stack_pointer(-16);u.incrserver_current(r,this.__wbg_ptr);var e=x().getInt32(r+4*0,!0),t=x().getInt32(r+4*1,!0);let i;return e!==0&&(i=ui(e,t).slice(),u.__wbindgen_export_1(e,t*1,1)),i}finally{u.__wbindgen_add_to_stack_pointer(16)}}reset(){u.incrserver_reset(this.__wbg_ptr)}},St=typeof FinalizationRegistry=="undefined"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>u.__wbg_proxycontext_free(n>>>0,1)),be=class{static __wrap(e){e=e>>>0;let t=Object.create(be.prototype);return t.__wbg_ptr=e,St.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){let e=this.__wbg_ptr;return this.__wbg_ptr=0,St.unregister(this),e}free(){let e=this.__destroy_into_raw();u.__wbg_proxycontext_free(e,0)}constructor(e){let t=u.proxycontext_new(O(e));return this.__wbg_ptr=t>>>0,St.register(this,this.__wbg_ptr,this),this}get context(){let e=u.proxycontext_context(this.__wbg_ptr);return E(e)}untar(e,t){try{let o=u.__wbindgen_add_to_stack_pointer(-16),s=Cn(e,u.__wbindgen_export_2),c=R;u.proxycontext_untar(o,this.__wbg_ptr,s,c,O(t));var r=x().getInt32(o+4*0,!0),i=x().getInt32(o+4*1,!0);if(i)throw E(r)}finally{u.__wbindgen_add_to_stack_pointer(16)}}},Pn=typeof FinalizationRegistry=="undefined"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>u.__wbg_typstcompiler_free(n>>>0,1)),me=class{static __wrap(e){e=e>>>0;let t=Object.create(me.prototype);return t.__wbg_ptr=e,Pn.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){let e=this.__wbg_ptr;return this.__wbg_ptr=0,Pn.unregister(this),e}free(){let e=this.__destroy_into_raw();u.__wbg_typstcompiler_free(e,0)}reset(){try{let r=u.__wbindgen_add_to_stack_pointer(-16);u.typstcompiler_reset(r,this.__wbg_ptr);var e=x().getInt32(r+4*0,!0),t=x().getInt32(r+4*1,!0);if(t)throw E(e)}finally{u.__wbindgen_add_to_stack_pointer(16)}}set_inputs(e){try{let i=u.__wbindgen_add_to_stack_pointer(-16);u.typstcompiler_set_inputs(i,this.__wbg_ptr,O(e));var t=x().getInt32(i+4*0,!0),r=x().getInt32(i+4*1,!0);if(r)throw E(t)}finally{u.__wbindgen_add_to_stack_pointer(16)}}add_source(e,t){let r=F(e,u.__wbindgen_export_2,u.__wbindgen_export_3),i=R,o=F(t,u.__wbindgen_export_2,u.__wbindgen_export_3),s=R;return u.typstcompiler_add_source(this.__wbg_ptr,r,i,o,s)!==0}map_shadow(e,t){let r=F(e,u.__wbindgen_export_2,u.__wbindgen_export_3),i=R,o=Cn(t,u.__wbindgen_export_2),s=R;return u.typstcompiler_map_shadow(this.__wbg_ptr,r,i,o,s)!==0}unmap_shadow(e){let t=F(e,u.__wbindgen_export_2,u.__wbindgen_export_3),r=R;return u.typstcompiler_unmap_shadow(this.__wbg_ptr,t,r)!==0}reset_shadow(){u.typstcompiler_reset_shadow(this.__wbg_ptr)}get_loaded_fonts(){try{let i=u.__wbindgen_add_to_stack_pointer(-16);u.typstcompiler_get_loaded_fonts(i,this.__wbg_ptr);var e=x().getInt32(i+4*0,!0),t=x().getInt32(i+4*1,!0),r=ci(e,t).slice();return u.__wbindgen_export_1(e,t*4,4),r}finally{u.__wbindgen_add_to_stack_pointer(16)}}get_ast(e){let t,r;try{let p=u.__wbindgen_add_to_stack_pointer(-16),y=F(e,u.__wbindgen_export_2,u.__wbindgen_export_3),M=R;u.typstcompiler_get_ast(p,this.__wbg_ptr,y,M);var i=x().getInt32(p+4*0,!0),o=x().getInt32(p+4*1,!0),s=x().getInt32(p+4*2,!0),c=x().getInt32(p+4*3,!0),d=i,l=o;if(c)throw d=0,l=0,E(s);return t=d,r=l,G(d,l)}finally{u.__wbindgen_add_to_stack_pointer(16),u.__wbindgen_export_1(t,r,1)}}get_semantic_token_legend(){try{let i=u.__wbindgen_add_to_stack_pointer(-16);u.typstcompiler_get_semantic_token_legend(i,this.__wbg_ptr);var e=x().getInt32(i+4*0,!0),t=x().getInt32(i+4*1,!0),r=x().getInt32(i+4*2,!0);if(r)throw E(t);return E(e)}finally{u.__wbindgen_add_to_stack_pointer(16)}}get_semantic_tokens(e,t,r){try{let y=u.__wbindgen_add_to_stack_pointer(-16),M=F(e,u.__wbindgen_export_2,u.__wbindgen_export_3),A=R;var i=B(t)?0:F(t,u.__wbindgen_export_2,u.__wbindgen_export_3),o=R,s=B(r)?0:F(r,u.__wbindgen_export_2,u.__wbindgen_export_3),c=R;u.typstcompiler_get_semantic_tokens(y,this.__wbg_ptr,M,A,i,o,s,c);var d=x().getInt32(y+4*0,!0),l=x().getInt32(y+4*1,!0),p=x().getInt32(y+4*2,!0);if(p)throw E(l);return E(d)}finally{u.__wbindgen_add_to_stack_pointer(16)}}get_artifact(e,t){try{let s=u.__wbindgen_add_to_stack_pointer(-16),c=F(e,u.__wbindgen_export_2,u.__wbindgen_export_3),d=R;u.typstcompiler_get_artifact(s,this.__wbg_ptr,c,d,t);var r=x().getInt32(s+4*0,!0),i=x().getInt32(s+4*1,!0),o=x().getInt32(s+4*2,!0);if(o)throw E(i);return E(r)}finally{u.__wbindgen_add_to_stack_pointer(16)}}set_compiler_options(e,t){try{let c=u.__wbindgen_add_to_stack_pointer(-16),d=F(e,u.__wbindgen_export_2,u.__wbindgen_export_3),l=R;var r=B(t)?0:Ze(t,u.__wbindgen_export_2),i=R;u.typstcompiler_set_compiler_options(c,this.__wbg_ptr,d,l,r,i);var o=x().getInt32(c+4*0,!0),s=x().getInt32(c+4*1,!0);if(s)throw E(o)}finally{u.__wbindgen_add_to_stack_pointer(16)}}query(e,t,r,i){let o,s;try{let Q=u.__wbindgen_add_to_stack_pointer(-16),vr=F(e,u.__wbindgen_export_2,u.__wbindgen_export_3),Or=R;var c=B(t)?0:Ze(t,u.__wbindgen_export_2),d=R;let xr=F(r,u.__wbindgen_export_2,u.__wbindgen_export_3),Pr=R;var l=B(i)?0:F(i,u.__wbindgen_export_2,u.__wbindgen_export_3),p=R;u.typstcompiler_query(Q,this.__wbg_ptr,vr,Or,c,d,xr,Pr,l,p);var y=x().getInt32(Q+4*0,!0),M=x().getInt32(Q+4*1,!0),A=x().getInt32(Q+4*2,!0),L=x().getInt32(Q+4*3,!0),K=y,z=M;if(L)throw K=0,z=0,E(A);return o=K,s=z,G(K,z)}finally{u.__wbindgen_add_to_stack_pointer(16),u.__wbindgen_export_1(o,s,1)}}compile(e,t,r,i){try{let p=u.__wbindgen_add_to_stack_pointer(-16),y=F(e,u.__wbindgen_export_2,u.__wbindgen_export_3),M=R;var o=B(t)?0:Ze(t,u.__wbindgen_export_2),s=R;let A=F(r,u.__wbindgen_export_2,u.__wbindgen_export_3),L=R;u.typstcompiler_compile(p,this.__wbg_ptr,y,M,o,s,A,L,i);var c=x().getInt32(p+4*0,!0),d=x().getInt32(p+4*1,!0),l=x().getInt32(p+4*2,!0);if(l)throw E(d);return E(c)}finally{u.__wbindgen_add_to_stack_pointer(16)}}create_incr_server(){try{let i=u.__wbindgen_add_to_stack_pointer(-16);u.typstcompiler_create_incr_server(i,this.__wbg_ptr);var e=x().getInt32(i+4*0,!0),t=x().getInt32(i+4*1,!0),r=x().getInt32(i+4*2,!0);if(r)throw E(t);return se.__wrap(e)}finally{u.__wbindgen_add_to_stack_pointer(16)}}incr_compile(e,t,r,i){try{let p=u.__wbindgen_add_to_stack_pointer(-16),y=F(e,u.__wbindgen_export_2,u.__wbindgen_export_3),M=R;var o=B(t)?0:Ze(t,u.__wbindgen_export_2),s=R;_i(r,se),u.typstcompiler_incr_compile(p,this.__wbg_ptr,y,M,o,s,r.__wbg_ptr,i);var c=x().getInt32(p+4*0,!0),d=x().getInt32(p+4*1,!0),l=x().getInt32(p+4*2,!0);if(l)throw E(d);return E(c)}finally{u.__wbindgen_add_to_stack_pointer(16)}}},Sn=typeof FinalizationRegistry=="undefined"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>u.__wbg_typstcompilerbuilder_free(n>>>0,1)),Ct=class{__destroy_into_raw(){let e=this.__wbg_ptr;return this.__wbg_ptr=0,Sn.unregister(this),e}free(){let e=this.__destroy_into_raw();u.__wbg_typstcompilerbuilder_free(e,0)}constructor(){try{let i=u.__wbindgen_add_to_stack_pointer(-16);u.typstcompilerbuilder_new(i);var e=x().getInt32(i+4*0,!0),t=x().getInt32(i+4*1,!0),r=x().getInt32(i+4*2,!0);if(r)throw E(t);return this.__wbg_ptr=e>>>0,Sn.register(this,this.__wbg_ptr,this),this}finally{u.__wbindgen_add_to_stack_pointer(16)}}set_dummy_access_model(){try{let r=u.__wbindgen_add_to_stack_pointer(-16);u.typstcompilerbuilder_set_dummy_access_model(r,this.__wbg_ptr);var e=x().getInt32(r+4*0,!0),t=x().getInt32(r+4*1,!0);if(t)throw E(e)}finally{u.__wbindgen_add_to_stack_pointer(16)}}set_access_model(e,t,r,i,o){let s=u.typstcompilerbuilder_set_access_model(this.__wbg_ptr,O(e),O(t),O(r),O(i),O(o));return E(s)}set_package_registry(e,t){let r=u.typstcompilerbuilder_set_package_registry(this.__wbg_ptr,O(e),O(t));return E(r)}add_raw_font(e){let t=u.typstcompilerbuilder_add_raw_font(this.__wbg_ptr,O(e));return E(t)}add_web_fonts(e){let t=u.typstcompilerbuilder_add_web_fonts(this.__wbg_ptr,O(e));return E(t)}build(){let e=this.__destroy_into_raw(),t=u.typstcompilerbuilder_build(e);return E(t)}};Rn=Tn,jn=async function(n,e){throw new Error("Cannot import wasm module without importer: "+n+" "+e)}});var It={};re(It,{IncrServer:()=>se,ProxyContext:()=>be,TypstCompiler:()=>me,TypstCompilerBuilder:()=>Ct,default:()=>wi,get_font_info:()=>ai,initSync:()=>fi,setImportWasmModule:()=>Et});var wi,hi,bi,Tt=W(()=>{Ge();Ge();Ge();wi=Rn,hi=async function(n,e){let t=new Function("m","return import(m)"),{readFileSync:r}=await t("fs"),i=new URL(n,e);return await r(i).buffer},bi=typeof process!="undefined"&&process.versions!=null&&process.versions.node!=null;bi&&Et(hi)});var jt={};re(jt,{IncrementalServer:()=>Ye,createTypstCompiler:()=>An});function An(){return new Me}function Rt(n){return n?Object.entries(n):void 0}function Mn(n){switch(n){case"none":return 1;case"unix":return 2;case"full":default:return 3}}var yi,Ye,mi,Mt,Me,At=W(()=>{xt();Te();pt();Pt();Ye=class{constructor(e){f(this,yi);this[k]=e}reset(){this[k].reset()}current(){return this[k].current()}setAttachDebugInfo(e){this[k].set_attach_debug_info(e)}};yi=k;mi=new pe(async n=>await(await Promise.resolve().then(()=>(Tt(),It))).default(n));Mt=class{constructor(){f(this,"compiler");f(this,"compilerJs")}async init(e){var l;this.compilerJs=await Promise.resolve().then(()=>(Tt(),It));let t=this.compilerJs.TypstCompilerBuilder,r={...e||{}},i=(l=r.beforeBuild)!=null?l:r.beforeBuild=[],o=i.some(p=>p._preloadRemoteFontOptions!==void 0),s=i.some(p=>{var y;return((y=p._preloadRemoteFontOptions)==null?void 0:y.assets)!==void 0}),c=i.some(p=>{var y;return((y=p._preloadRemoteFontOptions)==null?void 0:y.assets)===!1});if((!o||!s&&!c)&&i.push(le([],{assets:Mt.defaultAssets})),!i.some(p=>p._kind==="fontLoader"))throw new Error("TypstCompiler: no font loader found, please use font loaders, e.g. preloadRemoteFonts or preloadSystemFonts");this.compiler=await Ne(e,mi,t,{})}compile(e){return new Promise(t=>{if("incrementalServer"in e){t(this.compiler.incr_compile(e.mainFilePath,Rt(e.inputs),e.incrementalServer[k],Mn(e.diagnostics)));return}t(this.compiler.compile(e.mainFilePath,Rt(e.inputs),e.format||"vector",Mn(e.diagnostics)))})}query(e){return new Promise(t=>{t(JSON.parse(this.compiler.query(e.mainFilePath,Rt(e.inputs),e.selector,e.field)))})}getSemanticTokenLegend(){return new Promise(e=>{e(this.compiler.get_semantic_token_legend())})}getSemanticTokens(e){return new Promise(t=>{this.compiler.reset(),t(this.compiler.get_semantic_tokens(e.offsetEncoding||"utf-16",e.mainFilePath,e.resultId))})}async withIncrementalServer(e){let t=new Ye(this.compiler.create_incr_server());try{return await e(t)}finally{t[k].free()}}async getAst(e){return this.compiler.get_ast(e)}async reset(){await new Promise(e=>{this.compiler.reset(),e(void 0)})}addSource(e,t){if(arguments.length>2)throw new Error("use of addSource(path, source, isMain) is deprecated, please use addSource(path, source) instead");this.compiler.add_source(e,t)}mapShadow(e,t){this.compiler.map_shadow(e,t)}unmapShadow(e){this.compiler.unmap_shadow(e)}resetShadow(){this.compiler.reset_shadow()}renderPageToCanvas(){throw new Error("Please use the api TypstRenderer.renderToCanvas in v0.4.0")}},Me=Mt;f(Me,"defaultAssets",["text"]);An._impl=Me});var Qn={};re(Qn,{createGlobalCompiler:()=>Dn,getGlobalCompiler:()=>Fn,withGlobalCompiler:()=>vi});function Fn(){return Ln?Ft:void 0}function Dn(n,e){let t=Ft||n();return Lt!==void 0?Lt:Lt=(async()=>(Ln=!0,await t.init(e),Ft=t))()}function vi(n,e,t,r){let i=Fn();if(i){t(i);return}Dn(n,e).then(t).catch(r)}var Ft,Lt,Ln,Wn=W(()=>{Ln=!1});var Je,Xn=W(()=>{Te();Je=class{constructor(e,t,r){f(this,"pageInfos");f(this,"loadPageCount");f(this,"imageScaleFactor");f(this,"container");f(this,"canvasList");f(this,"textLayerList");f(this,"commonList");f(this,"textLayerParentList");f(this,"semanticLayerList");var o;this.pageInfos=e,this.imageScaleFactor=(o=r.pixelPerPt)!=null?o:fe.PIXEL_PER_PT,t.innerHTML="",t.style.width="100%",this.container=t,this.canvasList=new Array(this.loadPageCount),this.textLayerList=new Array(this.loadPageCount),this.commonList=new Array(this.loadPageCount),this.textLayerParentList=new Array(this.loadPageCount),this.semanticLayerList=new Array(this.loadPageCount);let i=(s,c,d)=>{let l=Math.ceil(c.width)*this.imageScaleFactor,p=Math.ceil(c.height)*this.imageScaleFactor,y=this.canvasList[s]=document.createElement("canvas"),M=this.semanticLayerList[s]=document.createElement("div"),A=this.textLayerList[s]=document.createElement("div"),L=this.textLayerParentList[s]=document.createElement("div");if(y.getContext("2d")){let z=document.createElement("div");y.width=l,y.height=p,z.appendChild(y),d.appendChild(z),z.style.position="absolute"}{L.appendChild(A),L.className="typst-html-semantics";let z=t.offsetWidth,Q=z/c.width;L.style.width=`${z}px`,L.style.height=`${c.height*Q}px`,L.style.setProperty("--data-text-width",`${Q}px`),L.style.setProperty("--data-text-height",`${Q}px`),d.classList.add("typst-page"),d.classList.add("canvas"),d.style.width=`${z}px`,d.style.height=`${p*Q}px`,d.style.position="relative",M.appendChild(L),d.appendChild(M)}};for(let s=0;s<this.pageInfos.length;s++){let c=this.pageInfos[s],d;d=this.commonList[s]=document.createElement("div"),t.appendChild(d),i(s,c,d)}}resetLayout(){for(let e=0;e<this.pageInfos.length;e++){let t=this.pageInfos[e],r=Math.ceil(t.width)*this.imageScaleFactor,i=Math.ceil(t.height)*this.imageScaleFactor,o=this.canvasList[e].parentElement;if(!o)throw new Error(`canvasDiv is null for page ${e}, canvas list length ${this.canvasList.length}`);let s=this.commonList[e],c=this.textLayerParentList[e],d=this.container.offsetWidth,l=d/r;c.style.width=`${d}px`,c.style.height=`${i*l}px`,s.style.width=`${d}px`,s.style.height=`${i*l}px`;let p=this.container.offsetWidth/r;o.style.transformOrigin="0px 0px",o.style.transform=`scale(${p})`}}}});function $n(n){return class{constructor(t){f(this,"impl");f(this,"kModule");if(t.isContentPreview&&(t.renderMode="canvas"),this.kModule=t.kModule,this.impl=new n(t),!this.impl.r)throw new Error(`mode is not supported, ${t==null?void 0:t.renderMode}`);t.isContentPreview&&(this.impl.partialRendering=!0,this.impl.pixelPerPt=1,this.impl.isMixinOutline=!0)}dispose(){this.impl.dispose()}reset(){this.impl.reset()}addChangement(t){this.impl.addChangement(t)}addViewportChange(){this.impl.addViewportChange()}setPageColor(t){this.impl.pageColor=t,this.addViewportChange()}setPartialRendering(t){this.impl.partialRendering=t}setCursor(t,r,i){this.impl.cursorPosition=[t,r,i]}setPartialPageNumber(t){return t<=0||t>this.kModule.retrievePagesInfo().length?!1:(this.impl.partialRenderPage=t-1,this.addViewportChange(),!0)}getPartialPageNumber(){return this.impl.partialRenderPage+1}setOutineData(t){this.impl.outline=t,this.addViewportChange()}}}function Bn(n,...e){return e.reduce((t,r)=>r(t),n)}var ne,ye,Vn=W(()=>{(function(n){n[n.Doc=0]="Doc",n[n.Slide=1]="Slide"})(ne||(ne={}));ye=class{constructor(e){f(this,"hookedElem");f(this,"kModule");f(this,"opts");f(this,"modes",[]);f(this,"partialRendering",!0);f(this,"renderMode","svg");f(this,"r");f(this,"previewMode",ne.Doc);f(this,"isContentPreview",!1);f(this,"isMixinOutline",!1);f(this,"backgroundColor","black");f(this,"pageColor","white");f(this,"pixelPerPt",3);f(this,"retrieveDOMState");f(this,"isRendering",!1);f(this,"moduleInitialized",!1);f(this,"patchQueue",[]);f(this,"disposeList",[]);f(this,"canvasRenderCToken");f(this,"currentRealScale",1);f(this,"currentScaleRatio",1);f(this,"vpTimeout");f(this,"sampledRenderTime",0);f(this,"partialRenderPage",0);f(this,"outline");f(this,"cursorPosition");f(this,"cachedDOMState",{width:0,height:0,window:{innerWidth:0,innerHeight:0},boundingRect:{left:0,top:0,right:0}});var t,r;this.hookedElem=e.hookedElem,this.kModule=e.kModule,this.opts=e||{};{let{renderMode:i,previewMode:o,isContentPreview:s,retrieveDOMState:c}=e||{};this.partialRendering=!1,this.renderMode=i!=null?i:this.renderMode,this.previewMode=o!=null?o:this.previewMode,this.isContentPreview=s||!1,this.retrieveDOMState=c!=null?c:()=>({width:this.hookedElem.offsetWidth,height:this.hookedElem.offsetHeight,window:{innerWidth:window.innerWidth,innerHeight:window.innerHeight},boundingRect:this.hookedElem.getBoundingClientRect()}),this.backgroundColor=getComputedStyle(document.documentElement).getPropertyValue("--typst-preview-background-color")}this.hookedElem.classList.add("hide-scrollbar-x"),(t=this.hookedElem.parentElement)==null||t.classList.add("hide-scrollbar-x"),this.previewMode===ne.Slide&&(this.hookedElem.classList.add("hide-scrollbar-y"),(r=this.hookedElem.parentElement)==null||r.classList.add("hide-scrollbar-y")),this.installCtrlWheelHandler()}reset(){this.kModule.reset(),this.moduleInitialized=!1}dispose(){let e=this.disposeList;this.disposeList=[],e.forEach(t=>t())}static derive(e,t){return["rescale","rerender","postRender"].reduce((r,i)=>(r[i]=e[`${i}$${t}`].bind(e),console.assert(r[i]!==void 0,`${i}$${t} is undefined`),r),{})}registerMode(e){let t=ye.derive(this,e);this.modes.push([e,t]),e===this.renderMode&&(this.r=t)}installCtrlWheelHandler(){let e=[.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.3,1.5,1.7,1.9,2.1,2.4,2.7,3,3.3,3.7,4.1,4.6,5.1,5.7,6.3,7,7.7,8.5,9.4,10],t=r=>{var i,o,s,c;if(r.ctrlKey){r.preventDefault(),this.cachedDOMState=this.retrieveDOMState(),window.onresize!==null&&(window.onresize=null);let d=this.currentScaleRatio;if(r.deltaY<0){if(this.currentScaleRatio>=e.at(-1))return;this.currentScaleRatio=e.filter(A=>A>this.currentScaleRatio).at(0)}else if(r.deltaY>0){if(this.currentScaleRatio<=e.at(0))return;this.currentScaleRatio=e.filter(A=>A<this.currentScaleRatio).at(-1)}else return;let l=this.currentScaleRatio/d,p=r.pageX*(l-1),y=r.pageY*(l-1);Math.abs(this.currentScaleRatio-1)<1e-5?(this.hookedElem.classList.add("hide-scrollbar-x"),(i=this.hookedElem.parentElement)==null||i.classList.add("hide-scrollbar-x"),this.previewMode===ne.Slide&&(this.hookedElem.classList.add("hide-scrollbar-y"),(o=this.hookedElem.parentElement)==null||o.classList.add("hide-scrollbar-y"))):(this.hookedElem.classList.remove("hide-scrollbar-x"),(s=this.hookedElem.parentElement)==null||s.classList.remove("hide-scrollbar-x"),this.previewMode===ne.Slide&&(this.hookedElem.classList.remove("hide-scrollbar-y"),(c=this.hookedElem.parentElement)==null||c.classList.remove("hide-scrollbar-y")));let M=this.hookedElem.firstElementChild;if(M){let A=this.getSvgScaleRatio(),L=Number.parseFloat(M.getAttribute("data-height")),K=Math.ceil(L*A);this.hookedElem.style.height=`${K*2}px`}return window.scrollBy(p,y),this.addViewportChange(),!1}};this.renderMode!=="dom"&&(typeof acquireVsCodeApi!="undefined"?(window.addEventListener("wheel",t,{passive:!1}),this.disposeList.push(()=>{window.removeEventListener("wheel",t)})):(document.body.addEventListener("wheel",t,{passive:!1}),this.disposeList.push(()=>{document.body.removeEventListener("wheel",t)})))}getSvgScaleRatio(){let e=this.hookedElem.firstElementChild;if(!e)return 0;let t=this.cachedDOMState,r=Number.parseFloat(e.getAttribute("data-width")||e.getAttribute("width")||"1"),i=Number.parseFloat(e.getAttribute("data-height")||e.getAttribute("height")||"1");return this.currentRealScale=this.previewMode===ne.Slide?Math.min(t.width/r,t.height/i):t.width/r,this.currentRealScale*this.currentScaleRatio}processQueue(e){let t=e[0];switch(t){case"new":case"diff-v1":return t==="new"&&this.reset(),this.kModule.manipulateData({action:"merge",data:e[1]}),this.moduleInitialized=!0,!0;case"viewport-change":return this.moduleInitialized?!0:(console.log("viewport-change before initialization"),!1);default:return console.log("svgUpdateEvent",e),!1}}triggerUpdate(){if(this.isRendering)return;this.isRendering=!0;let e=async()=>{if(this.cachedDOMState=this.retrieveDOMState(),this.patchQueue.length===0){this.isRendering=!1,this.postprocessChanges();return}try{let t=performance.now(),r=this.canvasRenderCToken;r&&(await r.cancel(),await r.wait(),this.canvasRenderCToken=void 0,console.log("cancel canvas rendering"));let i=!1;for(;this.patchQueue.length>0;)i=this.processQueue(this.patchQueue.shift())||i;let o=performance.now();i&&(this.r.rescale(),await this.r.rerender(),this.r.rescale());let s=performance.now(),c=(d,l,p)=>`${d} ${(p-l).toFixed(2)} ms`;this.sampledRenderTime=s-t,console.log([c("parse",t,o),c("rerender",o,s),c("total",t,s)].join(", ")),requestAnimationFrame(e)}catch(t){console.error(t),this.isRendering=!1,this.postprocessChanges()}};requestAnimationFrame(e)}postprocessChanges(){this.r.postRender(),this.previewMode===ne.Slide&&document.querySelectorAll(".typst-page-number-indicator").forEach(e=>{e.textContent=`${this.kModule.retrievePagesInfo().length}`})}addChangement(e){e[0]==="new"&&this.patchQueue.splice(0,this.patchQueue.length);let t=()=>{this.vpTimeout=void 0,this.patchQueue.push(e),this.triggerUpdate()};this.vpTimeout!==void 0&&clearTimeout(this.vpTimeout),e[0]==="viewport-change"&&this.isRendering?this.vpTimeout=setTimeout(t,this.sampledRenderTime||100):t()}addViewportChange(){this.addChangement(["viewport-change",""])}}});var Ke,zn=W(()=>{Ke=class{constructor(){f(this,"isCancellationRequested",!1);f(this,"_onCancelled");f(this,"_onCancelledResolveResolved");let e,t;this._onCancelled=new Promise(r=>{e=r,t&&t(r)}),this._onCancelledResolveResolved=new Promise(r=>{t=r,e&&r(e)})}async cancel(){await this._onCancelledResolveResolved,this.isCancellationRequested=!0}isCancelRequested(){return this.isCancellationRequested}async consume(){(await this._onCancelledResolveResolved)()}wait(){return this._onCancelled}}});function xi(n){return class extends n{constructor(...r){super(...r);f(this,"tmpl",document.createElement("template"));f(this,"stub",this.createElement("<stub></stub>"));f(this,"plugin");f(this,"docKernel");f(this,"resourceHeader");f(this,"pages",[]);f(this,"domScale",1);f(this,"track_mode",Dt.Doc);f(this,"current_task");f(this,"viewport");if(this.registerMode("dom"),this.disposeList.push(()=>{this.dispose()}),this.plugin=this.opts.renderer,this.opts.domScale!==void 0){if(this.opts.domScale<=0)throw new Error("domScale must be positive");this.domScale=this.opts.domScale}}dispose(){for(let r of this.pages)r.dispose();this.docKernel&&this.docKernel.free()}createElement(r){return this.tmpl.innerHTML=r,this.tmpl.content.firstElementChild}async mountDom(r){if(console.log("mountDom",r),this.docKernel)throw new Error("already mounted");this.hookedElem.innerHTML='<svg class="typst-svg-resources" viewBox="0 0 0 0" width="0" height="0" style="opacity: 0; position: absolute;"></svg>',this.resourceHeader=this.hookedElem.querySelector(".typst-svg-resources"),this.docKernel=await this.plugin.renderer.mount_dom(this.kModule[k],this.hookedElem),this.docKernel.bind_functions({populateGlyphs:i=>{let o=this.createElement(i);console.log("populateGlyphs",o);let s=o.firstElementChild;this.resourceHeader.append(s)}})}async cancelAnyway$dom(){if(console.log("cancelAnyway$dom"),this.current_task){let r=this.current_task;this.current_task=void 0,await r.cancel()}}retrieveDOMPages(){return Array.from(this.hookedElem.querySelectorAll(".typst-dom-page"))}postRender$dom(){}rescale$dom(){}getDomViewport(r,i){let o=i.left,s=-i.top,c=i.right,d=r.innerHeight-i.top,l={x:0,y:s/this.domScale,width:Math.max(c-o,0)/this.domScale,height:Math.max(d-s,0)/this.domScale};return(l.width<=0||l.height<=0)&&(l.x=l.y=l.width=l.height=0),l}async rerender$dom(){let r=this.retrieveDOMState(),{x:i,y:o,width:s,height:c}=this.getDomViewport(r.window,r.boundingRect);if(!await this.docKernel.relayout(i,o,s,c))return;let l=new Ke;this.doRender$dom(l),this.current_task=l}async doRender$dom(r){let i=(d,l)=>{if(d&&!r.isCancelRequested()&&l)return l()},o=this.retrieveDOMPages().map(d=>{let{innerWidth:l,innerHeight:p}=window,y=d.getBoundingClientRect();return{inWindow:!(y.left>l||y.right<0||y.top>p||y.bottom<0),page:d}}),s=async d=>{if(await Oi(),r.isCancelRequested()){console.log("cancel stage",q.Layout,d);return}let l=o[d].page,p=l.getBoundingClientRect(),y=this.getDomViewport(window,p),M=Q=>this.docKernel.need_repaint(d,y.x,y.y,y.width,y.height,Q),A=Q=>this.docKernel.repaint(d,y.x,y.y,y.width,y.height,Q),L=Q=>{if(!r.isCancelRequested())return i(M(Q),()=>A(Q))};await L(q.Layout);let K=(p.width?Number.parseFloat(l.getAttribute("data-width"))/p.width:1)*this.domScale,z=(p.height?Number.parseFloat(l.getAttribute("data-height"))/p.height:1)*this.domScale;if(y.x*=K,y.y*=z,y.y-=100,y.width*=K,y.height*=z,y.height+=200,await L(q.Svg),await L(q.Semantics),r.isCancelRequested()){console.log("cancel stage",q.Semantics,d);return}M(q.PrepareCanvas)?(async()=>{if(await A(q.PrepareCanvas),!r.isCancelRequested())return L(q.Canvas)})():await L(q.Canvas)},c=async d=>{for(let l=0;l<o.length;++l){if(r.isCancelRequested()){console.log("cancel page",q.Layout,l);return}o[l].inWindow===d&&await s(l)}};this.cancelAnyway$dom(),await c(!0),await c(!1),!r.isCancelRequested()&&console.log("finished",q.Layout)}}}var Oi,Dt,q,et,Un=W(()=>{Te();Vn();zn();Oi=()=>new Promise(n=>requestAnimationFrame(n));(function(n){n[n.Doc=0]="Doc",n[n.Pages=1]="Pages"})(Dt||(Dt={}));(function(n){n[n.Layout=0]="Layout",n[n.Svg=1]="Svg",n[n.Semantics=2]="Semantics",n[n.PrepareCanvas=3]="PrepareCanvas",n[n.Canvas=4]="Canvas"})(q||(q={}));et=class extends $n(Bn(ye,xi)){}});function _(n){return te[n]}function v(n){ve===te.length&&te.push(te.length+1);let e=ve;if(ve=te[e],typeof ve!="number")throw new Error("corrupt heap");return te[e]=n,e}function S(n,e){try{return n.apply(this,e)}catch(t){a.__wbindgen_export_0(v(t))}}function g(n,e){try{return n.apply(this,e)}catch(t){let r=function(){try{return t instanceof Error?`${t.message}

Stack:
${t.stack}`:t.toString()}catch(i){return"<failed to stringify thrown value>"}}();throw console.error("wasm-bindgen: imported JS function that was not marked as `catch` threw an error:",r),t}}function w(n){if(typeof n!="number")throw new Error(`expected a number argument, found ${typeof n}`)}function Fe(){return(Ae===null||Ae.byteLength===0)&&(Ae=new Uint8Array(a.memory.buffer)),Ae}function C(n,e){return n=n>>>0,ir.decode(Fe().subarray(n,n+e))}function $(n,e,t){if(typeof n!="string")throw new Error(`expected a string argument, found ${typeof n}`);if(t===void 0){let c=tt.encode(n),d=e(c.length,1)>>>0;return Fe().subarray(d,d+c.length).set(c),j=c.length,d}let r=n.length,i=e(r,1)>>>0,o=Fe(),s=0;for(;s<r;s++){let c=n.charCodeAt(s);if(c>127)break;o[i+s]=c}if(s!==r){s!==0&&(n=n.slice(s)),i=t(i,r,r=s+n.length*3,1)>>>0;let c=Fe().subarray(i+s,i+r),d=Pi(n,c);if(d.read!==n.length)throw new Error("failed to pass whole string");s+=d.written,i=t(i,r,s,1)>>>0}return j=s,i}function m(){return(ae===null||ae.buffer.detached===!0||ae.buffer.detached===void 0&&ae.buffer!==a.memory.buffer)&&(ae=new DataView(a.memory.buffer)),ae}function T(n){return n==null}function D(n){if(typeof n!="boolean")throw new Error(`expected a boolean argument, found ${typeof n}`)}function Si(n){n<132||(te[n]=ve,ve=n)}function I(n){let e=_(n);return Si(n),e}function ki(n,e,t,r){let i={a:n,b:e,cnt:1,dtor:t},o=(...s)=>{i.cnt++;let c=i.a;i.a=0;try{return r(c,i.b,...s)}finally{--i.cnt===0?(a.__wbindgen_export_4.get(i.dtor)(c,i.b),nt.unregister(i)):i.a=c}};return o.original=i,nt.register(o,i,i),o}function qn(n,e,t,r){let i={a:n,b:e,cnt:1,dtor:t},o=(...s)=>{i.cnt++;try{return r(i.a,i.b,...s)}finally{--i.cnt===0&&(a.__wbindgen_export_4.get(i.dtor)(i.a,i.b),i.a=0,nt.unregister(i))}};return o.original=i,nt.register(o,i,i),o}function Wt(n){let e=typeof n;if(e=="number"||e=="boolean"||n==null)return`${n}`;if(e=="string")return`"${n}"`;if(e=="symbol"){let i=n.description;return i==null?"Symbol":`Symbol(${i})`}if(e=="function"){let i=n.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(n)){let i=n.length,o="[";i>0&&(o+=Wt(n[0]));for(let s=1;s<i;s++)o+=", "+Wt(n[s]);return o+="]",o}let t=/\[object ([^\]]+)\]/.exec(toString.call(n)),r;if(t&&t.length>1)r=t[1];else return toString.call(n);if(r=="Object")try{return"Object("+JSON.stringify(n)+")"}catch(i){return"Object"}return n instanceof Error?`${n.name}: ${n.message}
${n.stack}`:r}function rt(n,e){let t=e(n.length*1,1)>>>0;return Fe().set(n,t/1),j=n.length,t}function Ci(){return(Le===null||Le.byteLength===0)&&(Le=new Uint32Array(a.memory.buffer)),Le}function Ei(n,e){let t=e(n.length*4,4)>>>0;return Ci().set(n,t/4),j=n.length,t}function Nn(n,e){let t=e(n.length*4,4)>>>0,r=m();for(let i=0;i<n.length;i++)r.setUint32(t+4*i,v(n[i]),!0);return j=n.length,t}function Y(n,e){if(!(n instanceof e))throw new Error(`expected instance of ${e.name}`)}function Ii(){let n=a.renderer_build_info();return I(n)}function Ti(n,e,t){w(n),w(e),a.__wbindgen_export_5(n,e,v(t))}function Ri(n,e){w(n),w(e),a.__wbindgen_export_6(n,e)}function ji(n,e,t){w(n),w(e),a.__wbindgen_export_7(n,e,v(t))}function Mi(n,e,t,r){w(n),w(e),a.__wbindgen_export_8(n,e,v(t),v(r))}async function Li(n,e){if(typeof Response=="function"&&n instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(n,e)}catch(r){if(n.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",r);else throw r}let t=await n.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{let t=await WebAssembly.instantiate(n,e);return t instanceof WebAssembly.Instance?{instance:t,module:n}:t}}function or(){let n={};return n.wbg={},n.wbg.__wbg_appendChild_8204974b7328bf98=function(){return S(function(e,t){let r=_(e).appendChild(_(t));return v(r)},arguments)},n.wbg.__wbg_buffer_609cc3eee51ed158=function(){return g(function(e){let t=_(e).buffer;return v(t)},arguments)},n.wbg.__wbg_call_672a4d21634d4a24=function(){return S(function(e,t){let r=_(e).call(_(t));return v(r)},arguments)},n.wbg.__wbg_call_7cccdd69e0791ae2=function(){return S(function(e,t,r){let i=_(e).call(_(t),_(r));return v(i)},arguments)},n.wbg.__wbg_call_833bed5770ea2041=function(){return S(function(e,t,r,i){let o=_(e).call(_(t),_(r),_(i));return v(o)},arguments)},n.wbg.__wbg_call_b8adc8b1d0a0d8eb=function(){return S(function(e,t,r,i,o){let s=_(e).call(_(t),_(r),_(i),_(o));return v(s)},arguments)},n.wbg.__wbg_clearRect_8e4ba7ea0e06711a=function(){return g(function(e,t,r,i,o){_(e).clearRect(t,r,i,o)},arguments)},n.wbg.__wbg_clientWidth_ce67a04dc15fce39=function(){return g(function(e){let t=_(e).clientWidth;return w(t),t},arguments)},n.wbg.__wbg_clip_8e8cfb00a055cd03=function(){return g(function(e,t){_(e).clip(_(t))},arguments)},n.wbg.__wbg_clip_f584e320f8a2b022=function(){return g(function(e,t){_(e).clip(_(t))},arguments)},n.wbg.__wbg_cloneNode_e35b333b87d51340=function(){return S(function(e){let t=_(e).cloneNode();return v(t)},arguments)},n.wbg.__wbg_content_537e4105afcd9cee=function(){return g(function(e){let t=_(e).content;return v(t)},arguments)},n.wbg.__wbg_createElement_8c9931a732ee2fea=function(){return S(function(e,t,r){let i=_(e).createElement(C(t,r));return v(i)},arguments)},n.wbg.__wbg_createImageBitmap_705010fb21a22922=function(){return S(function(e,t){let r=_(e).createImageBitmap(_(t));return v(r)},arguments)},n.wbg.__wbg_createImageBitmap_b814e27800576bdb=function(){return S(function(e,t){let r=_(e).createImageBitmap(_(t));return v(r)},arguments)},n.wbg.__wbg_createObjectURL_6e98d2f9c7bd9764=function(){return S(function(e,t){let r=URL.createObjectURL(_(t)),i=$(r,a.__wbindgen_export_1,a.__wbindgen_export_2),o=j;m().setInt32(e+4*1,o,!0),m().setInt32(e+4*0,i,!0)},arguments)},n.wbg.__wbg_document_d249400bd7bd996d=function(){return g(function(e){let t=_(e).document;return T(t)?0:v(t)},arguments)},n.wbg.__wbg_drawImage_0915f348c5d54848=function(){return S(function(e,t,r,i){_(e).drawImage(_(t),r,i)},arguments)},n.wbg.__wbg_drawImage_16485aae76d89dbf=function(){return S(function(e,t,r,i,o,s){_(e).drawImage(_(t),r,i,o,s)},arguments)},n.wbg.__wbg_drawImage_468585e3ecfa189a=function(){return S(function(e,t,r,i,o,s){_(e).drawImage(_(t),r,i,o,s)},arguments)},n.wbg.__wbg_drawImage_472a4d5b6df3739a=function(){return S(function(e,t,r,i){_(e).drawImage(_(t),r,i)},arguments)},n.wbg.__wbg_drawImage_473e6602e24e18aa=function(){return S(function(e,t,r,i){_(e).drawImage(_(t),r,i)},arguments)},n.wbg.__wbg_drawImage_86fd8465c00c7bc6=function(){return S(function(e,t,r,i,o,s){_(e).drawImage(_(t),r,i,o,s)},arguments)},n.wbg.__wbg_drawImage_ff273710b96c85cc=function(){return S(function(e,t,r,i,o,s){_(e).drawImage(_(t),r,i,o,s)},arguments)},n.wbg.__wbg_error_7534b8e9a36f1ab4=function(){return g(function(e,t){let r,i;try{r=e,i=t,console.error(C(e,t))}finally{a.__wbindgen_export_3(r,i,1)}},arguments)},n.wbg.__wbg_fillRect_b1529535ac758d4c=function(){return g(function(e,t,r,i,o){_(e).fillRect(t,r,i,o)},arguments)},n.wbg.__wbg_fillRect_c38d5d56492a2368=function(){return g(function(e,t,r,i,o){_(e).fillRect(t,r,i,o)},arguments)},n.wbg.__wbg_fill_51814702df845abd=function(){return g(function(e,t,r){_(e).fill(_(t),Zn[r])},arguments)},n.wbg.__wbg_fill_5d26765e6d1d8f6b=function(){return g(function(e,t){_(e).fill(_(t))},arguments)},n.wbg.__wbg_fill_64902335a40baa8d=function(){return g(function(e,t,r){_(e).fill(_(t),Zn[r])},arguments)},n.wbg.__wbg_fill_cbb22e6ac4da5b1b=function(){return g(function(e,t){_(e).fill(_(t))},arguments)},n.wbg.__wbg_firstElementChild_21331181ca115bcc=function(){return g(function(e){let t=_(e).firstElementChild;return T(t)?0:v(t)},arguments)},n.wbg.__wbg_firstElementChild_d75d385f5abd1414=function(){return g(function(e){let t=_(e).firstElementChild;return T(t)?0:v(t)},arguments)},n.wbg.__wbg_getAttribute_ea5166be2deba45e=function(){return g(function(e,t,r,i){let o=_(t).getAttribute(C(r,i));var s=T(o)?0:$(o,a.__wbindgen_export_1,a.__wbindgen_export_2),c=j;m().setInt32(e+4*1,c,!0),m().setInt32(e+4*0,s,!0)},arguments)},n.wbg.__wbg_getContext_e9cf379449413580=function(){return S(function(e,t,r){let i=_(e).getContext(C(t,r));return T(i)?0:v(i)},arguments)},n.wbg.__wbg_getContext_f65a0debd1e8f8e8=function(){return S(function(e,t,r){let i=_(e).getContext(C(t,r));return T(i)?0:v(i)},arguments)},n.wbg.__wbg_get_67b2ba62fc30de12=function(){return S(function(e,t){let r=Reflect.get(_(e),_(t));return v(r)},arguments)},n.wbg.__wbg_globalCompositeOperation_154b0f30008caa5e=function(){return S(function(e,t){let r=_(t).globalCompositeOperation,i=$(r,a.__wbindgen_export_1,a.__wbindgen_export_2),o=j;m().setInt32(e+4*1,o,!0),m().setInt32(e+4*0,i,!0)},arguments)},n.wbg.__wbg_globalCompositeOperation_1f405e2ef7c5118b=function(){return S(function(e,t){let r=_(t).globalCompositeOperation,i=$(r,a.__wbindgen_export_1,a.__wbindgen_export_2),o=j;m().setInt32(e+4*1,o,!0),m().setInt32(e+4*0,i,!0)},arguments)},n.wbg.__wbg_height_d3f39e12f0f62121=function(){return g(function(e){let t=_(e).height;return w(t),t},arguments)},n.wbg.__wbg_incrdomdocclient_new=function(){return g(function(e){let t=Oe.__wrap(e);return v(t)},arguments)},n.wbg.__wbg_instanceof_CanvasRenderingContext2d_df82a4d3437bf1cc=function(){return g(function(e){let t;try{t=_(e)instanceof CanvasRenderingContext2D}catch(i){t=!1}let r=t;return D(r),r},arguments)},n.wbg.__wbg_instanceof_Element_0af65443936d5154=function(){return g(function(e){let t;try{t=_(e)instanceof Element}catch(i){t=!1}let r=t;return D(r),r},arguments)},n.wbg.__wbg_instanceof_HtmlCanvasElement_2ea67072a7624ac5=function(){return g(function(e){let t;try{t=_(e)instanceof HTMLCanvasElement}catch(i){t=!1}let r=t;return D(r),r},arguments)},n.wbg.__wbg_instanceof_HtmlDivElement_dbc6eb62eb772174=function(){return g(function(e){let t;try{t=_(e)instanceof HTMLDivElement}catch(i){t=!1}let r=t;return D(r),r},arguments)},n.wbg.__wbg_instanceof_HtmlElement_51378c201250b16c=function(){return g(function(e){let t;try{t=_(e)instanceof HTMLElement}catch(i){t=!1}let r=t;return D(r),r},arguments)},n.wbg.__wbg_instanceof_HtmlTemplateElement_7929a67c77198607=function(){return g(function(e){let t;try{t=_(e)instanceof HTMLTemplateElement}catch(i){t=!1}let r=t;return D(r),r},arguments)},n.wbg.__wbg_instanceof_ImageBitmap_d093d508663e313d=function(){return g(function(e){let t;try{t=_(e)instanceof ImageBitmap}catch(i){t=!1}let r=t;return D(r),r},arguments)},n.wbg.__wbg_instanceof_OffscreenCanvasRenderingContext2d_a070fdde7ba760a3=function(){return g(function(e){let t;try{t=_(e)instanceof OffscreenCanvasRenderingContext2D}catch(i){t=!1}let r=t;return D(r),r},arguments)},n.wbg.__wbg_instanceof_OffscreenCanvas_d55760945f91bf51=function(){return g(function(e){let t;try{t=_(e)instanceof OffscreenCanvas}catch(i){t=!1}let r=t;return D(r),r},arguments)},n.wbg.__wbg_instanceof_Promise_935168b8f4b49db3=function(){return g(function(e){let t;try{t=_(e)instanceof Promise}catch(i){t=!1}let r=t;return D(r),r},arguments)},n.wbg.__wbg_instanceof_SvgGraphicsElement_8b2cbd8116680c53=function(){return g(function(e){let t;try{t=_(e)instanceof SVGGraphicsElement}catch(i){t=!1}let r=t;return D(r),r},arguments)},n.wbg.__wbg_instanceof_SvgsvgElement_6a0d878e0d0f979c=function(){return g(function(e){let t;try{t=_(e)instanceof SVGSVGElement}catch(i){t=!1}let r=t;return D(r),r},arguments)},n.wbg.__wbg_instanceof_Window_def73ea0955fc569=function(){return g(function(e){let t;try{t=_(e)instanceof Window}catch(i){t=!1}let r=t;return D(r),r},arguments)},n.wbg.__wbg_instanceof_WorkerGlobalScope_dbdbdea7e3b56493=function(){return g(function(e){let t;try{t=_(e)instanceof WorkerGlobalScope}catch(i){t=!1}let r=t;return D(r),r},arguments)},n.wbg.__wbg_lastElementChild_1269b660ec3e6985=function(){return g(function(e){let t=_(e).lastElementChild;return T(t)?0:v(t)},arguments)},n.wbg.__wbg_length_a446193dc22c12f8=function(){return g(function(e){let t=_(e).length;return w(t),t},arguments)},n.wbg.__wbg_log_1ae1e9f741096e91=function(){return g(function(e,t){console.log(_(e),_(t))},arguments)},n.wbg.__wbg_log_c222819a41e063d3=function(){return g(function(e){console.log(_(e))},arguments)},n.wbg.__wbg_measureText_f0f078704231c37f=function(){return S(function(e,t,r){let i=_(e).measureText(C(t,r));return v(i)},arguments)},n.wbg.__wbg_new_23a2665fac83c611=function(){return g(function(e,t){try{var r={a:e,b:t},i=(s,c)=>{let d=r.a;r.a=0;try{return Mi(d,r.b,s,c)}finally{r.a=d}};let o=new Promise(i);return v(o)}finally{r.a=r.b=0}},arguments)},n.wbg.__wbg_new_2ef971087cb43792=function(){return S(function(e,t){let r=new OffscreenCanvas(e>>>0,t>>>0);return v(r)},arguments)},n.wbg.__wbg_new_405e22f390576ce2=function(){return g(function(){let e=new Object;return v(e)},arguments)},n.wbg.__wbg_new_6377da097a44ce6e=function(){return S(function(){let e=new Image;return v(e)},arguments)},n.wbg.__wbg_new_78feb108b6472713=function(){return g(function(){let e=new Array;return v(e)},arguments)},n.wbg.__wbg_new_8a6f238a6ece86ea=function(){return g(function(){let e=new Error;return v(e)},arguments)},n.wbg.__wbg_new_a12002a7f91c75be=function(){return g(function(e){let t=new Uint8Array(_(e));return v(t)},arguments)},n.wbg.__wbg_new_c68d7209be747379=function(){return g(function(e,t){let r=new Error(C(e,t));return v(r)},arguments)},n.wbg.__wbg_newnoargs_105ed471475aaf50=function(){return g(function(e,t){let r=new Function(C(e,t));return v(r)},arguments)},n.wbg.__wbg_newwithbyteoffsetandlength_d97e637ebe145a9a=function(){return g(function(e,t,r){let i=new Uint8Array(_(e),t>>>0,r>>>0);return v(i)},arguments)},n.wbg.__wbg_newwithlength_a381634e90c276d4=function(){return g(function(e){let t=new Uint8Array(e>>>0);return v(t)},arguments)},n.wbg.__wbg_newwithpathstring_e9586ab3affcd4fd=function(){return S(function(e,t){let r=new Path2D(C(e,t));return v(r)},arguments)},n.wbg.__wbg_newwithu8arraysequenceandoptions_068570c487f69127=function(){return S(function(e,t){let r=new Blob(_(e),_(t));return v(r)},arguments)},n.wbg.__wbg_nextElementSibling_8472709bec4de113=function(){return g(function(e){let t=_(e).nextElementSibling;return T(t)?0:v(t)},arguments)},n.wbg.__wbg_push_737cfc8c1432c2c6=function(){return g(function(e,t){let r=_(e).push(_(t));return w(r),r},arguments)},n.wbg.__wbg_putImageData_4c5aa10f3b3e4924=function(){return S(function(e,t,r,i){_(e).putImageData(_(t),r,i)},arguments)},n.wbg.__wbg_putImageData_6d5d5ef6ee83898b=function(){return S(function(e,t,r,i){_(e).putImageData(_(t),r,i)},arguments)},n.wbg.__wbg_queueMicrotask_97d92b4fcc8a61c5=function(){return g(function(e){queueMicrotask(_(e))},arguments)},n.wbg.__wbg_queueMicrotask_d3219def82552485=function(){return g(function(e){let t=_(e).queueMicrotask;return v(t)},arguments)},n.wbg.__wbg_removeProperty_0e85471f4dfc00ae=function(){return S(function(e,t,r,i){let o=_(t).removeProperty(C(r,i)),s=$(o,a.__wbindgen_export_1,a.__wbindgen_export_2),c=j;m().setInt32(e+4*1,c,!0),m().setInt32(e+4*0,s,!0)},arguments)},n.wbg.__wbg_remove_e2d2659f3128c045=function(){return g(function(e){_(e).remove()},arguments)},n.wbg.__wbg_renderpageimageoptions_unwrap=function(){return g(function(e){let t=_e.__unwrap(I(e));return w(t),t},arguments)},n.wbg.__wbg_replaceWith_9ce9927e3141d0f6=function(){return S(function(e,t){_(e).replaceWith(_(t))},arguments)},n.wbg.__wbg_resolve_4851785c9c5f573d=function(){return g(function(e){let t=Promise.resolve(_(e));return v(t)},arguments)},n.wbg.__wbg_restore_1ef50af0835a4649=function(){return g(function(e){_(e).restore()},arguments)},n.wbg.__wbg_restore_cc5ae2746f7b5043=function(){return g(function(e){_(e).restore()},arguments)},n.wbg.__wbg_revokeObjectURL_27267efebeb457c7=function(){return S(function(e,t){URL.revokeObjectURL(C(e,t))},arguments)},n.wbg.__wbg_save_5f563096e64939da=function(){return g(function(e){_(e).save()},arguments)},n.wbg.__wbg_save_c675a7a4bbd44e4a=function(){return g(function(e){_(e).save()},arguments)},n.wbg.__wbg_setAttribute_2704501201f15687=function(){return S(function(e,t,r,i,o){_(e).setAttribute(C(t,r),C(i,o))},arguments)},n.wbg.__wbg_setLineDash_0e3f3e194352a774=function(){return S(function(e,t){_(e).setLineDash(_(t))},arguments)},n.wbg.__wbg_setLineDash_325e094206df53e9=function(){return S(function(e,t){_(e).setLineDash(_(t))},arguments)},n.wbg.__wbg_setProperty_f2cf326652b9a713=function(){return S(function(e,t,r,i,o){_(e).setProperty(C(t,r),C(i,o))},arguments)},n.wbg.__wbg_setTransform_8c4d954cafb34b75=function(){return S(function(e,t,r,i,o,s,c){_(e).setTransform(t,r,i,o,s,c)},arguments)},n.wbg.__wbg_setTransform_da2f0baec3f09522=function(){return S(function(e,t,r,i,o,s,c){_(e).setTransform(t,r,i,o,s,c)},arguments)},n.wbg.__wbg_set_37837023f3d740e8=function(){return g(function(e,t,r){_(e)[t>>>0]=I(r)},arguments)},n.wbg.__wbg_set_65595bdd868b3009=function(){return g(function(e,t,r){_(e).set(_(t),r>>>0)},arguments)},n.wbg.__wbg_set_bb8cecf6a62b9f46=function(){return S(function(e,t,r){let i=Reflect.set(_(e),_(t),_(r));return D(i),i},arguments)},n.wbg.__wbg_setfillStyle_2205fca942c641ba=function(){return g(function(e,t,r){_(e).fillStyle=C(t,r)},arguments)},n.wbg.__wbg_setfillStyle_cb059a69ce15cc28=function(){return g(function(e,t,r){_(e).fillStyle=C(t,r)},arguments)},n.wbg.__wbg_setfont_4c3584ef2f5c9f7e=function(){return g(function(e,t,r){_(e).font=C(t,r)},arguments)},n.wbg.__wbg_setglobalCompositeOperation_9a7a92bac2fb7ffd=function(){return S(function(e,t,r){_(e).globalCompositeOperation=C(t,r)},arguments)},n.wbg.__wbg_setglobalCompositeOperation_b000e874f8f4a9d3=function(){return S(function(e,t,r){_(e).globalCompositeOperation=C(t,r)},arguments)},n.wbg.__wbg_setheight_da683a33fa99843c=function(){return g(function(e,t){_(e).height=t>>>0},arguments)},n.wbg.__wbg_setinnerHTML_31bde41f835786f7=function(){return g(function(e,t,r){_(e).innerHTML=C(t,r)},arguments)},n.wbg.__wbg_setlineCap_3a3987ad3f03b31d=function(){return g(function(e,t,r){_(e).lineCap=C(t,r)},arguments)},n.wbg.__wbg_setlineCap_52b6d742c95a5630=function(){return g(function(e,t,r){_(e).lineCap=C(t,r)},arguments)},n.wbg.__wbg_setlineDashOffset_030d80d07cd52ee4=function(){return g(function(e,t){_(e).lineDashOffset=t},arguments)},n.wbg.__wbg_setlineDashOffset_59f274962f6a0553=function(){return g(function(e,t){_(e).lineDashOffset=t},arguments)},n.wbg.__wbg_setlineJoin_79ca64e7e9efaff7=function(){return g(function(e,t,r){_(e).lineJoin=C(t,r)},arguments)},n.wbg.__wbg_setlineJoin_7e005d90ef83d627=function(){return g(function(e,t,r){_(e).lineJoin=C(t,r)},arguments)},n.wbg.__wbg_setlineWidth_3c8b7156949a9f4b=function(){return g(function(e,t){_(e).lineWidth=t},arguments)},n.wbg.__wbg_setlineWidth_ec730c524f09baa9=function(){return g(function(e,t){_(e).lineWidth=t},arguments)},n.wbg.__wbg_setmiterLimit_26162c359bb28eb2=function(){return g(function(e,t){_(e).miterLimit=t},arguments)},n.wbg.__wbg_setmiterLimit_9ffca64ec692501d=function(){return g(function(e,t){_(e).miterLimit=t},arguments)},n.wbg.__wbg_setonerror_e94ca1221abc457f=function(){return g(function(e,t){_(e).onerror=_(t)},arguments)},n.wbg.__wbg_setonload_264a0d330b7166fb=function(){return g(function(e,t){_(e).onload=_(t)},arguments)},n.wbg.__wbg_setsrc_c239193cc7ab0470=function(){return g(function(e,t,r){_(e).src=C(t,r)},arguments)},n.wbg.__wbg_setstrokeStyle_070920f27992b9a6=function(){return g(function(e,t,r){_(e).strokeStyle=C(t,r)},arguments)},n.wbg.__wbg_setstrokeStyle_415833f3f0eb5076=function(){return g(function(e,t,r){_(e).strokeStyle=C(t,r)},arguments)},n.wbg.__wbg_settype_39ed370d3edd403c=function(){return g(function(e,t,r){_(e).type=C(t,r)},arguments)},n.wbg.__wbg_setwidth_c5fed9f5e7f0b406=function(){return g(function(e,t){_(e).width=t>>>0},arguments)},n.wbg.__wbg_stack_0ed75d68575b0f3c=function(){return g(function(e,t){let r=_(t).stack,i=$(r,a.__wbindgen_export_1,a.__wbindgen_export_2),o=j;m().setInt32(e+4*1,o,!0),m().setInt32(e+4*0,i,!0)},arguments)},n.wbg.__wbg_static_accessor_GLOBAL_88a902d13a557d07=function(){return g(function(){let e=typeof globalThis=="undefined"?null:globalThis;return T(e)?0:v(e)},arguments)},n.wbg.__wbg_static_accessor_GLOBAL_THIS_56578be7e9f832b0=function(){return g(function(){let e=typeof globalThis=="undefined"?null:globalThis;return T(e)?0:v(e)},arguments)},n.wbg.__wbg_static_accessor_SELF_37c5d418e4bf5819=function(){return g(function(){let e=typeof self=="undefined"?null:self;return T(e)?0:v(e)},arguments)},n.wbg.__wbg_static_accessor_WINDOW_5de37043a91a9c40=function(){return g(function(){let e=typeof window=="undefined"?null:window;return T(e)?0:v(e)},arguments)},n.wbg.__wbg_stringify_f7ed6987935b4a24=function(){return S(function(e){let t=JSON.stringify(_(e));return v(t)},arguments)},n.wbg.__wbg_stroke_1b0348380fb5a54b=function(){return g(function(e,t){_(e).stroke(_(t))},arguments)},n.wbg.__wbg_stroke_e9b15e77122a9be9=function(){return g(function(e,t){_(e).stroke(_(t))},arguments)},n.wbg.__wbg_style_fb30c14e5815805c=function(){return g(function(e){let t=_(e).style;return v(t)},arguments)},n.wbg.__wbg_then_44b73946d2fb3e7d=function(){return g(function(e,t){let r=_(e).then(_(t));return v(r)},arguments)},n.wbg.__wbg_then_48b406749878a531=function(){return g(function(e,t,r){let i=_(e).then(_(t),_(r));return v(i)},arguments)},n.wbg.__wbg_transferToImageBitmap_4b1cc41c0f7e5de5=function(){return S(function(e){let t=_(e).transferToImageBitmap();return v(t)},arguments)},n.wbg.__wbg_typstrenderer_new=function(){return g(function(e){let t=Pe.__wrap(e);return v(t)},arguments)},n.wbg.__wbg_warn_4ca3906c248c47c4=function(){return g(function(e){console.warn(_(e))},arguments)},n.wbg.__wbg_width_2fafd30484634e26=function(){return g(function(e){return _(e).width},arguments)},n.wbg.__wbg_width_4f334fc47ef03de1=function(){return g(function(e){let t=_(e).width;return w(t),t},arguments)},n.wbg.__wbindgen_cb_drop=function(e){let t=I(e).original;if(t.cnt--==1)return t.a=0,!0;let r=!1;return D(r),r},n.wbg.__wbindgen_closure_wrapper1054=function(){return g(function(e,t,r){let i=ki(e,t,480,ji);return v(i)},arguments)},n.wbg.__wbindgen_closure_wrapper986=function(){return g(function(e,t,r){let i=qn(e,t,448,Ti);return v(i)},arguments)},n.wbg.__wbindgen_closure_wrapper987=function(){return g(function(e,t,r){let i=qn(e,t,448,Ri);return v(i)},arguments)},n.wbg.__wbindgen_debug_string=function(e,t){let r=Wt(_(t)),i=$(r,a.__wbindgen_export_1,a.__wbindgen_export_2),o=j;m().setInt32(e+4*1,o,!0),m().setInt32(e+4*0,i,!0)},n.wbg.__wbindgen_is_function=function(e){let t=typeof _(e)=="function";return D(t),t},n.wbg.__wbindgen_is_undefined=function(e){let t=_(e)===void 0;return D(t),t},n.wbg.__wbindgen_jsval_eq=function(e,t){let r=_(e)===_(t);return D(r),r},n.wbg.__wbindgen_memory=function(){let e=a.memory;return v(e)},n.wbg.__wbindgen_number_new=function(e){return v(e)},n.wbg.__wbindgen_object_clone_ref=function(e){let t=_(e);return v(t)},n.wbg.__wbindgen_object_drop_ref=function(e){I(e)},n.wbg.__wbindgen_string_get=function(e,t){let r=_(t),i=typeof r=="string"?r:void 0;var o=T(i)?0:$(i,a.__wbindgen_export_1,a.__wbindgen_export_2),s=j;m().setInt32(e+4*1,s,!0),m().setInt32(e+4*0,o,!0)},n.wbg.__wbindgen_string_new=function(e,t){let r=C(e,t);return v(r)},n.wbg.__wbindgen_throw=function(e,t){throw new Error(C(e,t))},n}function sr(n,e){return a=n.exports,ar.__wbindgen_wasm_module=e,ae=null,Le=null,Ae=null,a}function Fi(n){if(a!==void 0)return a;typeof n!="undefined"&&(Object.getPrototypeOf(n)===Object.prototype?{module:n}=n:console.warn("using deprecated parameters for `initSync()`; pass a single object instead"));let e=or();n instanceof WebAssembly.Module||(n=new WebAssembly.Module(n));let t=new WebAssembly.Instance(n,e);return sr(t,n)}async function ar(n){if(a!==void 0)return a;typeof n!="undefined"&&(Object.getPrototypeOf(n)===Object.prototype?{module_or_path:n}=n:console.warn("using deprecated parameters for the initialization function; pass a single object instead")),typeof n=="undefined"&&(n=_r("typst_ts_renderer_bg.wasm",Di.url));let e=or();(typeof n=="string"||typeof Request=="function"&&n instanceof Request||typeof URL=="function"&&n instanceof URL)&&(n=fetch(n));let{instance:t,module:r}=await Li(await n,e);return sr(t,r)}function Vt(n){_r=n}var Di,a,te,ve,ir,Ae,j,tt,Pi,ae,nt,Le,Zn,Hn,it,Gn,Oe,Yn,ce,Jn,xe,Kn,_e,er,V,tr,Xt,Qt,Pe,nr,$t,Ai,Bt,rr,Se,cr,_r,ot=W(()=>{Di={},te=new Array(128).fill(void 0);te.push(void 0,null,!0,!1);ve=te.length;ir=typeof TextDecoder!="undefined"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder!="undefined"&&ir.decode();Ae=null;j=0,tt=typeof TextEncoder!="undefined"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},Pi=typeof tt.encodeInto=="function"?function(n,e){return tt.encodeInto(n,e)}:function(n,e){let t=tt.encode(n);return e.set(t),{read:n.length,written:t.length}};ae=null;nt=typeof FinalizationRegistry=="undefined"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>{a.__wbindgen_export_4.get(n.dtor)(n.a,n.b)});Le=null;Zn=["nonzero","evenodd"],Hn=typeof FinalizationRegistry=="undefined"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>a.__wbg_createsessionoptions_free(n>>>0,1)),it=class{__destroy_into_raw(){let e=this.__wbg_ptr;return this.__wbg_ptr=0,Hn.unregister(this),e}free(){let e=this.__destroy_into_raw();a.__wbg_createsessionoptions_free(e,0)}constructor(){let e=a.createsessionoptions_new();return this.__wbg_ptr=e>>>0,Hn.register(this,this.__wbg_ptr,this),this}set format(e){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");w(this.__wbg_ptr);let t=$(e,a.__wbindgen_export_1,a.__wbindgen_export_2),r=j;a.createsessionoptions_set_format(this.__wbg_ptr,t,r)}set artifact_content(e){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");w(this.__wbg_ptr);let t=rt(e,a.__wbindgen_export_1),r=j;a.createsessionoptions_set_artifact_content(this.__wbg_ptr,t,r)}},Gn=typeof FinalizationRegistry=="undefined"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>a.__wbg_incrdomdocclient_free(n>>>0,1)),Oe=class{constructor(){throw new Error("cannot invoke `new` directly")}static __wrap(e){e=e>>>0;let t=Object.create(Oe.prototype);return t.__wbg_ptr=e,Gn.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){let e=this.__wbg_ptr;return this.__wbg_ptr=0,Gn.unregister(this),e}free(){let e=this.__destroy_into_raw();a.__wbg_incrdomdocclient_free(e,0)}bind_functions(e){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");w(this.__wbg_ptr),a.incrdomdocclient_bind_functions(this.__wbg_ptr,v(e))}relayout(e,t,r,i){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");w(this.__wbg_ptr);let o=a.incrdomdocclient_relayout(this.__wbg_ptr,e,t,r,i);return I(o)}need_repaint(e,t,r,i,o,s){try{if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");let p=a.__wbindgen_add_to_stack_pointer(-16);w(this.__wbg_ptr),w(e),w(s),a.incrdomdocclient_need_repaint(p,this.__wbg_ptr,e,t,r,i,o,s);var c=m().getInt32(p+4*0,!0),d=m().getInt32(p+4*1,!0),l=m().getInt32(p+4*2,!0);if(l)throw I(d);return c!==0}finally{a.__wbindgen_add_to_stack_pointer(16)}}repaint(e,t,r,i,o,s){try{if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");let p=a.__wbindgen_add_to_stack_pointer(-16);w(this.__wbg_ptr),w(e),w(s),a.incrdomdocclient_repaint(p,this.__wbg_ptr,e,t,r,i,o,s);var c=m().getInt32(p+4*0,!0),d=m().getInt32(p+4*1,!0),l=m().getInt32(p+4*2,!0);if(l)throw I(d);return I(c)}finally{a.__wbindgen_add_to_stack_pointer(16)}}},Yn=typeof FinalizationRegistry=="undefined"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>a.__wbg_pageinfo_free(n>>>0,1)),ce=class{constructor(){throw new Error("cannot invoke `new` directly")}static __wrap(e){e=e>>>0;let t=Object.create(ce.prototype);return t.__wbg_ptr=e,Yn.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){let e=this.__wbg_ptr;return this.__wbg_ptr=0,Yn.unregister(this),e}free(){let e=this.__destroy_into_raw();a.__wbg_pageinfo_free(e,0)}get page_off(){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");return w(this.__wbg_ptr),a.pageinfo_page_off(this.__wbg_ptr)>>>0}get width_pt(){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");return w(this.__wbg_ptr),a.pageinfo_width_pt(this.__wbg_ptr)}get height_pt(){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");return w(this.__wbg_ptr),a.pageinfo_height_pt(this.__wbg_ptr)}},Jn=typeof FinalizationRegistry=="undefined"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>a.__wbg_pagesinfo_free(n>>>0,1)),xe=class{constructor(){throw new Error("cannot invoke `new` directly")}static __wrap(e){e=e>>>0;let t=Object.create(xe.prototype);return t.__wbg_ptr=e,Jn.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){let e=this.__wbg_ptr;return this.__wbg_ptr=0,Jn.unregister(this),e}free(){let e=this.__destroy_into_raw();a.__wbg_pagesinfo_free(e,0)}get page_count(){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");return w(this.__wbg_ptr),a.pagesinfo_page_count(this.__wbg_ptr)>>>0}page_by_number(e){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");w(this.__wbg_ptr),w(e);let t=a.pagesinfo_page_by_number(this.__wbg_ptr,e);return t===0?void 0:ce.__wrap(t)}page(e){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");w(this.__wbg_ptr),w(e);let t=a.pagesinfo_page(this.__wbg_ptr,e);return ce.__wrap(t)}width(){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");return w(this.__wbg_ptr),a.pagesinfo_width(this.__wbg_ptr)}height(){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");return w(this.__wbg_ptr),a.pagesinfo_height(this.__wbg_ptr)}},Kn=typeof FinalizationRegistry=="undefined"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>a.__wbg_renderpageimageoptions_free(n>>>0,1)),_e=class{static __unwrap(e){return e instanceof _e?e.__destroy_into_raw():0}__destroy_into_raw(){let e=this.__wbg_ptr;return this.__wbg_ptr=0,Kn.unregister(this),e}free(){let e=this.__destroy_into_raw();a.__wbg_renderpageimageoptions_free(e,0)}constructor(){let e=a.renderpageimageoptions_new();return this.__wbg_ptr=e>>>0,Kn.register(this,this.__wbg_ptr,this),this}get pixel_per_pt(){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");w(this.__wbg_ptr);let e=a.renderpageimageoptions_pixel_per_pt(this.__wbg_ptr);return e===4294967297?void 0:e}set pixel_per_pt(e){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");w(this.__wbg_ptr),T(e)||w(e),a.renderpageimageoptions_set_pixel_per_pt(this.__wbg_ptr,T(e)?4294967297:Math.fround(e))}get background_color(){try{if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");let r=a.__wbindgen_add_to_stack_pointer(-16);w(this.__wbg_ptr),a.renderpageimageoptions_background_color(r,this.__wbg_ptr);var e=m().getInt32(r+4*0,!0),t=m().getInt32(r+4*1,!0);let i;return e!==0&&(i=C(e,t).slice(),a.__wbindgen_export_3(e,t*1,1)),i}finally{a.__wbindgen_add_to_stack_pointer(16)}}set background_color(e){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");w(this.__wbg_ptr);var t=T(e)?0:$(e,a.__wbindgen_export_1,a.__wbindgen_export_2),r=j;a.renderpageimageoptions_set_background_color(this.__wbg_ptr,t,r)}get page_off(){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");return w(this.__wbg_ptr),a.renderpageimageoptions_page_off(this.__wbg_ptr)>>>0}set page_off(e){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");w(this.__wbg_ptr),w(e),a.renderpageimageoptions_set_page_off(this.__wbg_ptr,e)}get cache_key(){try{if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");let r=a.__wbindgen_add_to_stack_pointer(-16);w(this.__wbg_ptr),a.renderpageimageoptions_cache_key(r,this.__wbg_ptr);var e=m().getInt32(r+4*0,!0),t=m().getInt32(r+4*1,!0);let i;return e!==0&&(i=C(e,t).slice(),a.__wbindgen_export_3(e,t*1,1)),i}finally{a.__wbindgen_add_to_stack_pointer(16)}}set cache_key(e){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");w(this.__wbg_ptr);var t=T(e)?0:$(e,a.__wbindgen_export_1,a.__wbindgen_export_2),r=j;a.renderpageimageoptions_set_cache_key(this.__wbg_ptr,t,r)}get data_selection(){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");w(this.__wbg_ptr);let e=a.renderpageimageoptions_data_selection(this.__wbg_ptr);return e===4294967297?void 0:e}set data_selection(e){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");w(this.__wbg_ptr),T(e)||w(e),a.renderpageimageoptions_set_data_selection(this.__wbg_ptr,T(e)?4294967297:e>>>0)}},er=typeof FinalizationRegistry=="undefined"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>a.__wbg_rendersession_free(n>>>0,1)),V=class{constructor(){throw new Error("cannot invoke `new` directly")}static __wrap(e){e=e>>>0;let t=Object.create(V.prototype);return t.__wbg_ptr=e,er.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){let e=this.__wbg_ptr;return this.__wbg_ptr=0,er.unregister(this),e}free(){let e=this.__destroy_into_raw();a.__wbg_rendersession_free(e,0)}get pixel_per_pt(){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");w(this.__wbg_ptr);let e=a.rendersession_pixel_per_pt(this.__wbg_ptr);return e===4294967297?void 0:e}set pixel_per_pt(e){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");w(this.__wbg_ptr),T(e)||w(e),a.rendersession_set_pixel_per_pt(this.__wbg_ptr,T(e)?4294967297:Math.fround(e))}get background_color(){try{if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");let r=a.__wbindgen_add_to_stack_pointer(-16);w(this.__wbg_ptr),a.rendersession_background_color(r,this.__wbg_ptr);var e=m().getInt32(r+4*0,!0),t=m().getInt32(r+4*1,!0);let i;return e!==0&&(i=C(e,t).slice(),a.__wbindgen_export_3(e,t*1,1)),i}finally{a.__wbindgen_add_to_stack_pointer(16)}}set background_color(e){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");w(this.__wbg_ptr);var t=T(e)?0:$(e,a.__wbindgen_export_1,a.__wbindgen_export_2),r=j;a.rendersession_set_background_color(this.__wbg_ptr,t,r)}get pages_info(){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");w(this.__wbg_ptr);let e=a.rendersession_pages_info(this.__wbg_ptr);return xe.__wrap(e)}get doc_width(){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");return w(this.__wbg_ptr),a.rendersession_doc_width(this.__wbg_ptr)}get doc_height(){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");return w(this.__wbg_ptr),a.rendersession_doc_height(this.__wbg_ptr)}source_span(e){try{if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");let s=a.__wbindgen_add_to_stack_pointer(-16);w(this.__wbg_ptr);let c=Ei(e,a.__wbindgen_export_1),d=j;a.rendersession_source_span(s,this.__wbg_ptr,c,d);var t=m().getInt32(s+4*0,!0),r=m().getInt32(s+4*1,!0),i=m().getInt32(s+4*2,!0),o=m().getInt32(s+4*3,!0);if(o)throw I(i);let l;return t!==0&&(l=C(t,r).slice(),a.__wbindgen_export_3(t,r*1,1)),l}finally{a.__wbindgen_add_to_stack_pointer(16)}}render_in_window(e,t,r,i){let o,s;try{if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");let l=a.__wbindgen_add_to_stack_pointer(-16);w(this.__wbg_ptr),a.rendersession_render_in_window(l,this.__wbg_ptr,e,t,r,i);var c=m().getInt32(l+4*0,!0),d=m().getInt32(l+4*1,!0);return o=c,s=d,C(c,d)}finally{a.__wbindgen_add_to_stack_pointer(16),a.__wbindgen_export_3(o,s,1)}}},tr=typeof FinalizationRegistry=="undefined"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>a.__wbg_rendersessionoptions_free(n>>>0,1)),Xt=class{__destroy_into_raw(){let e=this.__wbg_ptr;return this.__wbg_ptr=0,tr.unregister(this),e}free(){let e=this.__destroy_into_raw();a.__wbg_rendersessionoptions_free(e,0)}constructor(){let e=a.rendersessionoptions_new();return this.__wbg_ptr=e>>>0,tr.register(this,this.__wbg_ptr,this),this}get pixel_per_pt(){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");w(this.__wbg_ptr);let e=a.rendersession_pixel_per_pt(this.__wbg_ptr);return e===4294967297?void 0:e}set pixel_per_pt(e){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");w(this.__wbg_ptr),T(e)||w(e),a.rendersession_set_pixel_per_pt(this.__wbg_ptr,T(e)?4294967297:Math.fround(e))}get background_color(){try{if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");let r=a.__wbindgen_add_to_stack_pointer(-16);w(this.__wbg_ptr),a.rendersessionoptions_background_color(r,this.__wbg_ptr);var e=m().getInt32(r+4*0,!0),t=m().getInt32(r+4*1,!0);let i;return e!==0&&(i=C(e,t).slice(),a.__wbindgen_export_3(e,t*1,1)),i}finally{a.__wbindgen_add_to_stack_pointer(16)}}set background_color(e){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");w(this.__wbg_ptr);var t=T(e)?0:$(e,a.__wbindgen_export_1,a.__wbindgen_export_2),r=j;a.rendersessionoptions_set_background_color(this.__wbg_ptr,t,r)}get format(){try{if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");let r=a.__wbindgen_add_to_stack_pointer(-16);w(this.__wbg_ptr),a.rendersessionoptions_format(r,this.__wbg_ptr);var e=m().getInt32(r+4*0,!0),t=m().getInt32(r+4*1,!0);let i;return e!==0&&(i=C(e,t).slice(),a.__wbindgen_export_3(e,t*1,1)),i}finally{a.__wbindgen_add_to_stack_pointer(16)}}set format(e){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");w(this.__wbg_ptr);var t=T(e)?0:$(e,a.__wbindgen_export_1,a.__wbindgen_export_2),r=j;a.rendersessionoptions_set_format(this.__wbg_ptr,t,r)}},Qt=typeof FinalizationRegistry=="undefined"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>a.__wbg_typstrenderer_free(n>>>0,1)),Pe=class{static __wrap(e){e=e>>>0;let t=Object.create(Pe.prototype);return t.__wbg_ptr=e,Qt.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){let e=this.__wbg_ptr;return this.__wbg_ptr=0,Qt.unregister(this),e}free(){let e=this.__destroy_into_raw();a.__wbg_typstrenderer_free(e,0)}create_worker(e){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");w(this.__wbg_ptr);let t=a.typstrenderer_create_worker(this.__wbg_ptr,v(e));return I(t)}create_worker_bridge(){try{if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");let i=this.__destroy_into_raw(),o=a.__wbindgen_add_to_stack_pointer(-16);w(i),a.typstrenderer_create_worker_bridge(o,i);var e=m().getInt32(o+4*0,!0),t=m().getInt32(o+4*1,!0),r=m().getInt32(o+4*2,!0);if(r)throw I(t);return Se.__wrap(e)}finally{a.__wbindgen_add_to_stack_pointer(16)}}mount_dom(e,t){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");if(w(this.__wbg_ptr),Y(e,V),e.__wbg_ptr===0)throw new Error("Attempt to use a moved value");let r=a.typstrenderer_mount_dom(this.__wbg_ptr,e.__wbg_ptr,v(t));return I(r)}load_glyph_pack(e){try{if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");let i=a.__wbindgen_add_to_stack_pointer(-16);w(this.__wbg_ptr),a.typstrenderer_load_glyph_pack(i,this.__wbg_ptr,v(e));var t=m().getInt32(i+4*0,!0),r=m().getInt32(i+4*1,!0);if(r)throw I(t)}finally{a.__wbindgen_add_to_stack_pointer(16)}}render_page_to_canvas(e,t,r){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");if(w(this.__wbg_ptr),Y(e,V),e.__wbg_ptr===0)throw new Error("Attempt to use a moved value");let i=0;if(!T(r)){if(Y(r,_e),r.__wbg_ptr===0)throw new Error("Attempt to use a moved value");i=r.__destroy_into_raw()}let o=a.typstrenderer_render_page_to_canvas(this.__wbg_ptr,e.__wbg_ptr,v(t),i);return I(o)}render_svg_diff(e,t,r,i,o){let s,c;try{if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");let p=a.__wbindgen_add_to_stack_pointer(-16);if(w(this.__wbg_ptr),Y(e,V),e.__wbg_ptr===0)throw new Error("Attempt to use a moved value");a.typstrenderer_render_svg_diff(p,this.__wbg_ptr,e.__wbg_ptr,t,r,i,o);var d=m().getInt32(p+4*0,!0),l=m().getInt32(p+4*1,!0);return s=d,c=l,C(d,l)}finally{a.__wbindgen_add_to_stack_pointer(16),a.__wbindgen_export_3(s,c,1)}}svg_data(e,t){let r,i;try{if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");let y=a.__wbindgen_add_to_stack_pointer(-16);if(w(this.__wbg_ptr),Y(e,V),e.__wbg_ptr===0)throw new Error("Attempt to use a moved value");T(t)||w(t),a.typstrenderer_svg_data(y,this.__wbg_ptr,e.__wbg_ptr,T(t)?4294967297:t>>>0);var o=m().getInt32(y+4*0,!0),s=m().getInt32(y+4*1,!0),c=m().getInt32(y+4*2,!0),d=m().getInt32(y+4*3,!0),l=o,p=s;if(d)throw l=0,p=0,I(c);return r=l,i=p,C(l,p)}finally{a.__wbindgen_add_to_stack_pointer(16),a.__wbindgen_export_3(r,i,1)}}get_customs(e){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");if(w(this.__wbg_ptr),Y(e,V),e.__wbg_ptr===0)throw new Error("Attempt to use a moved value");let t=a.typstrenderer_get_customs(this.__wbg_ptr,e.__wbg_ptr);return I(t)}render_svg(e,t){try{if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");let s=a.__wbindgen_add_to_stack_pointer(-16);if(w(this.__wbg_ptr),Y(e,V),e.__wbg_ptr===0)throw new Error("Attempt to use a moved value");a.typstrenderer_render_svg(s,this.__wbg_ptr,e.__wbg_ptr,v(t));var r=m().getInt32(s+4*0,!0),i=m().getInt32(s+4*1,!0),o=m().getInt32(s+4*2,!0);if(o)throw I(i);return r!==0}finally{a.__wbindgen_add_to_stack_pointer(16)}}constructor(){let e=a.typstrenderer_new();return this.__wbg_ptr=e>>>0,Qt.register(this,this.__wbg_ptr,this),this}create_session(e){try{if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");let o=a.__wbindgen_add_to_stack_pointer(-16);w(this.__wbg_ptr);let s=0;if(!T(e)){if(Y(e,it),e.__wbg_ptr===0)throw new Error("Attempt to use a moved value");s=e.__destroy_into_raw()}a.typstrenderer_create_session(o,this.__wbg_ptr,s);var t=m().getInt32(o+4*0,!0),r=m().getInt32(o+4*1,!0),i=m().getInt32(o+4*2,!0);if(i)throw I(r);return V.__wrap(t)}finally{a.__wbindgen_add_to_stack_pointer(16)}}reset(e){try{if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");let i=a.__wbindgen_add_to_stack_pointer(-16);if(w(this.__wbg_ptr),Y(e,V),e.__wbg_ptr===0)throw new Error("Attempt to use a moved value");a.typstrenderer_reset(i,this.__wbg_ptr,e.__wbg_ptr);var t=m().getInt32(i+4*0,!0),r=m().getInt32(i+4*1,!0);if(r)throw I(t)}finally{a.__wbindgen_add_to_stack_pointer(16)}}manipulate_data(e,t,r){try{if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");let s=a.__wbindgen_add_to_stack_pointer(-16);if(w(this.__wbg_ptr),Y(e,V),e.__wbg_ptr===0)throw new Error("Attempt to use a moved value");let c=$(t,a.__wbindgen_export_1,a.__wbindgen_export_2),d=j,l=rt(r,a.__wbindgen_export_1),p=j;a.typstrenderer_manipulate_data(s,this.__wbg_ptr,e.__wbg_ptr,c,d,l,p);var i=m().getInt32(s+4*0,!0),o=m().getInt32(s+4*1,!0);if(o)throw I(i)}finally{a.__wbindgen_add_to_stack_pointer(16)}}session_from_artifact(e,t){try{if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");let s=a.__wbindgen_add_to_stack_pointer(-16);w(this.__wbg_ptr);let c=rt(e,a.__wbindgen_export_1),d=j,l=$(t,a.__wbindgen_export_1,a.__wbindgen_export_2),p=j;a.typstrenderer_session_from_artifact(s,this.__wbg_ptr,c,d,l,p);var r=m().getInt32(s+4*0,!0),i=m().getInt32(s+4*1,!0),o=m().getInt32(s+4*2,!0);if(o)throw I(i);return V.__wrap(r)}finally{a.__wbindgen_add_to_stack_pointer(16)}}},nr=typeof FinalizationRegistry=="undefined"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>a.__wbg_typstrendererbuilder_free(n>>>0,1)),$t=class{__destroy_into_raw(){let e=this.__wbg_ptr;return this.__wbg_ptr=0,nr.unregister(this),e}free(){let e=this.__destroy_into_raw();a.__wbg_typstrendererbuilder_free(e,0)}constructor(){try{let i=a.__wbindgen_add_to_stack_pointer(-16);a.typstrendererbuilder_new(i);var e=m().getInt32(i+4*0,!0),t=m().getInt32(i+4*1,!0),r=m().getInt32(i+4*2,!0);if(r)throw I(t);return this.__wbg_ptr=e>>>0,nr.register(this,this.__wbg_ptr,this),this}finally{a.__wbindgen_add_to_stack_pointer(16)}}build(){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");let e=this.__destroy_into_raw();w(e);let t=a.typstrendererbuilder_build(e);return I(t)}add_glyph_pack(e){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");w(this.__wbg_ptr);let t=a.typstrendererbuilder_add_glyph_pack(this.__wbg_ptr,v(e));return I(t)}add_raw_font(e){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");w(this.__wbg_ptr);let t=a.typstrendererbuilder_add_raw_font(this.__wbg_ptr,v(e));return I(t)}add_web_fonts(e){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");w(this.__wbg_ptr);let t=a.typstrendererbuilder_add_web_fonts(this.__wbg_ptr,v(e));return I(t)}},Ai=typeof FinalizationRegistry=="undefined"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>a.__wbg_typstworker_free(n>>>0,1)),Bt=class{constructor(){throw new Error("cannot invoke `new` directly")}__destroy_into_raw(){let e=this.__wbg_ptr;return this.__wbg_ptr=0,Ai.unregister(this),e}free(){let e=this.__destroy_into_raw();a.__wbg_typstworker_free(e,0)}manipulate_data(e,t){try{if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");let s=a.__wbindgen_add_to_stack_pointer(-16);w(this.__wbg_ptr);let c=$(e,a.__wbindgen_export_1,a.__wbindgen_export_2),d=j;a.typstworker_manipulate_data(s,this.__wbg_ptr,c,d,v(t));var r=m().getInt32(s+4*0,!0),i=m().getInt32(s+4*1,!0),o=m().getInt32(s+4*2,!0);if(o)throw I(i);return I(r)}finally{a.__wbindgen_add_to_stack_pointer(16)}}get_pages_info(){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");w(this.__wbg_ptr);let e=a.typstworker_get_pages_info(this.__wbg_ptr);return I(e)}render_canvas(e,t,r){try{if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");let c=a.__wbindgen_add_to_stack_pointer(-16);w(this.__wbg_ptr);let d=rt(e,a.__wbindgen_export_1),l=j,p=Nn(t,a.__wbindgen_export_1),y=j,M=Nn(r,a.__wbindgen_export_1),A=j;a.typstworker_render_canvas(c,this.__wbg_ptr,d,l,p,y,M,A);var i=m().getInt32(c+4*0,!0),o=m().getInt32(c+4*1,!0),s=m().getInt32(c+4*2,!0);if(s)throw I(o);return I(i)}finally{a.__wbindgen_add_to_stack_pointer(16)}}},rr=typeof FinalizationRegistry=="undefined"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>a.__wbg_workerbridge_free(n>>>0,1)),Se=class{constructor(){throw new Error("cannot invoke `new` directly")}static __wrap(e){e=e>>>0;let t=Object.create(Se.prototype);return t.__wbg_ptr=e,rr.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){let e=this.__wbg_ptr;return this.__wbg_ptr=0,rr.unregister(this),e}free(){let e=this.__destroy_into_raw();a.__wbg_workerbridge_free(e,0)}};cr=ar,_r=async function(n,e){throw new Error("Cannot import wasm module without importer: "+n+" "+e)}});var zt={};re(zt,{CreateSessionOptions:()=>it,IncrDomDocClient:()=>Oe,PageInfo:()=>ce,PagesInfo:()=>xe,RenderPageImageOptions:()=>_e,RenderSession:()=>V,RenderSessionOptions:()=>Xt,TypstRenderer:()=>Pe,TypstRendererBuilder:()=>$t,TypstWorker:()=>Bt,WorkerBridge:()=>Se,default:()=>Qi,initSync:()=>Fi,renderer_build_info:()=>Ii,setImportWasmModule:()=>Vt});var Qi,Wi,Xi,Ut=W(()=>{ot();ot();ot();Qi=cr,Wi=async function(n,e){let t=new Function("m","return import(m)"),{readFileSync:r}=await t("fs"),i=new URL(n,e);return await r(i).buffer},Xi=typeof process!="undefined"&&process.versions!=null&&process.versions.node!=null;Xi&&Vt(Wi)});var qt={};re(qt,{RenderSession:()=>Ce,TypstRendererDriver:()=>De,TypstWorker:()=>st,createTypstRenderer:()=>Bi,createTypstSvgRenderer:()=>Vi,rendererBuildInfo:()=>zi});function Bi(){return new De}function Vi(){return new De}async function zi(){return(await Promise.resolve().then(()=>(Ut(),zt))).renderer_build_info()}var Ui,Ce,ke,qi,st,$i,ur,De,Nt=W(()=>{Te();Xn();Pt();xt();Un();Ce=class{constructor(e,t){f(this,"plugin");f(this,Ui);this.plugin=e,this[k]=t}set backgroundColor(e){e!==void 0&&(this[k].background_color=e)}get backgroundColor(){return this[k].background_color}set pixelPerPt(e){e!==void 0&&(this[k].pixel_per_pt=e)}get pixelPerPt(){return this[k].pixel_per_pt}reset(){this.plugin.resetSession(this)}get doc_width(){return this[k].doc_width}get docWidth(){return this[k].doc_width}get doc_height(){return this[k].doc_height}get docHeight(){return this[k].doc_height}retrievePagesInfo(){let e=this[k].pages_info,t=[],r=e.page_count;for(let i=0;i<r;i++){let o=e.page(i);t.push({pageOffset:o.page_off,width:o.width_pt,height:o.height_pt})}return t}getSourceLoc(e){return this[k].source_span(e)}renderSvg(e){return this.plugin.renderSvg({renderSession:this,...e})}renderToSvg(e){return this.plugin.renderToSvg({renderSession:this,...e})}renderCanvas(e){return this.plugin.renderCanvas({renderSession:this,...e})}manipulateData(e){this.plugin.manipulateData({renderSession:this,...e})}renderSvgDiff(e){return this.plugin.renderSvgDiff({renderSession:this,...e})}get_source_loc(e){return this[k].source_span(e)}render_in_window(e,t,r,i){return this[k].render_in_window(e,t,r,i)}merge_delta(e){this.plugin.manipulateData({renderSession:this,action:"merge",data:e})}};Ui=k;(function(n){n[n.Delete=0]="Delete",n[n.New=1]="New",n[n.Update=2]="Update"})(ke||(ke={}));st=class{constructor(e,t){f(this,"plugin");f(this,qi);f(this,"managedCanvasElemList",new Map);f(this,"canvasCounter",Math.random());this.plugin=e,this[k]=t}manipulateData(e,t){return this[k].manipulate_data(e,t)}renderCanvas(e){let t=this.managedCanvasElemList;for(let[c,d]of t)d[0]=ke.Delete;for(let c of e){let d=c.canvas,l=d.dataset.manageId,p=ke.Update;l||(l=this.canvasCounter.toFixed(5),this.canvasCounter+=1,d.dataset.manageId=l,p=ke.New);let y=t.get(l);if(y&&y[0]!==ke.Delete)throw new Error("cannot update a canvas for two times in batch");t.set(l,[p,{...c}])}let r=Array.from(t.entries()),i=new Uint8Array(r.length),o=new Array(r.length),s=r.map(([c,[d,l]],p)=>(d||t.delete(c),i[p]=d,o[p]=l.canvas,this.plugin.canvasOptionsToRust(l)));return this[k].render_canvas(i,o,s)}async retrievePagesInfo(){let e=await this[k].get_pages_info();console.log(e);let t=[],r=e.page_count;for(let i=0;i<r;i++){let o=e.page(i);t.push({pageOffset:o.page_off,width:o.width_pt,height:o.height_pt})}return t}};qi=k;$i=n=>new pe(async e=>await n.default(e));ur=!0,De=class{constructor(){f(this,"renderer");f(this,"rendererJs")}async init(e){var r;this.rendererJs=await(((r=e==null?void 0:e.getWrapper)==null?void 0:r.call(e))||Promise.resolve().then(()=>(Ut(),zt)));let t=this.rendererJs.TypstRendererBuilder;this.renderer=await Ne(e,$i(this.rendererJs),t,{})}loadGlyphPack(e){return Promise.resolve()}createOptionsToRust(e){let t=new this.rendererJs.CreateSessionOptions;return e.format!==void 0&&(t.format=e.format),e.artifactContent!==void 0&&(t.artifact_content=e.artifactContent),t}canvasOptionsToRust(e){let t=new this.rendererJs.RenderPageImageOptions;if(e.pageOffset===void 0)throw new Error("pageOffset is required in reflexo v0.5.0");if(t.page_off=e.pageOffset,e.cacheKey!==void 0&&(t.cache_key=e.cacheKey),e.backgroundColor!==void 0&&(t.background_color=e.backgroundColor),e.pixelPerPt!==void 0&&(t.pixel_per_pt=e.pixelPerPt),e.dataSelection!==void 0){let r=0;e.dataSelection.body?r|=1<<0:e.canvas&&ur&&(ur=!1,console.warn("dataSelection.body is not set but providing canvas for body")),(e.dataSelection.text||e.dataSelection.annotation)&&console.error("dataSelection.text and dataSelection.annotation are deprecated"),e.dataSelection.semantics&&(r|=1<<3),t.data_selection=r}return t}retrievePagesInfoFromSession(e){return e.retrievePagesInfo()}renderCanvas(e){return this.withinOptionSession(e,async t=>this.renderer.render_page_to_canvas(t[k],e.canvas||void 0,this.canvasOptionsToRust(e)))}async inAnimationFrame(e){return new Promise((t,r)=>{requestAnimationFrame(()=>{try{t(e())}catch(i){r(i)}})})}async renderDisplayLayer(e,t,r){let o=e[k].pages_info.page_count,s=async(p,y)=>{let A=t[p].getContext("2d");if(!A)throw new Error("canvas context is null");return await this.renderCanvas({...r,canvas:A,renderSession:e,pageOffset:y})},c=performance.now(),d=await(async()=>{let p=[];for(let y=0;y<o;y++)p.push(await this.inAnimationFrame(()=>s(y,y)));return p})(),l=performance.now();return console.log(`display layer used: render = ${(l-c).toFixed(1)}ms`),d}renderTextLayer(e,t){let r=performance.now();e.forEach((o,s)=>{o.innerHTML=t[s].htmlSemantics[0]});let i=performance.now();console.log(`text layer used: render = ${(i-r).toFixed(1)}ms`)}async render(e){if("format"in e&&e.format!=="vector"&&["serde_json","js","ir"].includes(e.format))throw new Error(`deprecated format ${e.format}, please use vector format`);return this.renderToCanvas(e)}async renderDom(e){if("format"in e&&e.format!=="vector"&&["serde_json","js","ir"].includes(e.format))throw new Error(`deprecated format ${e.format}, please use vector format`);return this.withinOptionSession(e,async t=>{let r=new et({...e,renderMode:"dom",hookedElem:e.container,kModule:t,renderer:this});return await r.impl.mountDom(e.pixelPerPt),r})}async renderToCanvas(e){let t,r,i=e.container;i.style.visibility="hidden";let o=async(s,c)=>{try{r=await this.renderDisplayLayer(t,s,e),c()}finally{i.style.visibility="visible"}};return this.withinOptionSession(e,async s=>{var y;if(t=s,t[k].pages_info.page_count===0)throw new Error("No page found in session");if(e.pixelPerPt!==void 0&&e.pixelPerPt<=0)throw new Error("Invalid typst.RenderOptions.pixelPerPt, should be a positive number "+e.pixelPerPt);let c=e.backgroundColor;if(c!==void 0&&!/^#[0-9a-f]{6}$/.test(c))throw new Error("Invalid typst.backgroundColor color for matching ^#?[0-9a-f]{6}$ "+c);t.pixelPerPt=(y=e.pixelPerPt)!=null?y:fe.PIXEL_PER_PT,t.backgroundColor=c!=null?c:"#ffffff";let d=performance.now(),l=new Je(this.retrievePagesInfoFromSession(t),i,e),p=performance.now();console.log(`layer used: retrieve = ${(p-d).toFixed(1)}ms`),await o(l.canvasList,()=>l.resetLayout()),this.renderTextLayer(l.textLayerList,r)})}createModule(e){return Promise.resolve(new Ce(this,this.renderer.create_session(e&&this.createOptionsToRust({format:"vector",artifactContent:e}))))}async createWorkerV0(e){return new st(this,await this.renderer.create_worker(e))}workerBridge(){return this.renderer.create_worker_bridge()}renderSvg(e,t){if(e instanceof Ce||t)throw new Error("removed api, please use renderToSvg({ renderSession, container }) instead");return this.withinOptionSession(e,async r=>{let i;return e.data_selection&&(i=0,e.data_selection.body&&(i|=1<<0),e.data_selection.defs&&(i|=1<<1),e.data_selection.css&&(i|=1<<2),e.data_selection.js&&(i|=1<<3)),Promise.resolve(this.renderer.svg_data(r[k],i))})}renderSvgDiff(e){return e.window?this.renderer.render_svg_diff(e.renderSession[k],e.window.lo.x,e.window.lo.y,e.window.hi.x,e.window.hi.y):this.renderer.render_svg_diff(e.renderSession[k],0,0,1e33,1e33)}renderToSvg(e){return this.withinOptionSession(e,async t=>Promise.resolve(this.renderer.render_svg(t[k],e.container)))}getCustomV1(e){return Promise.resolve(this.renderer.get_customs(e.renderSession[k]))}resetSession(e){return this.renderer.reset(e[k])}manipulateData(e){var t;return this.renderer.manipulate_data(e.renderSession[k],(t=e.action)!=null?t:"reset",e.data)}withinOptionSession(e,t){function r(i){return"artifactContent"in i}if("renderSession"in e)return t(e.renderSession);if(r(e))return this.runWithSession(e,t);throw new Error("Invalid render options, should be one of RenderByContentOptions|RenderBySessionOptions")}async runWithSession(e,t){let r=e,i=t;t||(r=void 0,i=e);let o=this.renderer.create_session(r&&this.createOptionsToRust(r));try{let s=await i(new Ce(this,o));return o.free(),s}catch(s){throw o.free(),s}}}});var fr={};re(fr,{createGlobalRenderer:()=>gr,getGlobalRenderer:()=>lr,withGlobalRenderer:()=>Ni});function lr(){return dr?Ht:void 0}function gr(n,e){let t=Ht||n();return Zt!==void 0?Zt:Zt=(async()=>(dr=!0,await t.init(e),Ht=t))()}function Ni(n,e,t,r){let i=lr();if(i){t(i);return}gr(n,e).then(t).catch(r)}var Ht,Zt,dr,pr=W(()=>{dr=!1});var Hi={};re(Hi,{default:()=>_t});module.exports=Tr(Hi);var ut=require("obsidian");var We=require("obsidian");var U=require("@codemirror/view"),gt=require("@codemirror/state");var rn=require("@codemirror/view"),Be=require("@codemirror/language"),P=require("@lezer/highlight"),Rr="#e5c07b",Jt="#e06c75",jr="#56b6c2",Mr="#ffffff",$e="#abb2bf",lt="#7d8799",Ar="#61afef",Lr="#98c379",Kt="#d19a66",Fr="#c678dd",Dr="#21252b",en="#2c313a",tn="#282c34",dt="#353a42",Qr="#3E4451",nn="#528bff";var Wr=rn.EditorView.theme({"&":{color:$e,backgroundColor:tn},".cm-content":{caretColor:nn},".cm-cursor, .cm-dropCursor":{borderLeftColor:nn},"&.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground, .cm-selectionBackground, .cm-content ::selection":{backgroundColor:Qr},".cm-panels":{backgroundColor:Dr,color:$e},".cm-panels.cm-panels-top":{borderBottom:"2px solid black"},".cm-panels.cm-panels-bottom":{borderTop:"2px solid black"},".cm-searchMatch":{backgroundColor:"#72a1ff59",outline:"1px solid #457dff"},".cm-searchMatch.cm-searchMatch-selected":{backgroundColor:"#6199ff2f"},".cm-activeLine":{backgroundColor:"#6699ff0b"},".cm-selectionMatch":{backgroundColor:"#aafe661a"},"&.cm-focused .cm-matchingBracket, &.cm-focused .cm-nonmatchingBracket":{backgroundColor:"#bad0f847"},".cm-gutters":{backgroundColor:tn,color:lt,border:"none"},".cm-activeLineGutter":{backgroundColor:en},".cm-foldPlaceholder":{backgroundColor:"transparent",border:"none",color:"#ddd"},".cm-tooltip":{border:"none",backgroundColor:dt},".cm-tooltip .cm-tooltip-arrow:before":{borderTopColor:"transparent",borderBottomColor:"transparent"},".cm-tooltip .cm-tooltip-arrow:after":{borderTopColor:dt,borderBottomColor:dt},".cm-tooltip-autocomplete":{"& > ul > li[aria-selected]":{backgroundColor:en,color:$e}}},{dark:!0}),Xr=Be.HighlightStyle.define([{tag:P.tags.keyword,color:Fr},{tag:[P.tags.name,P.tags.deleted,P.tags.character,P.tags.propertyName,P.tags.macroName],color:Jt},{tag:[P.tags.function(P.tags.variableName),P.tags.labelName],color:Ar},{tag:[P.tags.color,P.tags.constant(P.tags.name),P.tags.standard(P.tags.name)],color:Kt},{tag:[P.tags.definition(P.tags.name),P.tags.separator],color:$e},{tag:[P.tags.typeName,P.tags.className,P.tags.number,P.tags.changed,P.tags.annotation,P.tags.modifier,P.tags.self,P.tags.namespace],color:Rr},{tag:[P.tags.operator,P.tags.operatorKeyword,P.tags.url,P.tags.escape,P.tags.regexp,P.tags.link,P.tags.special(P.tags.string)],color:jr},{tag:[P.tags.meta,P.tags.comment],color:lt},{tag:P.tags.strong,fontWeight:"bold"},{tag:P.tags.emphasis,fontStyle:"italic"},{tag:P.tags.strikethrough,textDecoration:"line-through"},{tag:P.tags.link,color:lt,textDecoration:"underline"},{tag:P.tags.heading,fontWeight:"bold",color:Jt},{tag:[P.tags.atom,P.tags.bool,P.tags.special(P.tags.variableName)],color:Kt},{tag:[P.tags.processingInstruction,P.tags.string,P.tags.inserted],color:Lr},{tag:P.tags.invalid,color:Mr}]),on=[Wr,(0,Be.syntaxHighlighting)(Xr)];var Z=require("@codemirror/commands"),un=require("@codemirror/language"),dn=require("@codemirror/autocomplete");var X=require("@codemirror/language");var sn=require("@lezer/lr"),$r={__proto__:null,true:14,false:14,none:18,auto:22,not:46,in:66,and:70,or:72,if:90,else:92,for:96,while:100,let:104,set:108,show:112,import:116,include:120,context:124,break:128,continue:132,return:136},an=sn.LRParser.deserialize({version:14,states:"-hQ`QPOOO!ZQPOOOOQO'#Cb'#CbOOQO'#Cd'#CdOOQO'#Cf'#CfOOQO'#Ch'#ChO#|QPO'#ERO!ZQPO'#CqO!ZQPO'#CrO$vQPO'#ESOOQO'#ES'#ESO'rQPO'#DTO!ZQPO'#DuO'yQPO'#DxOOQO'#ER'#EROOQO'#Dz'#DzQ`QPOOQ!{QPOOO(QQPO'#ClOOQO,59T,59TO(XQPO,59YO!ZQPO,59bO!ZQPO,59bO!ZQPO,59bO!ZQPO,59bO!ZQPO,59bO!ZQPO,59bO!ZQPO,59bO(^QPO,59]O(eQPO,59^O!ZQPO,59mO+^QPO,59oO,WQPO'#DXOOQO,59o,59oO-TQPO,5:aOOQO,5:d,5:dO-[QPO,5:dOOQO-E7x-E7xO-cQPO'#EUO-mQPO,59WOOQO'#Cp'#CpOOQO1G.t1G.tO0hQPO1G.|O0oQPO1G.|O3iQPO1G.|O3sQPO1G.|O6pQPO1G.|O6zQPO1G.|O8SQPO1G.|OOQO1G.w1G.wO:RQPO1G/XO;}QPO'#DsOOQO'#EW'#EWOOQO'#D|'#D|O=aQPO,59sOOQO,59s,59sO!ZQPO'#DYO!UQPO'#D]O!ZQPO'#D_O!UQPO'#DaO!ZQPO'#DcO!ZQPO'#DeO>^QPO'#DgO>cQPO'#DiO!ZQPO'#DkOOQO'#Dm'#DmOOQO'#Do'#DoO!ZQPO'#DqOOQO1G/{1G/{OOQO1G0O1G0OO!ZQPO'#D{O>hQPO,5:pOOQO1G.r1G.rOOQO-E7z-E7zOOQO1G/_1G/_O>pQPO,59tO>wQPO,59wO>pQPO,59yO>|QPO,59{O?RQPO,59}O@eQPO,5:POOQO,5:R,5:ROOQO,5:T,5:TOAwQPO,5:VOCZQPO,5:]ODmQPO,5:gOOQO-E7y-E7yODwQPO1G/`O!ZQPO1G/cOOQO1G/e1G/eO!ZQPO1G/gOFeQPO7+$zO>pQPO7+$}OFjQPO7+%ROOQO<<Hf<<HfOOQO<<Hi<<Hi",stateData:"HT~O!sOS!tOSPOSQOS~OSYOTYOVQOXROZSO_VOgWOhWOiWOxZO!h[O!k]O!wTO~OSYOTYOVQOXROZSO_VOgWOhWOiWO!wTO~O_bOcdOhgOigOkeOlfOmhOnhOohOphOqhOriOsjOtkO!yiO~OS!uXT!uXV!uXX!uXZ!uXg!uXx!uX!h!uX!k!uX!q!uX!w!uX!j!uX~P!{OvnOS!vXT!vXV!vXX!vXZ!vX_!vXc!vXg!vXh!vXi!vXk!vXl!vXm!vXn!vXo!vXp!vXq!vXr!vXs!vXt!vXx!vX!h!vX!k!vX!q!vX!w!vX!y!vX^!vX!j!vXa!vXy!vX}!vX!Q!vX!S!vX!U!vX!W!vX!Y!vX![!vX!^!vX!`!vX!b!vX!d!vX!f!vXz!vX~OzpO~P!ZO!jsO~P`O^!xP~P!ZO!wxO~O^!RO~P!{O_bOcdOSfaTfaVfaXfaZfagfahfaifakfalfamfanfaofapfaqfarfasfatfaxfa!hfa!kfa!qfa!wfa!yfa^fa!jfaafayfa}fa!Qfa!Sfa!Ufa!Wfa!Yfa![fa!^fa!`fa!bfa!dfa!ffazfa~OSwaTwaVwaXwaZwagwaxwa!hwa!kwa!qwa!wwa!jwa~P!{Oy!XO}!YO!Q!ZO!S![O!U!]O!W!^O!Y!_O![!`O!^!aO!`!bO!b!cO!d!dO!f!eO~P!ZO!h!fO~P!{O!j!gO~P`Oa!hO^!xX~P!{O^!jO~O_bOcdOSjiTjiVjiXjiZjigjihjiijiljimjinjiojipjiqjirjisjitjixji!hji!kji!qji!wji!yji^ji!jjiajiyji}ji!Qji!Sji!Uji!Wji!Yji![ji!^ji!`ji!bji!dji!fjizji~Okji~P-rOkeO~P-rO_bOcdOkeOlfOSjiTjiVjiXjiZjigjimjinjiojipjiqjirjisjitjixji!hji!kji!qji!wji!yji^ji!jjiajiyji}ji!Qji!Sji!Uji!Wji!Yji![ji!^ji!`ji!bji!dji!fjizji~Ohjiiji~P0vOhgOigO~P0vO_bOcdOhgOigOkeOlfOmhOnhOohOphOqhOSjiTjiVjiXjiZjigjisjitjixji!hji!kji!qji!wji^ji!jjiajiyji}ji!Qji!Sji!Uji!Wji!Yji![ji!^ji!`ji!bji!dji!fjizji~Orji!yji~P3}OriO!yiO~P3}O_bOcdOhgOigOkeOlfOmhOnhOohOphOqhOriOsjO!yiO~OSjiTjiVjiXjiZjigjitjixji!hji!kji!qji!wji^ji!jjiajiyji}ji!Qji!Sji!Uji!Wji!Yji![ji!^ji!`ji!bji!dji!fjizji~P7UOSuiTuiVuiXuiZuiguixui!hui!kui!qui!wui^ui!juiauiyui}ui!Qui!Sui!Uui!Wui!Yui![ui!^ui!`ui!bui!dui!fuizui~P!{OS!gXT!gXV!gXX!gXZ!gXg!gXy!gX}!gX!Q!gX!S!gX!U!gX!W!gX!Y!gX![!gX!^!gX!`!gX!b!gX!d!gX!f!gX!w!gX~P!{Oy!lO}!YO!Q!ZO!S![O!U!]O!W!^O!Y!_O![!`O!^!aO!`!bO!b!cO!d!dO!f!eO~P!ZOT!sO~OT!tO~Oa!hO^!xa~OzpO~P!{Oq!zO~Ov!|O~OS!VaT!VaV!VaX!VaZ!Vag!Vay!Va}!Va!Q!Va!S!Va!U!Va!W!Va!Y!Va![!Va!^!Va!`!Va!b!Va!d!Va!f!Va!w!Va~P!{OS!XaT!XaV!XaX!XaZ!Xag!Xay!Xa}!Xa!Q!Xa!S!Xa!U!Xa!W!Xa!Y!Xa![!Xa!^!Xa!`!Xa!b!Xa!d!Xa!f!Xa!w!Xa~P!{OS!_aT!_aV!_aX!_aZ!_ag!_ay!_a}!_a!Q!_a!S!_a!U!_a!W!_a!Y!_a![!_a!^!_a!`!_a!b!_a!d!_a!f!_a!w!_a~P!{OS!eaT!eaV!eaX!eaZ!eag!eay!ea}!ea!Q!ea!S!ea!U!ea!W!ea!Y!ea![!ea!^!ea!`!ea!b!ea!d!ea!f!ea!w!ea~P!{O^!oaa!oa~P!{O!O!}OS|iT|iV|iX|iZ|i_|ig|ih|ii|iy|i}|i!Q|i!S|i!U|i!W|i!Y|i![|i!^|i!`|i!b|i!d|i!f|i!w|i~OzpO~OS!TqT!TqV!TqX!TqZ!Tqg!Tqy!Tq}!Tq!Q!Tq!S!Tq!U!Tq!W!Tq!Y!Tq![!Tq!^!Tq!`!Tq!b!Tq!d!Tq!f!Tq!w!Tq~P!{OSc!w!s!t!w~",goto:"(T!{PPPPPP!|P!|P!|P#m!|PP$dP!|P%P!|!|PPP!|PPPPPPPPPP!|P%SPPP%Y%iPP%iP%iP%iP%iP%iP%iP%iP%iP%iP%iP%iP%iP%SPP%SP%m%w%}PPPP&T&ZP'|P(P!]YOPVWZ[]`befghijknpt!W!Y![!^!_!b!e!h!z!|![XOPVWZ[]`befghijknpt!W!Y![!^!_!b!e!h!z!|Q!n!ZR!p!]!TcUalmorvz{|}!O!P!Q!S!T!m!o!q!r!u!v!w#O#PRydX^O]`tQqZQ!y!mQ!{!oQ#Q!}R#R#OT!Up!WQ`OQt]Tu`tQ!ivR!x!iQ!WpR!k!WX_O]`tWUO]`tQaPQlVQmWQoZQr[QvbQzeQ{fQ|gQ}hQ!OiQ!PjQ!QkQ!SnS!Tp!WQ!m!YQ!o![Q!q!^Q!r!_Q!u!bQ!v!eQ!w!hQ#O!zR#P!|RwbT!Vp!W",nodeNames:"\u26A0 LineComment BlockComment Document Number String Boolean BooleanLiteral None NoneLiteral Auto AutoLiteral VariableName FunctionCall ) ( ArgList , MemberExpression . PropertyName ParenthesizedExpression UnaryExpression not + - BinaryExpression ^ % < <= > >= in == and or AssignmentExpression = CodeBlock # } { Block IfStatement if else ForStatement for WhileStatement while LetStatement let SetStatement set ShowStatement show ImportStatement import IncludeStatement include ContextStatement context BreakStatement break ContinueStatement continue ReturnStatement return ExpressionStatement $ MathBlock ] [ ContentBlock SingleExpression",maxTerm:88,nodeProps:[["openedBy",14,"(",41,"{",72,"["],["closedBy",15,")",42,"}",73,"]"]],skippedNodes:[0,1,2],repeatNodeCount:3,tokenData:"4U~R!QXY$XYZ$y]^$ypq$Xqr%Ors%Zst&}tu'Suv'Xwx'^xy({yz)Q{|)V|})[}!O)a!O!P)f!P!Q-T!Q![.|!^!_/w!_!`0U!`!a0c!c!}0p!}#O1b#P#Q1g#Q#R1l#R#S0p#T#o0p#o#p1q#q#r1v$f$g$X$g#BY0p#BY#BZ1{#BZ$IS0p$IS$I_1{$I_$I|0p$I|$I}3h$I}$JO3h$JO$JT0p$JT$JU1{$JU$KV0p$KV$KW1{$KW&FU0p&FU&FV1{&FV;'S0p;'S;=`1[<%l?HT0p?HT?HU1{?HUO0p~$^X!s~XY$Xpq$X$f$g$X#BY#BZ$X$IS$I_$X$JT$JU$X$KV$KW$X&FU&FV$X?HT?HU$X~%OO!t~~%RP!_!`%U~%ZO!y~~%^WOY%ZZr%Zrs%vs#O%Z#O#P%{#P;'S%Z;'S;=`&w<%lO%Z~%{OT~~&ORO;'S%Z;'S;=`&X;=`O%Z~&[XOY%ZZr%Zrs%vs#O%Z#O#P%{#P;'S%Z;'S;=`&w;=`<%l%Z<%lO%Z~&zP;=`<%l%Z~'SOx~~'XO!h~~'^Ol~~'aWOY'^Zw'^wx%vx#O'^#O#P'y#P;'S'^;'S;=`(u<%lO'^~'|RO;'S'^;'S;=`(V;=`O'^~(YXOY'^Zw'^wx%vx#O'^#O#P'y#P;'S'^;'S;=`(u;=`<%l'^<%lO'^~(xP;=`<%l'^~)QO_~~)VO^~~)[Oh~~)aOa~~)fOi~~)kPc~!Q![)n~)sZS~uv*f!Q![)n!g!h*k#V#W+r#W#X+x#X#Y,t#Y#Z,U#]#^,[#a#b+r#d#e,b#f#g,h~*kOS~~*nR{|*w}!O*w!Q![*}~*zP!Q![*}~+SYS~uv*f!Q![*}#V#W+r#W#X+x#X#Y+r#Y#Z,U#]#^,[#a#b+r#d#e,b#f#g,h~+uP#a#b*f~+{P#X#Y,O~,RP#Z#[*f~,XP#f#g*f~,_P#b#c*f~,eP#h#i*f~,kP#T#U,n~,qP#W#X*f~,wS{|*w}!O*w!Q![*}#a#b*f~-WQz{-^!P!Q.e~-aTOz-^z{-p{;'S-^;'S;=`._<%lO-^~-sVOz-^z{-p{!P-^!P!Q.Y!Q;'S-^;'S;=`._<%lO-^~._OQ~~.bP;=`<%l-^~.jSP~OY.eZ;'S.e;'S;=`.v<%lO.e~.yP;=`<%l.e~/R[S~uv*f!O!P)n!Q![.|!g!h*k#V#W+r#W#X+x#X#Y,t#Y#Z,U#]#^,[#a#b+r#d#e,b#f#g,h~/|Pm~!_!`0P~0UOn~~0ZPv~!_!`0^~0cOr~~0hPo~!_!`0k~0pOp~~0uV!w~!Q![0p!c!}0p#R#S0p#T#o0p$g;'S0p;'S;=`1[<%lO0p~1_P;=`<%l0p~1gO!k~~1lO!j~~1qOk~~1vOz~~1{Oy~~2Sf!w~!s~XY$Xpq$X!Q![0p!c!}0p#R#S0p#T#o0p$f$g$X$g#BY0p#BY#BZ1{#BZ$IS0p$IS$I_1{$I_$JT0p$JT$JU1{$JU$KV0p$KV$KW1{$KW&FU0p&FU&FV1{&FV;'S0p;'S;=`1[<%l?HT0p?HT?HU1{?HUO0p~3oV!w~!t~!Q![0p!c!}0p#R#S0p#T#o0p$g;'S0p;'S;=`1[<%lO0p",tokenizers:[0],topRules:{Document:[0,3],SingleExpression:[1,75]},specialized:[{term:85,get:n=>$r[n]||-1}],tokenPrec:1792});var h=require("@lezer/highlight"),cn=(0,h.styleTags)({if:h.tags.keyword,else:h.tags.keyword,for:h.tags.keyword,in:h.tags.keyword,while:h.tags.keyword,break:h.tags.keyword,continue:h.tags.keyword,return:h.tags.keyword,let:h.tags.keyword,set:h.tags.keyword,show:h.tags.keyword,import:h.tags.keyword,include:h.tags.keyword,context:h.tags.keyword,not:h.tags.keyword,and:h.tags.keyword,or:h.tags.keyword,BooleanLiteral:h.tags.bool,NoneLiteral:h.tags.null,AutoLiteral:h.tags.atom,Number:h.tags.number,String:h.tags.string,VariableName:h.tags.variableName,PropertyName:h.tags.propertyName,"=":h.tags.operator,"==":h.tags.operator,"<":h.tags.operator,"<=":h.tags.operator,">":h.tags.operator,">=":h.tags.operator,"+":h.tags.operator,"-":h.tags.operator,"%":h.tags.operator,"^":h.tags.operator,"(":h.tags.paren,")":h.tags.paren,"[":h.tags.paren,"]":h.tags.paren,"{":h.tags.paren,"}":h.tags.paren,".":h.tags.punctuation,",":h.tags.punctuation,";":h.tags.punctuation,":":h.tags.punctuation,"#":h.tags.special(h.tags.punctuation),$:h.tags.special(h.tags.punctuation),"=>":h.tags.operator,"..":h.tags.operator,LineComment:h.tags.lineComment,BlockComment:h.tags.blockComment,Block:h.tags.brace,ContentBlock:h.tags.squareBracket,CodeBlock:h.tags.special(h.tags.brace),MathBlock:h.tags.special(h.tags.squareBracket),IfStatement:h.tags.controlKeyword,ForStatement:h.tags.controlKeyword,WhileStatement:h.tags.controlKeyword,BreakStatement:h.tags.controlKeyword,ContinueStatement:h.tags.controlKeyword,ReturnStatement:h.tags.controlKeyword,LetStatement:h.tags.definitionKeyword,SetStatement:h.tags.keyword,ShowStatement:h.tags.keyword,ImportStatement:h.tags.moduleKeyword,IncludeStatement:h.tags.moduleKeyword,ContextStatement:h.tags.keyword,FunctionCall:h.tags.function(h.tags.variableName),MemberExpression:h.tags.propertyName,UnaryExpression:h.tags.operator,BinaryExpression:h.tags.operator,AssignmentExpression:h.tags.operator});var Br=X.LRLanguage.define({parser:an.configure({props:[X.indentNodeProp.add({Block:(0,X.delimitedIndent)({closing:"}",align:!1}),ContentBlock:(0,X.delimitedIndent)({closing:"]",align:!1}),ArgList:(0,X.delimitedIndent)({closing:")",align:!1}),"IfStatement ForStatement WhileStatement":n=>n.column(n.node.from)+n.unit}),X.foldNodeProp.add({Block:X.foldInside,ContentBlock:X.foldInside,ArgList:X.foldInside,"IfStatement ForStatement WhileStatement":X.foldInside}),cn]}),languageData:{name:"typst",extensions:[".typ"],commentTokens:{line:"//",block:{open:"/*",close:"*/"}},indentOnInput:/^\s*[}\]\)]$/,closeBrackets:{brackets:["(","[","{",'"',"'"]}}});function _n(){return new X.LanguageSupport(Br)}var ze=require("@codemirror/search"),Ve=class{constructor(e,t,r){this.editorView=null;this.content="";this.container=e,this.app=t,this.onContentChange=r}initialize(e=""){this.content=e,this.createEditor()}createEditor(){this.container.empty();let e=this.container.createDiv("typst-editor-container"),t=document.body.classList.contains("theme-dark"),r=[(0,U.lineNumbers)(),(0,U.dropCursor)(),(0,U.rectangularSelection)(),(0,U.highlightActiveLine)(),(0,Z.history)(),U.EditorView.lineWrapping,_n(),(0,un.bracketMatching)(),(0,dn.closeBrackets)(),(0,ze.highlightSelectionMatches)(),gt.EditorState.allowMultipleSelections.of(!0),U.keymap.of([Z.indentWithTab,...Z.historyKeymap,...Z.defaultKeymap,...ze.searchKeymap]),...t?[on]:[],U.EditorView.updateListener.of(i=>{i.docChanged&&(this.content=i.state.doc.toString(),this.onContentChange&&this.onContentChange(this.content))})];this.editorView=new U.EditorView({state:gt.EditorState.create({doc:this.content,extensions:r}),parent:e})}getContent(){return this.editorView?this.editorView.state.doc.toString():this.content}setContent(e){if(this.editorView){let t=this.editorView.state.update({changes:{from:0,to:this.editorView.state.doc.length,insert:e}});this.editorView.dispatch(t)}this.content=e}focus(){var e;(e=this.editorView)==null||e.focus()}undo(){return this.editorView?(0,Z.undo)(this.editorView):!1}redo(){return this.editorView?(0,Z.redo)(this.editorView):!1}destroy(){this.editorView&&(this.editorView.destroy(),this.editorView=null)}};var Gt=require("obsidian");pt();var ge=class{constructor(){f(this,"mTimes",new Map);f(this,"mData",new Map)}reset(){this.mTimes.clear(),this.mData.clear()}insertFile(e,t,r){this.mTimes.set(e,r),this.mData.set(e,t)}removeFile(e){this.mTimes.delete(e),this.mData.delete(e)}getMTime(e){if(e.startsWith("/@memory/")&&this.mTimes.has(e))return this.mTimes.get(e)}isFile(){return!0}getRealPath(e){return e}readAll(e){if(e.startsWith("/@memory/")&&this.mData.has(e))return this.mData.get(e)}};var Ie=class{constructor(e){f(this,"am");f(this,"cache",new Map);this.am=e}resolvePath(e){return`https://packages.typst.org/preview/${e.name}-${e.version}.tar.gz`}pullPackageData(e){let t=new XMLHttpRequest;if(t.overrideMimeType("text/plain; charset=x-user-defined"),t.open("GET",this.resolvePath(e),!1),t.send(null),t.status===200&&(t.response instanceof String||typeof t.response=="string"))return Uint8Array.from(t.response,r=>r.charCodeAt(0))}resolve(e,t){if(e.namespace!=="preview")return;let r=this.resolvePath(e);if(this.cache.has(r))return this.cache.get(r)();let i=this.pullPackageData(e);if(!i)return;let o=`/@memory/fetch/packages/preview/${e.namespace}/${e.name}/${e.version}`,s=[];t.untar(i,(d,l,p)=>{s.push([o+"/"+d,l,new Date(p)])});let c=()=>{for(let[d,l,p]of s)this.am.insertFile(d,l,p);return o};return this.cache.set(r,c),c()}};function fn(n){return Math.random().toString(36).replace("0.",n||"")}var Zi=typeof process!="undefined"&&process.versions!=null&&process.versions.node!=null,N=class{constructor(e){f(this,"mainFilePath");f(this,"cc");f(this,"ex");f(this,"providers");f(this,"ccOptions");f(this,"exOptions");f(this,"prepareUseOnce");this.cc=(e==null?void 0:e.compiler)||N.buildLocalCompiler,this.ex=(e==null?void 0:e.renderer)||N.buildLocalRenderer,this.mainFilePath="/main.typ",this.providers=[]}setCompiler(e){this.cc=e}async getCompiler(){return typeof this.cc=="function"?this.cc=await this.cc():this.cc}setRenderer(e){this.ex=e}async getRenderer(){return typeof this.ex=="function"?this.ex=await this.ex():this.ex}use(...e){if(!this.providers)throw new Error("already prepare uses for instances");this.providers.push(...e)}static preloadFontFromUrl(e){return N.preloadFonts([e])}static preloadFontData(e){return N.preloadFonts([e])}static preloadFonts(e){return{key:"access-model",forRoles:["compiler"],provides:[le(e)]}}static disableDefaultFontAssets(){return{key:"access-model",forRoles:["compiler"],provides:[ln()]}}static preloadFontAssets(e){return{key:"access-model",forRoles:["compiler"],provides:[gn(e)]}}static withAccessModel(e){return{key:"access-model",forRoles:["compiler"],provides:[ft(e)]}}static withPackageRegistry(e){return{key:"package-registry",forRoles:["compiler"],provides:[Ue(e)]}}static fetchPackageRegistry(e){let t=e||new ge,r=[...e?[]:[ft(t)],Ue(new Ie(t))];return{key:"package-registry$fetch",forRoles:["compiler"],provides:r}}static fetchPackageBy(e,t){class r extends Ie{pullPackageData(o){return t(o,this.resolvePath(o))}}return{key:"package-registry$lambda",forRoles:["compiler"],provides:[Ue(new r(e))]}}setCompilerInitOptions(e){this.requireIsUninitialized("compiler",this.cc),this.ccOptions=e}setRendererInitOptions(e){this.requireIsUninitialized("renderer",this.ex),this.exOptions=e}setMainFilePath(e){this.mainFilePath=e}getMainFilePath(){return this.mainFilePath}removeTmp(e){return e.mainFilePath.startsWith("/tmp/")?this.unmapShadow(e.mainFilePath):Promise.resolve()}async addSource(e,t){(await this.getCompiler()).addSource(e,t)}async resetShadow(){(await this.getCompiler()).resetShadow()}async mapShadow(e,t){(await this.getCompiler()).mapShadow(e,t)}async unmapShadow(e){(await this.getCompiler()).unmapShadow(e)}async vector(e){let t=await this.getCompileOptions(e);return(await this.getCompiler()).compile(t).then(r=>r.result).finally(()=>this.removeTmp(t))}async pdf(e){let t=await this.getCompileOptions(e);return t.format="pdf",(await this.getCompiler()).compile(t).then(r=>r.result).finally(()=>this.removeTmp(t))}async svg(e){return this.transientRender(e,(t,r)=>t.renderSvg({...e,renderSession:r}))}async canvas(e,t){return this.transientRender(t,(r,i)=>r.renderToCanvas({container:e,...t,renderSession:i}))}async query(e){let t=await this.getCompileOptions(e);return(await this.getCompiler()).query({...e,...t}).finally(()=>this.removeTmp(t))}async getSemanticTokenLegend(){return(await this.getCompiler()).getSemanticTokenLegend()}async getSemanticTokens(e){let t=await this.getCompileOptions(e);return(await this.getCompiler()).getSemanticTokens({mainFilePath:t.mainFilePath,resultId:e.resultId}).finally(()=>this.removeTmp(t))}async getCompileOptions(e){if(e===void 0)return{mainFilePath:this.mainFilePath,diagnostics:"none"};if(typeof e=="string")throw new Error("please specify opts as {mainContent: '...'} or {mainFilePath: '...'}");if("mainFilePath"in e)return{...e,diagnostics:"none"};{let t=`/tmp/${fn()}.typ`;return await this.addSource(t,e.mainContent),{mainFilePath:t,inputs:e.inputs,diagnostics:"none"}}}async getVector(e){if(e&&"vectorData"in e)return e.vectorData;let t=await this.getCompileOptions(e);return(await this.getCompiler()).compile(t).then(r=>r.result).finally(()=>this.removeTmp(t))}async transientRender(e,t){let r=await this.getRenderer();if(!r)throw new Error("does not provide renderer instance");let i=await this.getVector(e);return await r.runWithSession(async o=>(r.manipulateData({renderSession:o,action:"reset",data:i}),t(r,o)))}async prepareUse(){return this.prepareUseOnce?this.prepareUseOnce:this.prepareUseOnce=this.doPrepareUse()}async doPrepareUse(){if(!this.providers)return;let e=await Promise.all(this.providers.map(c=>typeof c=="function"?c():c));if(this.providers=[],ue==this&&!e.some(c=>c.key.includes("package-registry")||c.key.includes("access-model")))if(Zi){let c=new Function("m","return import(m)");try{let d=new ge,{default:l}=await c("sync-request");ue.use(N.withAccessModel(d),N.fetchPackageBy(d,(p,y)=>{let M=l("GET",y);if(M.statusCode===200)return M.getBody(void 0)}))}catch(d){}}else ue.use(N.fetchPackageRegistry());let t=await Promise.all(this.providers.map(c=>typeof c=="function"?c():c)),r=this.ccOptions||(this.ccOptions={}),i=r.beforeBuild||(r.beforeBuild=[]),o=this.exOptions||(this.exOptions={}),s=o.beforeBuild||(o.beforeBuild=[]);for(let c of[...e,...t])c.forRoles.includes("compiler")&&(this.requireIsUninitialized("compiler",this.cc),i.push(...c.provides)),c.forRoles.includes("renderer")&&(this.requireIsUninitialized("renderer",this.ex),s.push(...c.provides));this.providers=void 0}requireIsUninitialized(e,t,r){if(t&&typeof t!="function")throw new Error(`${e} has been initialized: ${t}`)}static async buildLocalCompiler(){let{createTypstCompiler:e}=await Promise.resolve().then(()=>(At(),jt));await this.prepareUse();let t=e();return await t.init(this.ccOptions),t}static async buildGlobalCompiler(){let{createGlobalCompiler:e}=await Promise.resolve().then(()=>(Wn(),Qn)),{createTypstCompiler:t}=await Promise.resolve().then(()=>(At(),jt));return await this.prepareUse(),e(t,this.ccOptions)}static async buildLocalRenderer(){let{createTypstRenderer:e}=await Promise.resolve().then(()=>(Nt(),qt));await this.prepareUse();let t=e();return await t.init(this.exOptions),t}static async buildGlobalRenderer(){let{createGlobalRenderer:e}=await Promise.resolve().then(()=>(pr(),fr)),{createTypstRenderer:t}=await Promise.resolve().then(()=>(Nt(),qt));return await this.prepareUse(),e(t,this.exOptions)}},ue=new N({compiler:N.buildGlobalCompiler,renderer:N.buildGlobalRenderer});var wr='<svg xmlns="http://www.w3.org/2000/svg" xml:space="preserve" viewBox="0 0 700 700"><path d="M367.7 477.4c0 25.2 3.6 42.1 10.9 50.7 7.3 8.6 20.7 12.9 40.2 12.9 19.5 0 44.9-9.9 76-29.8l19.9 32.8c-58.3 48.4-106.3 72.5-144.1 72.5s-67.6-9.1-89.4-27.3c-21.9-18.2-32.8-50.5-32.8-96.9V232h-49.7l-8-36.8 57.6-17.9v-48.7L367.5 74v109.3l117.2-8.9L474 239l-106.3-4v242.4z" fill="currentColor"/></svg>',hr="https://cdn.jsdelivr.net/npm/@myriaddreamin/typst-ts-web-compiler/pkg/typst_ts_web_compiler_bg.wasm",br="https://cdn.jsdelivr.net/npm/@myriaddreamin/typst-ts-renderer/pkg/typst_ts_renderer_bg.wasm";var Ee=class{constructor(){this.initialized=!1}static getInstance(){return Ee.instance||(Ee.instance=new Ee),Ee.instance}async ensureInitialized(){if(!this.initialized)try{ue.setCompilerInitOptions({getModule:()=>hr}),ue.setRendererInitOptions({getModule:()=>br}),this.initialized=!0}catch(e){throw console.error("Failed to initialize Typst compiler:",e),new Gt.Notice("Failed to initialize Typst compiler."),e}}async compileToSvg(e,t){try{await this.ensureInitialized();let r=this.getThemeTextColor(),i=e;return t.useDefaultLayoutFunctions&&(i=t.customLayoutFunctions+`
`+e),i=i.replace(/%THEMECOLOR%/g,r),await ue.svg({mainContent:i})}catch(r){return console.error("Typst compilation failed:",r),new Gt.Notice("Typst compilation failed."),null}}getThemeTextColor(){let t=getComputedStyle(document.body).getPropertyValue("--text-normal").trim();return t?t.startsWith("#")?t.slice(1):t:"ffffff"}destroy(){this.initialized=!1}},Qe=Ee;Qe.instance=null;var J=class extends We.TextFileView{constructor(t,r){super(t);this.currentMode="source";this.modeIconContainer=null;this.typstEditor=null;this.fileContent="";this.plugin=r,this.currentMode=r.settings.defaultMode}getViewType(){return"typst-view"}getDisplayText(){var t;return((t=this.file)==null?void 0:t.basename)||"Typst File"}getIcon(){return"typst-file"}async onOpen(){await super.onOpen(),this.addModeIcon(),this.applySettings()}onResize(){super.onResize(),this.applySettings()}applySettings(){this.plugin.settings.editorReadableWidth?this.containerEl.addClass("typst-readable-width"):this.containerEl.removeClass("typst-readable-width")}onClose(){return this.cleanupEditor(),super.onClose()}addModeIcon(){let t=this.containerEl.querySelector(".view-actions");t&&(this.modeIconContainer=t.createDiv("clickable-icon"),this.modeIconContainer.addClass("view-action"),this.modeIconContainer.addEventListener("click",()=>{this.toggleMode()}),this.updateModeIcon())}async toggleMode(){this.currentMode==="source"?await this.switchToReadingMode():this.switchToSourceMode()}getCurrentMode(){return this.currentMode}async recompileIfInReadingMode(){if(this.currentMode==="reading"){let t=await this.compile();t&&this.showReadingMode(t)}}async switchToReadingMode(){let t=await this.compile();t&&(this.setMode("reading"),this.showReadingMode(t))}switchToSourceMode(){this.setMode("source"),this.showSourceMode()}setMode(t){this.currentMode=t,this.updateModeIcon()}async compile(){let t=this.getViewData();return await Qe.getInstance().compileToSvg(t,this.plugin.settings)}updateModeIcon(){this.modeIconContainer&&(this.modeIconContainer.empty(),this.currentMode==="source"?((0,We.setIcon)(this.modeIconContainer,"pencil-line"),this.modeIconContainer.setAttribute("aria-label","Currently in source mode. Click to switch to reading mode.")):((0,We.setIcon)(this.modeIconContainer,"book-open"),this.modeIconContainer.setAttribute("aria-label","Currently in reading mode. Click to switch to source mode.")))}async setViewData(t,r){this.fileContent=t,this.currentMode==="source"?this.showSourceMode():await this.loadReadingMode(t)}async loadReadingMode(t){let r=await this.compile();r?this.showReadingMode(r):(this.setMode("source"),this.showSourceMode())}getViewData(){return this.currentMode==="source"&&this.typstEditor?this.typstEditor.getContent():this.fileContent}getContentElement(){return this.containerEl.querySelector(".view-content")}cleanupEditor(){this.typstEditor&&(this.typstEditor.destroy(),this.typstEditor=null)}showSourceMode(){let t=this.getContentElement();t&&(t.empty(),this.cleanupEditor(),this.typstEditor=new Ve(t,this.app,r=>{this.fileContent=r,this.requestSave()}),this.typstEditor.initialize(this.fileContent))}showReadingMode(t){let r=this.getContentElement();if(!r)return;r.empty(),this.cleanupEditor();let i=r.createDiv("typst-reading-mode");i.innerHTML=`
      <div class="typst-rendered-content">
        ${t}
      </div>
    `}clear(){this.fileContent="",this.typstEditor&&this.typstEditor.setContent("")}};var mr=require("obsidian");var H=require("obsidian"),at=class extends H.Modal{constructor(t,r){super(t);this.fileName="";this.plugin=r}onOpen(){let{contentEl:t}=this;t.empty(),t.createEl("h2",{text:"Create New Typst File"}),new H.Setting(t).setName("File name").setDesc("Enter the name of the Typst file (without .typ extension)").addText(s=>{s.setPlaceholder("note").setValue(this.fileName).onChange(c=>{this.fileName=c}),s.inputEl.focus(),s.inputEl.select(),s.inputEl.addEventListener("keydown",c=>{c.key==="Enter"&&this.createFile()})});let r=t.createDiv("modal-button-container");r.createEl("button",{text:"Cancel"}).addEventListener("click",()=>{this.close()}),r.createEl("button",{text:"Create",cls:"mod-cta"}).addEventListener("click",()=>{this.createFile()})}async createFile(){if(!this.fileName.trim()){new H.Notice("Please enter a file name");return}try{let t=this.fileName.trim(),r=(0,H.normalizePath)(`${t}.typ`),i=this.app.vault.getAbstractFileByPath(r);if(i&&i instanceof H.TFile){new H.Notice("File already exists"),this.app.workspace.getLeaf(!0).openFile(i),this.close();return}let o=await this.app.vault.create(r,"",{});this.app.workspace.getLeaf(!0).openFile(o),this.close()}catch(t){console.error("Error creating Typst file:",t),new H.Notice("Error creating file")}}onClose(){let{contentEl:t}=this;t.empty()}};function yr(n){n.addCommand({id:"create-typst-file",name:"Create new Typst file",callback:()=>{new at(n.app,n).open()}}),n.addCommand({id:"toggle-typst-mode",name:"Toggle between source and reading mode",checkCallback:e=>{let t=n.app.workspace.getActiveViewOfType(J);if(t instanceof J){if(!e){t.toggleMode();let r=t.getCurrentMode()}return!0}return e||new mr.Notice("Must be in a Typst (.typ) file"),!1}})}var de=require("obsidian");var Yt={defaultMode:"source",editorReadableWidth:!1,useDefaultLayoutFunctions:!0,customLayoutFunctions:`#set page(
  width: 210mm,
  height: auto,
  margin: (x: 0cm, y: 0cm),
  fill: none
)

#set text(
  size: 16pt,
  fill: rgb("%THEMECOLOR%")
)

#show math.equation: set text(fill: rgb("%THEMECOLOR%"))

#set par(
  justify: true,
  leading: 0.65em
)

#set block(fill: none)
#set rect(fill: none, stroke: rgb("%THEMECOLOR%"))
#set box(fill: none, stroke: rgb("%THEMECOLOR%"))
#set circle(fill: none, stroke: rgb("%THEMECOLOR%"))
#set ellipse(fill: none, stroke: rgb("%THEMECOLOR%"))
#set polygon(fill: none, stroke: rgb("%THEMECOLOR%"))
#set line(stroke: rgb("%THEMECOLOR%"))`},ct=class extends de.PluginSettingTab{constructor(t,r){super(t,r);this.plugin=r}display(){let{containerEl:t}=this;if(t.empty(),new de.Setting(t).setName("Default file mode").setDesc("Choose whether Typst files open in source or reading mode by default").addDropdown(r=>r.addOption("source","Source mode").addOption("reading","Reading mode").setValue(this.plugin.settings.defaultMode).onChange(async i=>{this.plugin.settings.defaultMode=i,await this.plugin.saveSettings()})),new de.Setting(t).setName("Editor readable width").setDesc("When enabled, limits the editor width for better readability and centers it").addToggle(r=>r.setValue(this.plugin.settings.editorReadableWidth).onChange(async i=>{this.plugin.settings.editorReadableWidth=i,await this.plugin.saveSettings(),this.app.workspace.iterateAllLeaves(o=>{o.view instanceof J&&o.view.onResize()})})),new de.Setting(t).setName("Use default layout functions").setDesc("When enabled, wraps editor content with default page, text, and styling functions.").addToggle(r=>r.setValue(this.plugin.settings.useDefaultLayoutFunctions).onChange(async i=>{this.plugin.settings.useDefaultLayoutFunctions=i,await this.plugin.saveSettings(),this.display()})),this.plugin.settings.useDefaultLayoutFunctions){let r=new de.Setting(t).setName("Custom layout functions").setDesc("Customize the default layout functions. Use %THEMECOLOR% as a placeholder for the current theme's text color."),i;r.addTextArea(o=>{i=o.inputEl,o.setPlaceholder("Enter Typst layout functions...").setValue(this.plugin.settings.customLayoutFunctions).onChange(async s=>{this.plugin.settings.customLayoutFunctions=s,await this.plugin.saveSettings()}),o.inputEl.addClass("typst-layout-textarea"),o.inputEl.rows=10}),r.addButton(o=>o.setButtonText("Reset to default").setIcon("rotate-ccw").setTooltip("Reset to default layout functions").onClick(async()=>{this.plugin.settings.customLayoutFunctions=Yt.customLayoutFunctions,await this.plugin.saveSettings(),i.value=this.plugin.settings.customLayoutFunctions}))}}};var _t=class extends ut.Plugin{async onload(){await this.loadSettings(),(0,ut.addIcon)("typst-file",wr),this.registerExtensions(["typ"],"typst-view"),this.registerView("typst-view",t=>new J(t,this)),yr(this),this.addSettingTab(new ct(this.app,this)),this.registerEvent(this.app.workspace.on("css-change",()=>{this.onThemeChange()}))}onThemeChange(){this.app.workspace.iterateAllLeaves(t=>{t.view instanceof J&&t.view.recompileIfInReadingMode()})}onunload(){}async loadSettings(){this.settings=Object.assign({},Yt,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}};
