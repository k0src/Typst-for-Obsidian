/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var w=Object.defineProperty;var H=Object.getOwnPropertyDescriptor;var q=Object.getOwnPropertyNames;var z=Object.prototype.hasOwnProperty;var K=(r,o)=>{for(var e in o)w(r,e,{get:o[e],enumerable:!0})},O=(r,o,e,i)=>{if(o&&typeof o=="object"||typeof o=="function")for(let n of q(o))!z.call(r,n)&&n!==e&&w(r,n,{get:()=>o[n],enumerable:!(i=H(o,n))||i.enumerable});return r};var R=r=>O(w({},"__esModule",{value:!0}),r);var _={};K(_,{default:()=>b});module.exports=R(_);var v=require("obsidian");var p=require("obsidian");var s=require("@codemirror/view"),M=require("@codemirror/state");var B=require("@codemirror/view"),u=require("@codemirror/language"),t=require("@lezer/highlight"),W="#e5c07b",T="#e06c75",G="#56b6c2",$="#ffffff",h="#abb2bf",E="#7d8799",j="#61afef",J="#98c379",V="#d19a66",Q="#c678dd",U="#21252b",I="#2c313a",L="#282c34",k="#353a42",X="#3E4451",N="#528bff";var Y=B.EditorView.theme({"&":{color:h,backgroundColor:L},".cm-content":{caretColor:N},".cm-cursor, .cm-dropCursor":{borderLeftColor:N},"&.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground, .cm-selectionBackground, .cm-content ::selection":{backgroundColor:X},".cm-panels":{backgroundColor:U,color:h},".cm-panels.cm-panels-top":{borderBottom:"2px solid black"},".cm-panels.cm-panels-bottom":{borderTop:"2px solid black"},".cm-searchMatch":{backgroundColor:"#72a1ff59",outline:"1px solid #457dff"},".cm-searchMatch.cm-searchMatch-selected":{backgroundColor:"#6199ff2f"},".cm-activeLine":{backgroundColor:"#6699ff0b"},".cm-selectionMatch":{backgroundColor:"#aafe661a"},"&.cm-focused .cm-matchingBracket, &.cm-focused .cm-nonmatchingBracket":{backgroundColor:"#bad0f847"},".cm-gutters":{backgroundColor:L,color:E,border:"none"},".cm-activeLineGutter":{backgroundColor:I},".cm-foldPlaceholder":{backgroundColor:"transparent",border:"none",color:"#ddd"},".cm-tooltip":{border:"none",backgroundColor:k},".cm-tooltip .cm-tooltip-arrow:before":{borderTopColor:"transparent",borderBottomColor:"transparent"},".cm-tooltip .cm-tooltip-arrow:after":{borderTopColor:k,borderBottomColor:k},".cm-tooltip-autocomplete":{"& > ul > li[aria-selected]":{backgroundColor:I,color:h}}},{dark:!0}),Z=u.HighlightStyle.define([{tag:t.tags.keyword,color:Q},{tag:[t.tags.name,t.tags.deleted,t.tags.character,t.tags.propertyName,t.tags.macroName],color:T},{tag:[t.tags.function(t.tags.variableName),t.tags.labelName],color:j},{tag:[t.tags.color,t.tags.constant(t.tags.name),t.tags.standard(t.tags.name)],color:V},{tag:[t.tags.definition(t.tags.name),t.tags.separator],color:h},{tag:[t.tags.typeName,t.tags.className,t.tags.number,t.tags.changed,t.tags.annotation,t.tags.modifier,t.tags.self,t.tags.namespace],color:W},{tag:[t.tags.operator,t.tags.operatorKeyword,t.tags.url,t.tags.escape,t.tags.regexp,t.tags.link,t.tags.special(t.tags.string)],color:G},{tag:[t.tags.meta,t.tags.comment],color:E},{tag:t.tags.strong,fontWeight:"bold"},{tag:t.tags.emphasis,fontStyle:"italic"},{tag:t.tags.strikethrough,textDecoration:"line-through"},{tag:t.tags.link,color:E,textDecoration:"underline"},{tag:t.tags.heading,fontWeight:"bold",color:T},{tag:[t.tags.atom,t.tags.bool,t.tags.special(t.tags.variableName)],color:V},{tag:[t.tags.processingInstruction,t.tags.string,t.tags.inserted],color:J},{tag:t.tags.invalid,color:$}]),S=[Y,(0,u.syntaxHighlighting)(Z)];var l=require("@codemirror/commands"),f=require("@codemirror/language"),D=require("@codemirror/autocomplete"),y=require("@codemirror/search"),g=class{constructor(o,e,i){this.editorView=null;this.content="";this.container=o,this.app=e,this.onContentChange=i}initialize(o=""){this.content=o,this.createEditor()}createEditor(){this.container.empty();let o=this.container.createDiv("typst-editor-container"),e=document.body.classList.contains("theme-dark"),i=[(0,s.lineNumbers)(),(0,f.foldGutter)(),(0,s.dropCursor)(),(0,s.rectangularSelection)(),(0,s.highlightActiveLine)(),(0,l.history)(),(0,f.bracketMatching)(),(0,D.closeBrackets)(),(0,y.highlightSelectionMatches)(),M.EditorState.allowMultipleSelections.of(!0),s.keymap.of([l.indentWithTab,...l.defaultKeymap,...y.searchKeymap]),...e?[S]:[],s.EditorView.updateListener.of(n=>{n.docChanged&&(this.content=n.state.doc.toString(),this.onContentChange&&this.onContentChange(this.content))})];this.editorView=new s.EditorView({state:M.EditorState.create({doc:this.content,extensions:i}),parent:o})}getContent(){return this.editorView?this.editorView.state.doc.toString():this.content}setContent(o){if(this.editorView){let e=this.editorView.state.update({changes:{from:0,to:this.editorView.state.doc.length,insert:o}});this.editorView.dispatch(e)}this.content=o}focus(){var o;(o=this.editorView)==null||o.focus()}destroy(){this.editorView&&(this.editorView.destroy(),this.editorView=null)}};var c=class extends p.TextFileView{constructor(){super(...arguments);this.currentMode="source";this.modeIconContainer=null;this.typstEditor=null;this.fileContent=""}getViewType(){return"typst-view"}getDisplayText(){var e;return((e=this.file)==null?void 0:e.basename)||"Typst File"}getIcon(){return"typst-file"}async onOpen(){await super.onOpen(),this.addModeIcon()}onClose(){return this.typstEditor&&(this.typstEditor.destroy(),this.typstEditor=null),super.onClose()}addModeIcon(){let e=this.containerEl.querySelector(".view-actions");e&&(this.modeIconContainer=e.createDiv("clickable-icon"),this.modeIconContainer.addClass("view-action"),this.modeIconContainer.addEventListener("click",()=>{this.toggleMode()}),this.updateModeIcon())}toggleMode(){this.currentMode=this.currentMode==="source"?"reading":"source",this.updateModeIcon(),this.currentMode==="source"?this.showSourceMode():this.showReadingMode()}getCurrentMode(){return this.currentMode}updateModeIcon(){this.modeIconContainer&&(this.modeIconContainer.empty(),this.currentMode==="source"?((0,p.setIcon)(this.modeIconContainer,"pencil-line"),this.modeIconContainer.setAttribute("aria-label","Currently in source mode. Click to switch to reading mode.")):((0,p.setIcon)(this.modeIconContainer,"book-open"),this.modeIconContainer.setAttribute("aria-label","Currently in reading mode. Click to switch to source mode.")))}async setViewData(e,i){this.fileContent=e,this.currentMode==="source"?this.showSourceMode():this.showReadingMode()}getViewData(){return this.currentMode==="source"&&this.typstEditor?this.typstEditor.getContent():this.fileContent}showSourceMode(){let e=this.containerEl.querySelector(".view-content");e&&(e.empty(),this.typstEditor&&(this.typstEditor.destroy(),this.typstEditor=null),this.typstEditor=new g(e,this.app,i=>{this.fileContent=i,this.requestSave()}),this.typstEditor.initialize(this.fileContent))}showReadingMode(){let e=this.containerEl.querySelector(".view-content");if(e){e.empty(),this.typstEditor&&(this.typstEditor.destroy(),this.typstEditor=null);let i=e.createDiv("typst-reading-mode");i.textContent=this.fileContent}}clear(){this.fileContent="",this.typstEditor&&this.typstEditor.setContent("")}};var P=require("obsidian");var a=require("obsidian"),C=class extends a.Modal{constructor(e,i){super(e);this.fileName="";this.plugin=i}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"Create New Typst File"}),new a.Setting(e).setName("File name").setDesc("Enter the name of the Typst file (without .typ extension)").addText(d=>{d.setPlaceholder("note").setValue(this.fileName).onChange(m=>{this.fileName=m}),d.inputEl.focus(),d.inputEl.select(),d.inputEl.addEventListener("keydown",m=>{m.key==="Enter"&&this.createFile()})});let i=e.createDiv("modal-button-container");i.createEl("button",{text:"Cancel"}).addEventListener("click",()=>{this.close()}),i.createEl("button",{text:"Create",cls:"mod-cta"}).addEventListener("click",()=>{this.createFile()})}async createFile(){if(!this.fileName.trim()){new a.Notice("Please enter a file name");return}try{let e=this.fileName.trim(),i=(0,a.normalizePath)(`${e}.typ`),n=this.app.vault.getAbstractFileByPath(i);if(n&&n instanceof a.TFile){new a.Notice("File already exists"),this.app.workspace.getLeaf(!0).openFile(n),this.close();return}let x=await this.app.vault.create(i,"",{});this.app.workspace.getLeaf(!0).openFile(x),this.close()}catch(e){console.error("Error creating Typst file:",e),new a.Notice("Error creating file")}}onClose(){let{contentEl:e}=this;e.empty()}};function F(r){r.addCommand({id:"create-typst-file",name:"Create new Typst file",callback:()=>{new C(r.app,r).open()}}),r.addCommand({id:"toggle-typst-mode",name:"Toggle between source and reading mode",checkCallback:o=>{let e=r.app.workspace.getActiveViewOfType(c);if(e instanceof c){if(!o){e.toggleMode();let i=e.getCurrentMode()}return!0}return o||new P.Notice("Must be in a Typst (.typ) file"),!1}})}var A='<svg xmlns="http://www.w3.org/2000/svg" xml:space="preserve" viewBox="0 0 700 700"><path d="M367.7 477.4c0 25.2 3.6 42.1 10.9 50.7 7.3 8.6 20.7 12.9 40.2 12.9 19.5 0 44.9-9.9 76-29.8l19.9 32.8c-58.3 48.4-106.3 72.5-144.1 72.5s-67.6-9.1-89.4-27.3c-21.9-18.2-32.8-50.5-32.8-96.9V232h-49.7l-8-36.8 57.6-17.9v-48.7L367.5 74v109.3l117.2-8.9L474 239l-106.3-4v242.4z" fill="currentColor"/></svg>';var b=class extends v.Plugin{async onload(){(0,v.addIcon)("typst-file",A),this.registerExtensions(["typ"],"typst-view"),this.registerView("typst-view",o=>new c(o)),F(this)}onunload(){}};
