/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var Bt=Object.defineProperty;var gn=Object.getOwnPropertyDescriptor;var wn=Object.getOwnPropertyNames;var pn=Object.prototype.hasOwnProperty;var hn=(r,t,e)=>t in r?Bt(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var j=(r,t)=>()=>(r&&(t=r(r=0)),t);var Z=(r,t)=>{for(var e in t)Bt(r,e,{get:t[e],enumerable:!0})},bn=(r,t,e,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of wn(t))!pn.call(r,i)&&i!==e&&Bt(r,i,{get:()=>t[i],enumerable:!(n=gn(t,i))||n.enumerable});return r};var mn=r=>bn(Bt({},"__esModule",{value:!0}),r);var g=(r,t,e)=>(hn(r,typeof t!="symbol"?t+"":t,e),e);function rr(){return ct([],{assets:!1})}function nr(r){return ct([],r)}function Fn(r){var e,n,i;let t=[];if(r&&(r==null?void 0:r.assets)!==!1&&((e=r==null?void 0:r.assets)!=null&&e.length)&&((n=r==null?void 0:r.assets)==null?void 0:n.length)>0){let o={text:"https://cdn.jsdelivr.net/gh/typst/typst-assets@v0.13.1/files/fonts/",_:"https://cdn.jsdelivr.net/gh/typst/typst-dev-assets@v0.13.1/files/fonts/"},s=(i=r.assetUrlPrefix)!=null?i:o;typeof s=="string"?s={_:s}:s={...o,...s};for(let d of Object.keys(s)){let l=s[d];l[l.length-1]!=="/"&&(s[d]=l+"/")}let _=(d,l)=>l.map(w=>(s[d]||s._)+w);for(let d of r.assets)switch(d){case"text":t.push(..._(d,Pn));break;case"cjk":t.push(..._(d,Mn));break;case"emoji":t.push(..._(d,Ln));break}}return t}function ct(r,t){let e=Fn(t),n=async(i,{ref:o,builder:s})=>{t!=null&&t.fetcher&&o.setFetcher(t.fetcher),await o.loadFonts(s,[...r,...e])};return n._preloadRemoteFontOptions=t,n._kind="fontLoader",n}function Nt(r){return async(t,{builder:e})=>new Promise(n=>{e.set_package_registry(r,function(i){return r.resolve(i,this)}),n()})}function ue(r){return async(t,e)=>{var n;if(e.alreadySetAccessModel)throw new Error(`already set some assess model before: ${(n=e.alreadySetAccessModel.constructor)==null?void 0:n.name}(${e.alreadySetAccessModel})`);return e.alreadySetAccessModel=r,new Promise(i=>{e.builder.set_access_model(r,o=>{let s=r.getMTime(o);return s?s.getTime():0},o=>r.isFile(o)||!1,o=>r.getRealPath(o)||o,o=>r.readAll(o)),i()})}}var Vi,Pn,Mn,Ln,de=j(()=>{Vi=Symbol("beforeBuild"),Pn=["DejaVuSansMono-Bold.ttf","DejaVuSansMono-BoldOblique.ttf","DejaVuSansMono-Oblique.ttf","DejaVuSansMono.ttf","LibertinusSerif-Bold.otf","LibertinusSerif-BoldItalic.otf","LibertinusSerif-Italic.otf","LibertinusSerif-Regular.otf","LibertinusSerif-Semibold.otf","LibertinusSerif-SemiboldItalic.otf","NewCM10-Bold.otf","NewCM10-BoldItalic.otf","NewCM10-Italic.otf","NewCM10-Regular.otf","NewCMMath-Bold.otf","NewCMMath-Book.otf","NewCMMath-Regular.otf"],Mn=["InriaSerif-Bold.ttf","InriaSerif-BoldItalic.ttf","InriaSerif-Italic.ttf","InriaSerif-Regular.ttf","Roboto-Regular.ttf","NotoSerifCJKsc-Regular.otf"],Ln=["TwitterColorEmoji.ttf","NotoColorEmoji-Regular-COLR.subset.ttf"]});function On(){return or||(or=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Dn(){return sr||(sr=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}function Bn(r){let t=new Promise((e,n)=>{let i=()=>{r.removeEventListener("success",o),r.removeEventListener("error",s)},o=()=>{e(tt(r.result)),i()},s=()=>{n(r.error),i()};r.addEventListener("success",o),r.addEventListener("error",s)});return t.then(e=>{e instanceof IDBCursor&&ar.set(e,r)}).catch(()=>{}),we.set(t,r),t}function jn(r){if(fe.has(r))return;let t=new Promise((e,n)=>{let i=()=>{r.removeEventListener("complete",o),r.removeEventListener("error",s),r.removeEventListener("abort",s)},o=()=>{e(),i()},s=()=>{n(r.error||new DOMException("AbortError","AbortError")),i()};r.addEventListener("complete",o),r.addEventListener("error",s),r.addEventListener("abort",s)});fe.set(r,t)}function cr(r){ge=r(ge)}function Wn(r){return r===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...e){let n=r.call(Ut(this),t,...e);return _r.set(n,t.sort?t.sort():[t]),tt(n)}:Dn().includes(r)?function(...t){return r.apply(Ut(this),t),tt(ar.get(this))}:function(...t){return tt(r.apply(Ut(this),t))}}function $n(r){return typeof r=="function"?Wn(r):(r instanceof IDBTransaction&&jn(r),Tn(r,On())?new Proxy(r,ge):r)}function tt(r){if(r instanceof IDBRequest)return Bn(r);if(le.has(r))return le.get(r);let t=$n(r);return t!==r&&(le.set(r,t),we.set(t,r)),t}var Tn,or,sr,ar,fe,_r,le,we,ge,Ut,pe=j(()=>{Tn=(r,t)=>t.some(e=>r instanceof e);ar=new WeakMap,fe=new WeakMap,_r=new WeakMap,le=new WeakMap,we=new WeakMap;ge={get(r,t,e){if(r instanceof IDBTransaction){if(t==="done")return fe.get(r);if(t==="objectStoreNames")return r.objectStoreNames||_r.get(r);if(t==="store")return e.objectStoreNames[1]?void 0:e.objectStore(e.objectStoreNames[0])}return tt(r[t])},set(r,t,e){return r[t]=e,!0},has(r,t){return r instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in r}};Ut=r=>we.get(r)});function ur(r,t){if(!(r instanceof IDBDatabase&&!(t in r)&&typeof t=="string"))return;if(he.get(t))return he.get(t);let e=t.replace(/FromIndex$/,""),n=t!==e,i=Nn.includes(e);if(!(e in(n?IDBIndex:IDBObjectStore).prototype)||!(i||zn.includes(e)))return;let o=async function(s,..._){let d=this.transaction(s,i?"readwrite":"readonly"),l=d.store;return n&&(l=l.index(_.shift())),(await Promise.all([l[e](..._),i&&d.done]))[0]};return he.set(t,o),o}var zn,Nn,he,dr=j(()=>{pe();pe();zn=["get","getKey","getAll","getAllKeys","count"],Nn=["put","add","delete","clear"],he=new Map;cr(r=>({...r,get:(t,e,n)=>ur(t,e)||r.get(t,e,n),has:(t,e)=>!!ur(t,e)||r.has(t,e)}))});async function Vt(r,t,e,n){var i;return await t.init((i=r==null?void 0:r.getModule)==null?void 0:i.call(r)),await new be().build(r,new e,n)}var be,me=j(()=>{dr();be=class{constructor(){g(this,"loadedFonts",new Set);g(this,"fetcher",fetch)}setFetcher(t){this.fetcher=t}async loadFonts(t,e){let n=new Function("m","return import(m)"),i=this.fetcher||(this.fetcher=await async function(){let{fetchBuilder:_,FileSystemCache:d}=await n("node-fetch-cache"),l=new d({cacheDirectory:".cache/typst/fonts"}),w=_.withCache(l);return function(m,L){let F=setTimeout(()=>{console.warn("font fetching is stucking:",m)},15e3);return w(m,L).finally(()=>{clearTimeout(F)})}}()),o=e.filter(_=>_ instanceof Uint8Array?!0:this.loadedFonts.has(_)?!1:(this.loadedFonts.add(_),!0)),s=await Promise.all(o.map(async _=>{if(_ instanceof Uint8Array){await t.add_raw_font(_);return}return new Uint8Array(await(await i(_)).arrayBuffer())}));for(let _ of s)_&&await t.add_raw_font(_)}async build(t,e,n){var s;let i={ref:this,builder:e,hooks:n};for(let _ of(s=t==null?void 0:t.beforeBuild)!=null?s:[])await _(void 0,i);return n.latelyBuild&&n.latelyBuild(i),await e.build()}}});var E,dt,St=j(()=>{E=Symbol.for("reflexo-obj");(function(r){r[r.PIXEL_PER_PT=3]="PIXEL_PER_PT"})(dt||(dt={}))});var Vn,lt,ye=j(()=>{Vn=r=>{let t=!1,e;return()=>t?e:(t=!0,e=r())},lt=class{constructor(t){g(this,"wasmBin");g(this,"initOnce");if(typeof t!="function")throw new Error("initFn is not a function");this.initOnce=Vn(async()=>{await t(this.wasmBin)})}async init(t){this.wasmBin=t,await this.initOnce()}}});function h(r){return X[r]}function v(r){Rt===X.length&&X.push(X.length+1);let t=Rt;return Rt=X[t],X[t]=r,t}function ft(r,t){try{return r.apply(this,t)}catch(e){u.__wbindgen_export_0(v(e))}}function gt(){return(At===null||At.byteLength===0)&&(At=new Uint8Array(u.memory.buffer)),At}function G(r,t){return r=r>>>0,pr.decode(gt().subarray(r,r+t))}function qn(r){r<132||(X[r]=Rt,Rt=r)}function S(r){let t=h(r);return qn(r),t}function O(r,t,e){if(e===void 0){let _=Ht.encode(r),d=t(_.length,1)>>>0;return gt().subarray(d,d+_.length).set(_),P=_.length,d}let n=r.length,i=t(n,1)>>>0,o=gt(),s=0;for(;s<n;s++){let _=r.charCodeAt(s);if(_>127)break;o[i+s]=_}if(s!==n){s!==0&&(r=r.slice(s)),i=e(i,n,n=s+r.length*3,1)>>>0;let _=gt().subarray(i+s,i+n),d=Hn(r,_);s+=d.written,i=e(i,n,s,1)>>>0}return P=s,i}function x(){return(et===null||et.buffer.detached===!0||et.buffer.detached===void 0&&et.buffer!==u.memory.buffer)&&(et=new DataView(u.memory.buffer)),et}function $(r){return r==null}function Gn(r,t,e,n){let i={a:r,b:t,cnt:1,dtor:e},o=(...s)=>{i.cnt++;let _=i.a;i.a=0;try{return n(_,i.b,...s)}finally{--i.cnt===0?(u.__wbindgen_export_4.get(i.dtor)(_,i.b),lr.unregister(i)):i.a=_}};return o.original=i,lr.register(o,i,i),o}function xe(r){let t=typeof r;if(t=="number"||t=="boolean"||r==null)return`${r}`;if(t=="string")return`"${r}"`;if(t=="symbol"){let i=r.description;return i==null?"Symbol":`Symbol(${i})`}if(t=="function"){let i=r.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(r)){let i=r.length,o="[";i>0&&(o+=xe(r[0]));for(let s=1;s<i;s++)o+=", "+xe(r[s]);return o+="]",o}let e=/\[object ([^\]]+)\]/.exec(toString.call(r)),n;if(e&&e.length>1)n=e[1];else return toString.call(r);if(n=="Object")try{return"Object("+JSON.stringify(r)+")"}catch(i){return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:n}function Jn(r){let t=u.get_font_info(v(r));return S(t)}function hr(r,t){let e=t(r.length*1,1)>>>0;return gt().set(r,e/1),P=r.length,e}function Kn(r,t){r=r>>>0;let e=x(),n=[];for(let i=r;i<r+4*t;i+=4)n.push(S(e.getUint32(i,!0)));return n}function qt(r,t){let e=t(r.length*4,4)>>>0,n=x();for(let i=0;i<r.length;i++)n.setUint32(e+4*i,v(r[i]),!0);return P=r.length,e}function Xn(r,t){if(!(r instanceof t))throw new Error(`expected instance of ${t.name}`)}function Qn(r,t){return r=r>>>0,gt().subarray(r/1,r/1+t)}function Yn(r,t,e){u.__wbindgen_export_5(r,t,v(e))}function Zn(r,t,e,n){u.__wbindgen_export_6(r,t,v(e),v(n))}async function ti(r,t){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,t)}catch(n){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}let e=await r.arrayBuffer();return await WebAssembly.instantiate(e,t)}else{let e=await WebAssembly.instantiate(r,t);return e instanceof WebAssembly.Instance?{instance:e,module:r}:e}}function br(){let r={};return r.wbg={},r.wbg.__wbg_buffer_609cc3eee51ed158=function(t){let e=h(t).buffer;return v(e)},r.wbg.__wbg_call_672a4d21634d4a24=function(){return ft(function(t,e){let n=h(t).call(h(e));return v(n)},arguments)},r.wbg.__wbg_call_7cccdd69e0791ae2=function(){return ft(function(t,e,n){let i=h(t).call(h(e),h(n));return v(i)},arguments)},r.wbg.__wbg_call_b8adc8b1d0a0d8eb=function(){return ft(function(t,e,n,i,o){let s=h(t).call(h(e),h(n),h(i),h(o));return v(s)},arguments)},r.wbg.__wbg_done_769e5ede4b31c67b=function(t){return h(t).done},r.wbg.__wbg_entries_3265d4158b33e5dc=function(t){let e=Object.entries(h(t));return v(e)},r.wbg.__wbg_error_13f62fdb4fc06f92=function(t,e,n){console.error(h(t),h(e),h(n))},r.wbg.__wbg_error_7534b8e9a36f1ab4=function(t,e){let n,i;try{n=t,i=e,console.error(G(t,e))}finally{u.__wbindgen_export_1(n,i,1)}},r.wbg.__wbg_getTimezoneOffset_6b5752021c499c47=function(t){return h(t).getTimezoneOffset()},r.wbg.__wbg_get_67b2ba62fc30de12=function(){return ft(function(t,e){let n=Reflect.get(h(t),h(e));return v(n)},arguments)},r.wbg.__wbg_get_b9b93047fe3cf45b=function(t,e){let n=h(t)[e>>>0];return v(n)},r.wbg.__wbg_getwithrefkey_1dc361bd10053bfe=function(t,e){let n=h(t)[h(e)];return v(n)},r.wbg.__wbg_info_3daf2e093e091b66=function(t){console.info(h(t))},r.wbg.__wbg_instanceof_ArrayBuffer_e14585432e3737fc=function(t){let e;try{e=h(t)instanceof ArrayBuffer}catch(i){e=!1}return e},r.wbg.__wbg_instanceof_Map_f3469ce2244d2430=function(t){let e;try{e=h(t)instanceof Map}catch(i){e=!1}return e},r.wbg.__wbg_instanceof_Object_7f2dcef8f78644a4=function(t){let e;try{e=h(t)instanceof Object}catch(i){e=!1}return e},r.wbg.__wbg_instanceof_Uint8Array_17156bcf118086a9=function(t){let e;try{e=h(t)instanceof Uint8Array}catch(i){e=!1}return e},r.wbg.__wbg_isArray_a1eab7e0d067391b=function(t){return Array.isArray(h(t))},r.wbg.__wbg_isSafeInteger_343e2beeeece1bb0=function(t){return Number.isSafeInteger(h(t))},r.wbg.__wbg_iterator_9a24c88df860dc65=function(){return v(Symbol.iterator)},r.wbg.__wbg_length_a446193dc22c12f8=function(t){return h(t).length},r.wbg.__wbg_length_e2d2a49132c1b256=function(t){return h(t).length},r.wbg.__wbg_log_53ca6abb454c8644=function(t,e,n){console.log(h(t),h(e),h(n))},r.wbg.__wbg_new_23a2665fac83c611=function(t,e){try{var n={a:t,b:e},i=(s,_)=>{let d=n.a;n.a=0;try{return Zn(d,n.b,s,_)}finally{n.a=d}};let o=new Promise(i);return v(o)}finally{n.a=n.b=0}},r.wbg.__wbg_new_31a97dac4f10fab7=function(t){let e=new Date(h(t));return v(e)},r.wbg.__wbg_new_405e22f390576ce2=function(){let t=new Object;return v(t)},r.wbg.__wbg_new_78feb108b6472713=function(){let t=new Array;return v(t)},r.wbg.__wbg_new_8a6f238a6ece86ea=function(){let t=new Error;return v(t)},r.wbg.__wbg_new_a12002a7f91c75be=function(t){let e=new Uint8Array(h(t));return v(e)},r.wbg.__wbg_new_c68d7209be747379=function(t,e){let n=new Error(G(t,e));return v(n)},r.wbg.__wbg_new_e3b321dcfef89fc7=function(t){let e=new Uint32Array(h(t));return v(e)},r.wbg.__wbg_newnoargs_105ed471475aaf50=function(t,e){let n=new Function(G(t,e));return v(n)},r.wbg.__wbg_newwithargs_ab6ffe8cd6c19c04=function(t,e,n,i){let o=new Function(G(t,e),G(n,i));return v(o)},r.wbg.__wbg_newwithbyteoffsetandlength_d97e637ebe145a9a=function(t,e,n){let i=new Uint8Array(h(t),e>>>0,n>>>0);return v(i)},r.wbg.__wbg_newwithbyteoffsetandlength_f1dead44d1fc7212=function(t,e,n){let i=new Uint32Array(h(t),e>>>0,n>>>0);return v(i)},r.wbg.__wbg_next_25feadfc0913fea9=function(t){let e=h(t).next;return v(e)},r.wbg.__wbg_next_6574e1a8a62d1055=function(){return ft(function(t){let e=h(t).next();return v(e)},arguments)},r.wbg.__wbg_now_807e54c39636c349=function(){return Date.now()},r.wbg.__wbg_proxycontext_new=function(t){let e=wt.__wrap(t);return v(e)},r.wbg.__wbg_push_737cfc8c1432c2c6=function(t,e){return h(t).push(h(e))},r.wbg.__wbg_queueMicrotask_97d92b4fcc8a61c5=function(t){queueMicrotask(h(t))},r.wbg.__wbg_queueMicrotask_d3219def82552485=function(t){let e=h(t).queueMicrotask;return v(e)},r.wbg.__wbg_resolve_4851785c9c5f573d=function(t){let e=Promise.resolve(h(t));return v(e)},r.wbg.__wbg_set_37837023f3d740e8=function(t,e,n){h(t)[e>>>0]=S(n)},r.wbg.__wbg_set_3f1d0b984ed272ed=function(t,e,n){h(t)[S(e)]=S(n)},r.wbg.__wbg_set_65595bdd868b3009=function(t,e,n){h(t).set(h(e),n>>>0)},r.wbg.__wbg_set_bb8cecf6a62b9f46=function(){return ft(function(t,e,n){return Reflect.set(h(t),h(e),h(n))},arguments)},r.wbg.__wbg_stack_0ed75d68575b0f3c=function(t,e){let n=h(e).stack,i=O(n,u.__wbindgen_export_2,u.__wbindgen_export_3),o=P;x().setInt32(t+4*1,o,!0),x().setInt32(t+4*0,i,!0)},r.wbg.__wbg_static_accessor_GLOBAL_88a902d13a557d07=function(){let t=typeof globalThis=="undefined"?null:globalThis;return $(t)?0:v(t)},r.wbg.__wbg_static_accessor_GLOBAL_THIS_56578be7e9f832b0=function(){let t=typeof globalThis=="undefined"?null:globalThis;return $(t)?0:v(t)},r.wbg.__wbg_static_accessor_SELF_37c5d418e4bf5819=function(){let t=typeof self=="undefined"?null:self;return $(t)?0:v(t)},r.wbg.__wbg_static_accessor_WINDOW_5de37043a91a9c40=function(){let t=typeof window=="undefined"?null:window;return $(t)?0:v(t)},r.wbg.__wbg_then_44b73946d2fb3e7d=function(t,e){let n=h(t).then(h(e));return v(n)},r.wbg.__wbg_typstcompiler_new=function(t){let e=pt.__wrap(t);return v(e)},r.wbg.__wbg_value_cd1ffa7b1ab794f1=function(t){let e=h(t).value;return v(e)},r.wbg.__wbindgen_as_number=function(t){return+h(t)},r.wbg.__wbindgen_bigint_from_i64=function(t){return v(t)},r.wbg.__wbindgen_bigint_from_u64=function(t){let e=BigInt.asUintN(64,t);return v(e)},r.wbg.__wbindgen_bigint_get_as_i64=function(t,e){let n=h(e),i=typeof n=="bigint"?n:void 0;x().setBigInt64(t+8*1,$(i)?BigInt(0):i,!0),x().setInt32(t+4*0,!$(i),!0)},r.wbg.__wbindgen_boolean_get=function(t){let e=h(t);return typeof e=="boolean"?e?1:0:2},r.wbg.__wbindgen_cb_drop=function(t){let e=S(t).original;return e.cnt--==1?(e.a=0,!0):!1},r.wbg.__wbindgen_closure_wrapper794=function(t,e,n){let i=Gn(t,e,219,Yn);return v(i)},r.wbg.__wbindgen_debug_string=function(t,e){let n=xe(h(e)),i=O(n,u.__wbindgen_export_2,u.__wbindgen_export_3),o=P;x().setInt32(t+4*1,o,!0),x().setInt32(t+4*0,i,!0)},r.wbg.__wbindgen_error_new=function(t,e){let n=new Error(G(t,e));return v(n)},r.wbg.__wbindgen_in=function(t,e){return h(t)in h(e)},r.wbg.__wbindgen_is_bigint=function(t){return typeof h(t)=="bigint"},r.wbg.__wbindgen_is_function=function(t){return typeof h(t)=="function"},r.wbg.__wbindgen_is_object=function(t){let e=h(t);return typeof e=="object"&&e!==null},r.wbg.__wbindgen_is_string=function(t){return typeof h(t)=="string"},r.wbg.__wbindgen_is_undefined=function(t){return h(t)===void 0},r.wbg.__wbindgen_jsval_eq=function(t,e){return h(t)===h(e)},r.wbg.__wbindgen_jsval_loose_eq=function(t,e){return h(t)==h(e)},r.wbg.__wbindgen_memory=function(){let t=u.memory;return v(t)},r.wbg.__wbindgen_number_get=function(t,e){let n=h(e),i=typeof n=="number"?n:void 0;x().setFloat64(t+8*1,$(i)?0:i,!0),x().setInt32(t+4*0,!$(i),!0)},r.wbg.__wbindgen_number_new=function(t){return v(t)},r.wbg.__wbindgen_object_clone_ref=function(t){let e=h(t);return v(e)},r.wbg.__wbindgen_object_drop_ref=function(t){S(t)},r.wbg.__wbindgen_string_get=function(t,e){let n=h(e),i=typeof n=="string"?n:void 0;var o=$(i)?0:O(i,u.__wbindgen_export_2,u.__wbindgen_export_3),s=P;x().setInt32(t+4*1,s,!0),x().setInt32(t+4*0,o,!0)},r.wbg.__wbindgen_string_new=function(t,e){let n=G(t,e);return v(n)},r.wbg.__wbindgen_throw=function(t,e){throw new Error(G(t,e))},r}function mr(r,t){return u=r.exports,yr.__wbindgen_wasm_module=t,et=null,At=null,u}function ei(r){if(u!==void 0)return u;typeof r!="undefined"&&(Object.getPrototypeOf(r)===Object.prototype?{module:r}=r:console.warn("using deprecated parameters for `initSync()`; pass a single object instead"));let t=br();r instanceof WebAssembly.Module||(r=new WebAssembly.Module(r));let e=new WebAssembly.Instance(r,t);return mr(e,r)}async function yr(r){if(u!==void 0)return u;typeof r!="undefined"&&(Object.getPrototypeOf(r)===Object.prototype?{module_or_path:r}=r:console.warn("using deprecated parameters for the initialization function; pass a single object instead")),typeof r=="undefined"&&(r=xr("typst_ts_web_compiler_bg.wasm",ri.url));let t=br();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));let{instance:e,module:n}=await ti(await r,t);return mr(e,n)}function Ce(r){xr=r}var ri,u,X,Rt,pr,At,P,Ht,Hn,et,lr,fr,rt,ve,wt,gr,pt,wr,ke,vr,xr,Gt=j(()=>{ri={},X=new Array(128).fill(void 0);X.push(void 0,null,!0,!1);Rt=X.length;pr=typeof TextDecoder!="undefined"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder!="undefined"&&pr.decode();At=null;P=0,Ht=typeof TextEncoder!="undefined"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},Hn=typeof Ht.encodeInto=="function"?function(r,t){return Ht.encodeInto(r,t)}:function(r,t){let e=Ht.encode(r);return t.set(e),{read:r.length,written:e.length}};et=null;lr=typeof FinalizationRegistry=="undefined"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(r=>{u.__wbindgen_export_4.get(r.dtor)(r.a,r.b)});fr=typeof FinalizationRegistry=="undefined"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(r=>u.__wbg_incrserver_free(r>>>0,1)),rt=class{static __wrap(t){t=t>>>0;let e=Object.create(rt.prototype);return e.__wbg_ptr=t,fr.register(e,e.__wbg_ptr,e),e}__destroy_into_raw(){let t=this.__wbg_ptr;return this.__wbg_ptr=0,fr.unregister(this),t}free(){let t=this.__destroy_into_raw();u.__wbg_incrserver_free(t,0)}set_attach_debug_info(t){u.incrserver_set_attach_debug_info(this.__wbg_ptr,t)}current(){try{let n=u.__wbindgen_add_to_stack_pointer(-16);u.incrserver_current(n,this.__wbg_ptr);var t=x().getInt32(n+4*0,!0),e=x().getInt32(n+4*1,!0);let i;return t!==0&&(i=Qn(t,e).slice(),u.__wbindgen_export_1(t,e*1,1)),i}finally{u.__wbindgen_add_to_stack_pointer(16)}}reset(){u.incrserver_reset(this.__wbg_ptr)}},ve=typeof FinalizationRegistry=="undefined"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(r=>u.__wbg_proxycontext_free(r>>>0,1)),wt=class{static __wrap(t){t=t>>>0;let e=Object.create(wt.prototype);return e.__wbg_ptr=t,ve.register(e,e.__wbg_ptr,e),e}__destroy_into_raw(){let t=this.__wbg_ptr;return this.__wbg_ptr=0,ve.unregister(this),t}free(){let t=this.__destroy_into_raw();u.__wbg_proxycontext_free(t,0)}constructor(t){let e=u.proxycontext_new(v(t));return this.__wbg_ptr=e>>>0,ve.register(this,this.__wbg_ptr,this),this}get context(){let t=u.proxycontext_context(this.__wbg_ptr);return S(t)}untar(t,e){try{let o=u.__wbindgen_add_to_stack_pointer(-16),s=hr(t,u.__wbindgen_export_2),_=P;u.proxycontext_untar(o,this.__wbg_ptr,s,_,v(e));var n=x().getInt32(o+4*0,!0),i=x().getInt32(o+4*1,!0);if(i)throw S(n)}finally{u.__wbindgen_add_to_stack_pointer(16)}}},gr=typeof FinalizationRegistry=="undefined"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(r=>u.__wbg_typstcompiler_free(r>>>0,1)),pt=class{static __wrap(t){t=t>>>0;let e=Object.create(pt.prototype);return e.__wbg_ptr=t,gr.register(e,e.__wbg_ptr,e),e}__destroy_into_raw(){let t=this.__wbg_ptr;return this.__wbg_ptr=0,gr.unregister(this),t}free(){let t=this.__destroy_into_raw();u.__wbg_typstcompiler_free(t,0)}reset(){try{let n=u.__wbindgen_add_to_stack_pointer(-16);u.typstcompiler_reset(n,this.__wbg_ptr);var t=x().getInt32(n+4*0,!0),e=x().getInt32(n+4*1,!0);if(e)throw S(t)}finally{u.__wbindgen_add_to_stack_pointer(16)}}set_inputs(t){try{let i=u.__wbindgen_add_to_stack_pointer(-16);u.typstcompiler_set_inputs(i,this.__wbg_ptr,v(t));var e=x().getInt32(i+4*0,!0),n=x().getInt32(i+4*1,!0);if(n)throw S(e)}finally{u.__wbindgen_add_to_stack_pointer(16)}}add_source(t,e){let n=O(t,u.__wbindgen_export_2,u.__wbindgen_export_3),i=P,o=O(e,u.__wbindgen_export_2,u.__wbindgen_export_3),s=P;return u.typstcompiler_add_source(this.__wbg_ptr,n,i,o,s)!==0}map_shadow(t,e){let n=O(t,u.__wbindgen_export_2,u.__wbindgen_export_3),i=P,o=hr(e,u.__wbindgen_export_2),s=P;return u.typstcompiler_map_shadow(this.__wbg_ptr,n,i,o,s)!==0}unmap_shadow(t){let e=O(t,u.__wbindgen_export_2,u.__wbindgen_export_3),n=P;return u.typstcompiler_unmap_shadow(this.__wbg_ptr,e,n)!==0}reset_shadow(){u.typstcompiler_reset_shadow(this.__wbg_ptr)}get_loaded_fonts(){try{let i=u.__wbindgen_add_to_stack_pointer(-16);u.typstcompiler_get_loaded_fonts(i,this.__wbg_ptr);var t=x().getInt32(i+4*0,!0),e=x().getInt32(i+4*1,!0),n=Kn(t,e).slice();return u.__wbindgen_export_1(t,e*4,4),n}finally{u.__wbindgen_add_to_stack_pointer(16)}}get_ast(t){let e,n;try{let w=u.__wbindgen_add_to_stack_pointer(-16),m=O(t,u.__wbindgen_export_2,u.__wbindgen_export_3),L=P;u.typstcompiler_get_ast(w,this.__wbg_ptr,m,L);var i=x().getInt32(w+4*0,!0),o=x().getInt32(w+4*1,!0),s=x().getInt32(w+4*2,!0),_=x().getInt32(w+4*3,!0),d=i,l=o;if(_)throw d=0,l=0,S(s);return e=d,n=l,G(d,l)}finally{u.__wbindgen_add_to_stack_pointer(16),u.__wbindgen_export_1(e,n,1)}}get_semantic_token_legend(){try{let i=u.__wbindgen_add_to_stack_pointer(-16);u.typstcompiler_get_semantic_token_legend(i,this.__wbg_ptr);var t=x().getInt32(i+4*0,!0),e=x().getInt32(i+4*1,!0),n=x().getInt32(i+4*2,!0);if(n)throw S(e);return S(t)}finally{u.__wbindgen_add_to_stack_pointer(16)}}get_semantic_tokens(t,e,n){try{let m=u.__wbindgen_add_to_stack_pointer(-16),L=O(t,u.__wbindgen_export_2,u.__wbindgen_export_3),F=P;var i=$(e)?0:O(e,u.__wbindgen_export_2,u.__wbindgen_export_3),o=P,s=$(n)?0:O(n,u.__wbindgen_export_2,u.__wbindgen_export_3),_=P;u.typstcompiler_get_semantic_tokens(m,this.__wbg_ptr,L,F,i,o,s,_);var d=x().getInt32(m+4*0,!0),l=x().getInt32(m+4*1,!0),w=x().getInt32(m+4*2,!0);if(w)throw S(l);return S(d)}finally{u.__wbindgen_add_to_stack_pointer(16)}}get_artifact(t,e){try{let s=u.__wbindgen_add_to_stack_pointer(-16),_=O(t,u.__wbindgen_export_2,u.__wbindgen_export_3),d=P;u.typstcompiler_get_artifact(s,this.__wbg_ptr,_,d,e);var n=x().getInt32(s+4*0,!0),i=x().getInt32(s+4*1,!0),o=x().getInt32(s+4*2,!0);if(o)throw S(i);return S(n)}finally{u.__wbindgen_add_to_stack_pointer(16)}}set_compiler_options(t,e){try{let _=u.__wbindgen_add_to_stack_pointer(-16),d=O(t,u.__wbindgen_export_2,u.__wbindgen_export_3),l=P;var n=$(e)?0:qt(e,u.__wbindgen_export_2),i=P;u.typstcompiler_set_compiler_options(_,this.__wbg_ptr,d,l,n,i);var o=x().getInt32(_+4*0,!0),s=x().getInt32(_+4*1,!0);if(s)throw S(o)}finally{u.__wbindgen_add_to_stack_pointer(16)}}query(t,e,n,i){let o,s;try{let B=u.__wbindgen_add_to_stack_pointer(-16),un=O(t,u.__wbindgen_export_2,u.__wbindgen_export_3),dn=P;var _=$(e)?0:qt(e,u.__wbindgen_export_2),d=P;let ln=O(n,u.__wbindgen_export_2,u.__wbindgen_export_3),fn=P;var l=$(i)?0:O(i,u.__wbindgen_export_2,u.__wbindgen_export_3),w=P;u.typstcompiler_query(B,this.__wbg_ptr,un,dn,_,d,ln,fn,l,w);var m=x().getInt32(B+4*0,!0),L=x().getInt32(B+4*1,!0),F=x().getInt32(B+4*2,!0),T=x().getInt32(B+4*3,!0),K=m,N=L;if(T)throw K=0,N=0,S(F);return o=K,s=N,G(K,N)}finally{u.__wbindgen_add_to_stack_pointer(16),u.__wbindgen_export_1(o,s,1)}}compile(t,e,n,i){try{let w=u.__wbindgen_add_to_stack_pointer(-16),m=O(t,u.__wbindgen_export_2,u.__wbindgen_export_3),L=P;var o=$(e)?0:qt(e,u.__wbindgen_export_2),s=P;let F=O(n,u.__wbindgen_export_2,u.__wbindgen_export_3),T=P;u.typstcompiler_compile(w,this.__wbg_ptr,m,L,o,s,F,T,i);var _=x().getInt32(w+4*0,!0),d=x().getInt32(w+4*1,!0),l=x().getInt32(w+4*2,!0);if(l)throw S(d);return S(_)}finally{u.__wbindgen_add_to_stack_pointer(16)}}create_incr_server(){try{let i=u.__wbindgen_add_to_stack_pointer(-16);u.typstcompiler_create_incr_server(i,this.__wbg_ptr);var t=x().getInt32(i+4*0,!0),e=x().getInt32(i+4*1,!0),n=x().getInt32(i+4*2,!0);if(n)throw S(e);return rt.__wrap(t)}finally{u.__wbindgen_add_to_stack_pointer(16)}}incr_compile(t,e,n,i){try{let w=u.__wbindgen_add_to_stack_pointer(-16),m=O(t,u.__wbindgen_export_2,u.__wbindgen_export_3),L=P;var o=$(e)?0:qt(e,u.__wbindgen_export_2),s=P;Xn(n,rt),u.typstcompiler_incr_compile(w,this.__wbg_ptr,m,L,o,s,n.__wbg_ptr,i);var _=x().getInt32(w+4*0,!0),d=x().getInt32(w+4*1,!0),l=x().getInt32(w+4*2,!0);if(l)throw S(d);return S(_)}finally{u.__wbindgen_add_to_stack_pointer(16)}}},wr=typeof FinalizationRegistry=="undefined"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(r=>u.__wbg_typstcompilerbuilder_free(r>>>0,1)),ke=class{__destroy_into_raw(){let t=this.__wbg_ptr;return this.__wbg_ptr=0,wr.unregister(this),t}free(){let t=this.__destroy_into_raw();u.__wbg_typstcompilerbuilder_free(t,0)}constructor(){try{let i=u.__wbindgen_add_to_stack_pointer(-16);u.typstcompilerbuilder_new(i);var t=x().getInt32(i+4*0,!0),e=x().getInt32(i+4*1,!0),n=x().getInt32(i+4*2,!0);if(n)throw S(e);return this.__wbg_ptr=t>>>0,wr.register(this,this.__wbg_ptr,this),this}finally{u.__wbindgen_add_to_stack_pointer(16)}}set_dummy_access_model(){try{let n=u.__wbindgen_add_to_stack_pointer(-16);u.typstcompilerbuilder_set_dummy_access_model(n,this.__wbg_ptr);var t=x().getInt32(n+4*0,!0),e=x().getInt32(n+4*1,!0);if(e)throw S(t)}finally{u.__wbindgen_add_to_stack_pointer(16)}}set_access_model(t,e,n,i,o){let s=u.typstcompilerbuilder_set_access_model(this.__wbg_ptr,v(t),v(e),v(n),v(i),v(o));return S(s)}set_package_registry(t,e){let n=u.typstcompilerbuilder_set_package_registry(this.__wbg_ptr,v(t),v(e));return S(n)}add_raw_font(t){let e=u.typstcompilerbuilder_add_raw_font(this.__wbg_ptr,v(t));return S(e)}add_web_fonts(t){let e=u.typstcompilerbuilder_add_web_fonts(this.__wbg_ptr,v(t));return S(e)}build(){let t=this.__destroy_into_raw(),e=u.typstcompilerbuilder_build(t);return S(e)}};vr=yr,xr=async function(r,t){throw new Error("Cannot import wasm module without importer: "+r+" "+t)}});var Ee={};Z(Ee,{IncrServer:()=>rt,ProxyContext:()=>wt,TypstCompiler:()=>pt,TypstCompilerBuilder:()=>ke,default:()=>ni,get_font_info:()=>Jn,initSync:()=>ei,setImportWasmModule:()=>Ce});var ni,ii,oi,Ie=j(()=>{Gt();Gt();Gt();ni=vr,ii=async function(r,t){let e=new Function("m","return import(m)"),{readFileSync:n}=await e("fs"),i=new URL(r,t);return await n(i).buffer},oi=typeof process!="undefined"&&process.versions!=null&&process.versions.node!=null;oi&&Ce(ii)});var Ae={};Z(Ae,{IncrementalServer:()=>Jt,createTypstCompiler:()=>Cr});function Cr(){return new Pt}function Se(r){return r?Object.entries(r):void 0}function kr(r){switch(r){case"none":return 1;case"unix":return 2;case"full":default:return 3}}var ai,Jt,si,Re,Pt,Pe=j(()=>{me();St();de();ye();Jt=class{constructor(t){g(this,ai);this[E]=t}reset(){this[E].reset()}current(){return this[E].current()}setAttachDebugInfo(t){this[E].set_attach_debug_info(t)}};ai=E;si=new lt(async r=>await(await Promise.resolve().then(()=>(Ie(),Ee))).default(r));Re=class{constructor(){g(this,"compiler");g(this,"compilerJs")}async init(t){var l;this.compilerJs=await Promise.resolve().then(()=>(Ie(),Ee));let e=this.compilerJs.TypstCompilerBuilder,n={...t||{}},i=(l=n.beforeBuild)!=null?l:n.beforeBuild=[],o=i.some(w=>w._preloadRemoteFontOptions!==void 0),s=i.some(w=>{var m;return((m=w._preloadRemoteFontOptions)==null?void 0:m.assets)!==void 0}),_=i.some(w=>{var m;return((m=w._preloadRemoteFontOptions)==null?void 0:m.assets)===!1});if((!o||!s&&!_)&&i.push(ct([],{assets:Re.defaultAssets})),!i.some(w=>w._kind==="fontLoader"))throw new Error("TypstCompiler: no font loader found, please use font loaders, e.g. preloadRemoteFonts or preloadSystemFonts");this.compiler=await Vt(t,si,e,{})}compile(t){return new Promise(e=>{if("incrementalServer"in t){e(this.compiler.incr_compile(t.mainFilePath,Se(t.inputs),t.incrementalServer[E],kr(t.diagnostics)));return}e(this.compiler.compile(t.mainFilePath,Se(t.inputs),t.format||"vector",kr(t.diagnostics)))})}query(t){return new Promise(e=>{e(JSON.parse(this.compiler.query(t.mainFilePath,Se(t.inputs),t.selector,t.field)))})}getSemanticTokenLegend(){return new Promise(t=>{t(this.compiler.get_semantic_token_legend())})}getSemanticTokens(t){return new Promise(e=>{this.compiler.reset(),e(this.compiler.get_semantic_tokens(t.offsetEncoding||"utf-16",t.mainFilePath,t.resultId))})}async withIncrementalServer(t){let e=new Jt(this.compiler.create_incr_server());try{return await t(e)}finally{e[E].free()}}async getAst(t){return this.compiler.get_ast(t)}async reset(){await new Promise(t=>{this.compiler.reset(),t(void 0)})}addSource(t,e){if(arguments.length>2)throw new Error("use of addSource(path, source, isMain) is deprecated, please use addSource(path, source) instead");this.compiler.add_source(t,e)}mapShadow(t,e){this.compiler.map_shadow(t,e)}unmapShadow(t){this.compiler.unmap_shadow(t)}resetShadow(){this.compiler.reset_shadow()}renderPageToCanvas(){throw new Error("Please use the api TypstRenderer.renderToCanvas in v0.4.0")}},Pt=Re;g(Pt,"defaultAssets",["text"]);Cr._impl=Pt});var Ar={};Z(Ar,{createGlobalCompiler:()=>Sr,getGlobalCompiler:()=>Ir,withGlobalCompiler:()=>_i});function Ir(){return Er?Le:void 0}function Sr(r,t){let e=Le||r();return Me!==void 0?Me:Me=(async()=>(Er=!0,await e.init(t),Le=e))()}function _i(r,t,e,n){let i=Ir();if(i){e(i);return}Sr(r,t).then(e).catch(n)}var Le,Me,Er,Rr=j(()=>{Er=!1});var Kt,Pr=j(()=>{St();Kt=class{constructor(t,e,n){g(this,"pageInfos");g(this,"loadPageCount");g(this,"imageScaleFactor");g(this,"container");g(this,"canvasList");g(this,"textLayerList");g(this,"commonList");g(this,"textLayerParentList");g(this,"semanticLayerList");var o;this.pageInfos=t,this.imageScaleFactor=(o=n.pixelPerPt)!=null?o:dt.PIXEL_PER_PT,e.innerHTML="",e.style.width="100%",this.container=e,this.canvasList=new Array(this.loadPageCount),this.textLayerList=new Array(this.loadPageCount),this.commonList=new Array(this.loadPageCount),this.textLayerParentList=new Array(this.loadPageCount),this.semanticLayerList=new Array(this.loadPageCount);let i=(s,_,d)=>{let l=Math.ceil(_.width)*this.imageScaleFactor,w=Math.ceil(_.height)*this.imageScaleFactor,m=this.canvasList[s]=document.createElement("canvas"),L=this.semanticLayerList[s]=document.createElement("div"),F=this.textLayerList[s]=document.createElement("div"),T=this.textLayerParentList[s]=document.createElement("div");if(m.getContext("2d")){let N=document.createElement("div");m.width=l,m.height=w,N.appendChild(m),d.appendChild(N),N.style.position="absolute"}{T.appendChild(F),T.className="typst-html-semantics";let N=e.offsetWidth,B=N/_.width;T.style.width=`${N}px`,T.style.height=`${_.height*B}px`,T.style.setProperty("--data-text-width",`${B}px`),T.style.setProperty("--data-text-height",`${B}px`),d.classList.add("typst-page"),d.classList.add("canvas"),d.style.width=`${N}px`,d.style.height=`${w*B}px`,d.style.position="relative",L.appendChild(T),d.appendChild(L)}};for(let s=0;s<this.pageInfos.length;s++){let _=this.pageInfos[s],d;d=this.commonList[s]=document.createElement("div"),e.appendChild(d),i(s,_,d)}}resetLayout(){for(let t=0;t<this.pageInfos.length;t++){let e=this.pageInfos[t],n=Math.ceil(e.width)*this.imageScaleFactor,i=Math.ceil(e.height)*this.imageScaleFactor,o=this.canvasList[t].parentElement;if(!o)throw new Error(`canvasDiv is null for page ${t}, canvas list length ${this.canvasList.length}`);let s=this.commonList[t],_=this.textLayerParentList[t],d=this.container.offsetWidth,l=d/n;_.style.width=`${d}px`,_.style.height=`${i*l}px`,s.style.width=`${d}px`,s.style.height=`${i*l}px`;let w=this.container.offsetWidth/n;o.style.transformOrigin="0px 0px",o.style.transform=`scale(${w})`}}}});function Mr(r){return class{constructor(e){g(this,"impl");g(this,"kModule");if(e.isContentPreview&&(e.renderMode="canvas"),this.kModule=e.kModule,this.impl=new r(e),!this.impl.r)throw new Error(`mode is not supported, ${e==null?void 0:e.renderMode}`);e.isContentPreview&&(this.impl.partialRendering=!0,this.impl.pixelPerPt=1,this.impl.isMixinOutline=!0)}dispose(){this.impl.dispose()}reset(){this.impl.reset()}addChangement(e){this.impl.addChangement(e)}addViewportChange(){this.impl.addViewportChange()}setPageColor(e){this.impl.pageColor=e,this.addViewportChange()}setPartialRendering(e){this.impl.partialRendering=e}setCursor(e,n,i){this.impl.cursorPosition=[e,n,i]}setPartialPageNumber(e){return e<=0||e>this.kModule.retrievePagesInfo().length?!1:(this.impl.partialRenderPage=e-1,this.addViewportChange(),!0)}getPartialPageNumber(){return this.impl.partialRenderPage+1}setOutineData(e){this.impl.outline=e,this.addViewportChange()}}}function Lr(r,...t){return t.reduce((e,n)=>n(e),r)}var Y,ht,Fr=j(()=>{(function(r){r[r.Doc=0]="Doc",r[r.Slide=1]="Slide"})(Y||(Y={}));ht=class{constructor(t){g(this,"hookedElem");g(this,"kModule");g(this,"opts");g(this,"modes",[]);g(this,"partialRendering",!0);g(this,"renderMode","svg");g(this,"r");g(this,"previewMode",Y.Doc);g(this,"isContentPreview",!1);g(this,"isMixinOutline",!1);g(this,"backgroundColor","black");g(this,"pageColor","white");g(this,"pixelPerPt",3);g(this,"retrieveDOMState");g(this,"isRendering",!1);g(this,"moduleInitialized",!1);g(this,"patchQueue",[]);g(this,"disposeList",[]);g(this,"canvasRenderCToken");g(this,"currentRealScale",1);g(this,"currentScaleRatio",1);g(this,"vpTimeout");g(this,"sampledRenderTime",0);g(this,"partialRenderPage",0);g(this,"outline");g(this,"cursorPosition");g(this,"cachedDOMState",{width:0,height:0,window:{innerWidth:0,innerHeight:0},boundingRect:{left:0,top:0,right:0}});var e,n;this.hookedElem=t.hookedElem,this.kModule=t.kModule,this.opts=t||{};{let{renderMode:i,previewMode:o,isContentPreview:s,retrieveDOMState:_}=t||{};this.partialRendering=!1,this.renderMode=i!=null?i:this.renderMode,this.previewMode=o!=null?o:this.previewMode,this.isContentPreview=s||!1,this.retrieveDOMState=_!=null?_:()=>({width:this.hookedElem.offsetWidth,height:this.hookedElem.offsetHeight,window:{innerWidth:window.innerWidth,innerHeight:window.innerHeight},boundingRect:this.hookedElem.getBoundingClientRect()}),this.backgroundColor=getComputedStyle(document.documentElement).getPropertyValue("--typst-preview-background-color")}this.hookedElem.classList.add("hide-scrollbar-x"),(e=this.hookedElem.parentElement)==null||e.classList.add("hide-scrollbar-x"),this.previewMode===Y.Slide&&(this.hookedElem.classList.add("hide-scrollbar-y"),(n=this.hookedElem.parentElement)==null||n.classList.add("hide-scrollbar-y")),this.installCtrlWheelHandler()}reset(){this.kModule.reset(),this.moduleInitialized=!1}dispose(){let t=this.disposeList;this.disposeList=[],t.forEach(e=>e())}static derive(t,e){return["rescale","rerender","postRender"].reduce((n,i)=>(n[i]=t[`${i}$${e}`].bind(t),console.assert(n[i]!==void 0,`${i}$${e} is undefined`),n),{})}registerMode(t){let e=ht.derive(this,t);this.modes.push([t,e]),t===this.renderMode&&(this.r=e)}installCtrlWheelHandler(){let t=[.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.3,1.5,1.7,1.9,2.1,2.4,2.7,3,3.3,3.7,4.1,4.6,5.1,5.7,6.3,7,7.7,8.5,9.4,10],e=n=>{var i,o,s,_;if(n.ctrlKey){n.preventDefault(),this.cachedDOMState=this.retrieveDOMState(),window.onresize!==null&&(window.onresize=null);let d=this.currentScaleRatio;if(n.deltaY<0){if(this.currentScaleRatio>=t.at(-1))return;this.currentScaleRatio=t.filter(F=>F>this.currentScaleRatio).at(0)}else if(n.deltaY>0){if(this.currentScaleRatio<=t.at(0))return;this.currentScaleRatio=t.filter(F=>F<this.currentScaleRatio).at(-1)}else return;let l=this.currentScaleRatio/d,w=n.pageX*(l-1),m=n.pageY*(l-1);Math.abs(this.currentScaleRatio-1)<1e-5?(this.hookedElem.classList.add("hide-scrollbar-x"),(i=this.hookedElem.parentElement)==null||i.classList.add("hide-scrollbar-x"),this.previewMode===Y.Slide&&(this.hookedElem.classList.add("hide-scrollbar-y"),(o=this.hookedElem.parentElement)==null||o.classList.add("hide-scrollbar-y"))):(this.hookedElem.classList.remove("hide-scrollbar-x"),(s=this.hookedElem.parentElement)==null||s.classList.remove("hide-scrollbar-x"),this.previewMode===Y.Slide&&(this.hookedElem.classList.remove("hide-scrollbar-y"),(_=this.hookedElem.parentElement)==null||_.classList.remove("hide-scrollbar-y")));let L=this.hookedElem.firstElementChild;if(L){let F=this.getSvgScaleRatio(),T=Number.parseFloat(L.getAttribute("data-height")),K=Math.ceil(T*F);this.hookedElem.style.height=`${K*2}px`}return window.scrollBy(w,m),this.addViewportChange(),!1}};this.renderMode!=="dom"&&(typeof acquireVsCodeApi!="undefined"?(window.addEventListener("wheel",e,{passive:!1}),this.disposeList.push(()=>{window.removeEventListener("wheel",e)})):(document.body.addEventListener("wheel",e,{passive:!1}),this.disposeList.push(()=>{document.body.removeEventListener("wheel",e)})))}getSvgScaleRatio(){let t=this.hookedElem.firstElementChild;if(!t)return 0;let e=this.cachedDOMState,n=Number.parseFloat(t.getAttribute("data-width")||t.getAttribute("width")||"1"),i=Number.parseFloat(t.getAttribute("data-height")||t.getAttribute("height")||"1");return this.currentRealScale=this.previewMode===Y.Slide?Math.min(e.width/n,e.height/i):e.width/n,this.currentRealScale*this.currentScaleRatio}processQueue(t){let e=t[0];switch(e){case"new":case"diff-v1":return e==="new"&&this.reset(),this.kModule.manipulateData({action:"merge",data:t[1]}),this.moduleInitialized=!0,!0;case"viewport-change":return this.moduleInitialized?!0:(console.log("viewport-change before initialization"),!1);default:return console.log("svgUpdateEvent",t),!1}}triggerUpdate(){if(this.isRendering)return;this.isRendering=!0;let t=async()=>{if(this.cachedDOMState=this.retrieveDOMState(),this.patchQueue.length===0){this.isRendering=!1,this.postprocessChanges();return}try{let e=performance.now(),n=this.canvasRenderCToken;n&&(await n.cancel(),await n.wait(),this.canvasRenderCToken=void 0,console.log("cancel canvas rendering"));let i=!1;for(;this.patchQueue.length>0;)i=this.processQueue(this.patchQueue.shift())||i;let o=performance.now();i&&(this.r.rescale(),await this.r.rerender(),this.r.rescale());let s=performance.now(),_=(d,l,w)=>`${d} ${(w-l).toFixed(2)} ms`;this.sampledRenderTime=s-e,console.log([_("parse",e,o),_("rerender",o,s),_("total",e,s)].join(", ")),requestAnimationFrame(t)}catch(e){console.error(e),this.isRendering=!1,this.postprocessChanges()}};requestAnimationFrame(t)}postprocessChanges(){this.r.postRender(),this.previewMode===Y.Slide&&document.querySelectorAll(".typst-page-number-indicator").forEach(t=>{t.textContent=`${this.kModule.retrievePagesInfo().length}`})}addChangement(t){t[0]==="new"&&this.patchQueue.splice(0,this.patchQueue.length);let e=()=>{this.vpTimeout=void 0,this.patchQueue.push(t),this.triggerUpdate()};this.vpTimeout!==void 0&&clearTimeout(this.vpTimeout),t[0]==="viewport-change"&&this.isRendering?this.vpTimeout=setTimeout(e,this.sampledRenderTime||100):e()}addViewportChange(){this.addChangement(["viewport-change",""])}}});var Xt,Tr=j(()=>{Xt=class{constructor(){g(this,"isCancellationRequested",!1);g(this,"_onCancelled");g(this,"_onCancelledResolveResolved");let t,e;this._onCancelled=new Promise(n=>{t=n,e&&e(n)}),this._onCancelledResolveResolved=new Promise(n=>{e=n,t&&n(t)})}async cancel(){await this._onCancelledResolveResolved,this.isCancellationRequested=!0}isCancelRequested(){return this.isCancellationRequested}async consume(){(await this._onCancelledResolveResolved)()}wait(){return this._onCancelled}}});function ui(r){return class extends r{constructor(...n){super(...n);g(this,"tmpl",document.createElement("template"));g(this,"stub",this.createElement("<stub></stub>"));g(this,"plugin");g(this,"docKernel");g(this,"resourceHeader");g(this,"pages",[]);g(this,"domScale",1);g(this,"track_mode",Fe.Doc);g(this,"current_task");g(this,"viewport");if(this.registerMode("dom"),this.disposeList.push(()=>{this.dispose()}),this.plugin=this.opts.renderer,this.opts.domScale!==void 0){if(this.opts.domScale<=0)throw new Error("domScale must be positive");this.domScale=this.opts.domScale}}dispose(){for(let n of this.pages)n.dispose();this.docKernel&&this.docKernel.free()}createElement(n){return this.tmpl.innerHTML=n,this.tmpl.content.firstElementChild}async mountDom(n){if(console.log("mountDom",n),this.docKernel)throw new Error("already mounted");this.hookedElem.innerHTML='<svg class="typst-svg-resources" viewBox="0 0 0 0" width="0" height="0" style="opacity: 0; position: absolute;"></svg>',this.resourceHeader=this.hookedElem.querySelector(".typst-svg-resources"),this.docKernel=await this.plugin.renderer.mount_dom(this.kModule[E],this.hookedElem),this.docKernel.bind_functions({populateGlyphs:i=>{let o=this.createElement(i);console.log("populateGlyphs",o);let s=o.firstElementChild;this.resourceHeader.append(s)}})}async cancelAnyway$dom(){if(console.log("cancelAnyway$dom"),this.current_task){let n=this.current_task;this.current_task=void 0,await n.cancel()}}retrieveDOMPages(){return Array.from(this.hookedElem.querySelectorAll(".typst-dom-page"))}postRender$dom(){}rescale$dom(){}getDomViewport(n,i){let o=i.left,s=-i.top,_=i.right,d=n.innerHeight-i.top,l={x:0,y:s/this.domScale,width:Math.max(_-o,0)/this.domScale,height:Math.max(d-s,0)/this.domScale};return(l.width<=0||l.height<=0)&&(l.x=l.y=l.width=l.height=0),l}async rerender$dom(){let n=this.retrieveDOMState(),{x:i,y:o,width:s,height:_}=this.getDomViewport(n.window,n.boundingRect);if(!await this.docKernel.relayout(i,o,s,_))return;let l=new Xt;this.doRender$dom(l),this.current_task=l}async doRender$dom(n){let i=(d,l)=>{if(d&&!n.isCancelRequested()&&l)return l()},o=this.retrieveDOMPages().map(d=>{let{innerWidth:l,innerHeight:w}=window,m=d.getBoundingClientRect();return{inWindow:!(m.left>l||m.right<0||m.top>w||m.bottom<0),page:d}}),s=async d=>{if(await ci(),n.isCancelRequested()){console.log("cancel stage",V.Layout,d);return}let l=o[d].page,w=l.getBoundingClientRect(),m=this.getDomViewport(window,w),L=B=>this.docKernel.need_repaint(d,m.x,m.y,m.width,m.height,B),F=B=>this.docKernel.repaint(d,m.x,m.y,m.width,m.height,B),T=B=>{if(!n.isCancelRequested())return i(L(B),()=>F(B))};await T(V.Layout);let K=(w.width?Number.parseFloat(l.getAttribute("data-width"))/w.width:1)*this.domScale,N=(w.height?Number.parseFloat(l.getAttribute("data-height"))/w.height:1)*this.domScale;if(m.x*=K,m.y*=N,m.y-=100,m.width*=K,m.height*=N,m.height+=200,await T(V.Svg),await T(V.Semantics),n.isCancelRequested()){console.log("cancel stage",V.Semantics,d);return}L(V.PrepareCanvas)?(async()=>{if(await F(V.PrepareCanvas),!n.isCancelRequested())return T(V.Canvas)})():await T(V.Canvas)},_=async d=>{for(let l=0;l<o.length;++l){if(n.isCancelRequested()){console.log("cancel page",V.Layout,l);return}o[l].inWindow===d&&await s(l)}};this.cancelAnyway$dom(),await _(!0),await _(!1),!n.isCancelRequested()&&console.log("finished",V.Layout)}}}var ci,Fe,V,Qt,Or=j(()=>{St();Fr();Tr();ci=()=>new Promise(r=>requestAnimationFrame(r));(function(r){r[r.Doc=0]="Doc",r[r.Pages=1]="Pages"})(Fe||(Fe={}));(function(r){r[r.Layout=0]="Layout",r[r.Svg=1]="Svg",r[r.Semantics=2]="Semantics",r[r.PrepareCanvas=3]="PrepareCanvas",r[r.Canvas=4]="Canvas"})(V||(V={}));Qt=class extends Mr(Lr(ht,ui)){}});function c(r){return Q[r]}function y(r){bt===Q.length&&Q.push(Q.length+1);let t=bt;if(bt=Q[t],typeof bt!="number")throw new Error("corrupt heap");return Q[t]=r,t}function C(r,t){try{return r.apply(this,t)}catch(e){a.__wbindgen_export_0(y(e))}}function f(r,t){try{return r.apply(this,t)}catch(e){let n=function(){try{return e instanceof Error?`${e.message}

Stack:
${e.stack}`:e.toString()}catch(i){return"<failed to stringify thrown value>"}}();throw console.error("wasm-bindgen: imported JS function that was not marked as `catch` threw an error:",n),e}}function p(r){if(typeof r!="number")throw new Error(`expected a number argument, found ${typeof r}`)}function Ft(){return(Mt===null||Mt.byteLength===0)&&(Mt=new Uint8Array(a.memory.buffer)),Mt}function I(r,t){return r=r>>>0,Jr.decode(Ft().subarray(r,r+t))}function W(r,t,e){if(typeof r!="string")throw new Error(`expected a string argument, found ${typeof r}`);if(e===void 0){let _=Yt.encode(r),d=t(_.length,1)>>>0;return Ft().subarray(d,d+_.length).set(_),M=_.length,d}let n=r.length,i=t(n,1)>>>0,o=Ft(),s=0;for(;s<n;s++){let _=r.charCodeAt(s);if(_>127)break;o[i+s]=_}if(s!==n){s!==0&&(r=r.slice(s)),i=e(i,n,n=s+r.length*3,1)>>>0;let _=Ft().subarray(i+s,i+n),d=di(r,_);if(d.read!==r.length)throw new Error("failed to pass whole string");s+=d.written,i=e(i,n,s,1)>>>0}return M=s,i}function b(){return(nt===null||nt.buffer.detached===!0||nt.buffer.detached===void 0&&nt.buffer!==a.memory.buffer)&&(nt=new DataView(a.memory.buffer)),nt}function R(r){return r==null}function D(r){if(typeof r!="boolean")throw new Error(`expected a boolean argument, found ${typeof r}`)}function li(r){r<132||(Q[r]=bt,bt=r)}function A(r){let t=c(r);return li(r),t}function fi(r,t,e,n){let i={a:r,b:t,cnt:1,dtor:e},o=(...s)=>{i.cnt++;let _=i.a;i.a=0;try{return n(_,i.b,...s)}finally{--i.cnt===0?(a.__wbindgen_export_4.get(i.dtor)(_,i.b),Zt.unregister(i)):i.a=_}};return o.original=i,Zt.register(o,i,i),o}function Dr(r,t,e,n){let i={a:r,b:t,cnt:1,dtor:e},o=(...s)=>{i.cnt++;try{return n(i.a,i.b,...s)}finally{--i.cnt===0&&(a.__wbindgen_export_4.get(i.dtor)(i.a,i.b),i.a=0,Zt.unregister(i))}};return o.original=i,Zt.register(o,i,i),o}function Oe(r){let t=typeof r;if(t=="number"||t=="boolean"||r==null)return`${r}`;if(t=="string")return`"${r}"`;if(t=="symbol"){let i=r.description;return i==null?"Symbol":`Symbol(${i})`}if(t=="function"){let i=r.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(r)){let i=r.length,o="[";i>0&&(o+=Oe(r[0]));for(let s=1;s<i;s++)o+=", "+Oe(r[s]);return o+="]",o}let e=/\[object ([^\]]+)\]/.exec(toString.call(r)),n;if(e&&e.length>1)n=e[1];else return toString.call(r);if(n=="Object")try{return"Object("+JSON.stringify(r)+")"}catch(i){return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:n}function te(r,t){let e=t(r.length*1,1)>>>0;return Ft().set(r,e/1),M=r.length,e}function gi(){return(Lt===null||Lt.byteLength===0)&&(Lt=new Uint32Array(a.memory.buffer)),Lt}function wi(r,t){let e=t(r.length*4,4)>>>0;return gi().set(r,e/4),M=r.length,e}function Br(r,t){let e=t(r.length*4,4)>>>0,n=b();for(let i=0;i<r.length;i++)n.setUint32(e+4*i,y(r[i]),!0);return M=r.length,e}function J(r,t){if(!(r instanceof t))throw new Error(`expected instance of ${t.name}`)}function pi(){let r=a.renderer_build_info();return A(r)}function hi(r,t,e){p(r),p(t),a.__wbindgen_export_5(r,t,y(e))}function bi(r,t){p(r),p(t),a.__wbindgen_export_6(r,t)}function mi(r,t,e){p(r),p(t),a.__wbindgen_export_7(r,t,y(e))}function yi(r,t,e,n){p(r),p(t),a.__wbindgen_export_8(r,t,y(e),y(n))}async function xi(r,t){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,t)}catch(n){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}let e=await r.arrayBuffer();return await WebAssembly.instantiate(e,t)}else{let e=await WebAssembly.instantiate(r,t);return e instanceof WebAssembly.Instance?{instance:e,module:r}:e}}function Kr(){let r={};return r.wbg={},r.wbg.__wbg_appendChild_8204974b7328bf98=function(){return C(function(t,e){let n=c(t).appendChild(c(e));return y(n)},arguments)},r.wbg.__wbg_buffer_609cc3eee51ed158=function(){return f(function(t){let e=c(t).buffer;return y(e)},arguments)},r.wbg.__wbg_call_672a4d21634d4a24=function(){return C(function(t,e){let n=c(t).call(c(e));return y(n)},arguments)},r.wbg.__wbg_call_7cccdd69e0791ae2=function(){return C(function(t,e,n){let i=c(t).call(c(e),c(n));return y(i)},arguments)},r.wbg.__wbg_call_833bed5770ea2041=function(){return C(function(t,e,n,i){let o=c(t).call(c(e),c(n),c(i));return y(o)},arguments)},r.wbg.__wbg_call_b8adc8b1d0a0d8eb=function(){return C(function(t,e,n,i,o){let s=c(t).call(c(e),c(n),c(i),c(o));return y(s)},arguments)},r.wbg.__wbg_clearRect_8e4ba7ea0e06711a=function(){return f(function(t,e,n,i,o){c(t).clearRect(e,n,i,o)},arguments)},r.wbg.__wbg_clientWidth_ce67a04dc15fce39=function(){return f(function(t){let e=c(t).clientWidth;return p(e),e},arguments)},r.wbg.__wbg_clip_8e8cfb00a055cd03=function(){return f(function(t,e){c(t).clip(c(e))},arguments)},r.wbg.__wbg_clip_f584e320f8a2b022=function(){return f(function(t,e){c(t).clip(c(e))},arguments)},r.wbg.__wbg_cloneNode_e35b333b87d51340=function(){return C(function(t){let e=c(t).cloneNode();return y(e)},arguments)},r.wbg.__wbg_content_537e4105afcd9cee=function(){return f(function(t){let e=c(t).content;return y(e)},arguments)},r.wbg.__wbg_createElement_8c9931a732ee2fea=function(){return C(function(t,e,n){let i=c(t).createElement(I(e,n));return y(i)},arguments)},r.wbg.__wbg_createImageBitmap_705010fb21a22922=function(){return C(function(t,e){let n=c(t).createImageBitmap(c(e));return y(n)},arguments)},r.wbg.__wbg_createImageBitmap_b814e27800576bdb=function(){return C(function(t,e){let n=c(t).createImageBitmap(c(e));return y(n)},arguments)},r.wbg.__wbg_createObjectURL_6e98d2f9c7bd9764=function(){return C(function(t,e){let n=URL.createObjectURL(c(e)),i=W(n,a.__wbindgen_export_1,a.__wbindgen_export_2),o=M;b().setInt32(t+4*1,o,!0),b().setInt32(t+4*0,i,!0)},arguments)},r.wbg.__wbg_document_d249400bd7bd996d=function(){return f(function(t){let e=c(t).document;return R(e)?0:y(e)},arguments)},r.wbg.__wbg_drawImage_0915f348c5d54848=function(){return C(function(t,e,n,i){c(t).drawImage(c(e),n,i)},arguments)},r.wbg.__wbg_drawImage_16485aae76d89dbf=function(){return C(function(t,e,n,i,o,s){c(t).drawImage(c(e),n,i,o,s)},arguments)},r.wbg.__wbg_drawImage_468585e3ecfa189a=function(){return C(function(t,e,n,i,o,s){c(t).drawImage(c(e),n,i,o,s)},arguments)},r.wbg.__wbg_drawImage_472a4d5b6df3739a=function(){return C(function(t,e,n,i){c(t).drawImage(c(e),n,i)},arguments)},r.wbg.__wbg_drawImage_473e6602e24e18aa=function(){return C(function(t,e,n,i){c(t).drawImage(c(e),n,i)},arguments)},r.wbg.__wbg_drawImage_86fd8465c00c7bc6=function(){return C(function(t,e,n,i,o,s){c(t).drawImage(c(e),n,i,o,s)},arguments)},r.wbg.__wbg_drawImage_ff273710b96c85cc=function(){return C(function(t,e,n,i,o,s){c(t).drawImage(c(e),n,i,o,s)},arguments)},r.wbg.__wbg_error_7534b8e9a36f1ab4=function(){return f(function(t,e){let n,i;try{n=t,i=e,console.error(I(t,e))}finally{a.__wbindgen_export_3(n,i,1)}},arguments)},r.wbg.__wbg_fillRect_b1529535ac758d4c=function(){return f(function(t,e,n,i,o){c(t).fillRect(e,n,i,o)},arguments)},r.wbg.__wbg_fillRect_c38d5d56492a2368=function(){return f(function(t,e,n,i,o){c(t).fillRect(e,n,i,o)},arguments)},r.wbg.__wbg_fill_51814702df845abd=function(){return f(function(t,e,n){c(t).fill(c(e),jr[n])},arguments)},r.wbg.__wbg_fill_5d26765e6d1d8f6b=function(){return f(function(t,e){c(t).fill(c(e))},arguments)},r.wbg.__wbg_fill_64902335a40baa8d=function(){return f(function(t,e,n){c(t).fill(c(e),jr[n])},arguments)},r.wbg.__wbg_fill_cbb22e6ac4da5b1b=function(){return f(function(t,e){c(t).fill(c(e))},arguments)},r.wbg.__wbg_firstElementChild_21331181ca115bcc=function(){return f(function(t){let e=c(t).firstElementChild;return R(e)?0:y(e)},arguments)},r.wbg.__wbg_firstElementChild_d75d385f5abd1414=function(){return f(function(t){let e=c(t).firstElementChild;return R(e)?0:y(e)},arguments)},r.wbg.__wbg_getAttribute_ea5166be2deba45e=function(){return f(function(t,e,n,i){let o=c(e).getAttribute(I(n,i));var s=R(o)?0:W(o,a.__wbindgen_export_1,a.__wbindgen_export_2),_=M;b().setInt32(t+4*1,_,!0),b().setInt32(t+4*0,s,!0)},arguments)},r.wbg.__wbg_getContext_e9cf379449413580=function(){return C(function(t,e,n){let i=c(t).getContext(I(e,n));return R(i)?0:y(i)},arguments)},r.wbg.__wbg_getContext_f65a0debd1e8f8e8=function(){return C(function(t,e,n){let i=c(t).getContext(I(e,n));return R(i)?0:y(i)},arguments)},r.wbg.__wbg_get_67b2ba62fc30de12=function(){return C(function(t,e){let n=Reflect.get(c(t),c(e));return y(n)},arguments)},r.wbg.__wbg_globalCompositeOperation_154b0f30008caa5e=function(){return C(function(t,e){let n=c(e).globalCompositeOperation,i=W(n,a.__wbindgen_export_1,a.__wbindgen_export_2),o=M;b().setInt32(t+4*1,o,!0),b().setInt32(t+4*0,i,!0)},arguments)},r.wbg.__wbg_globalCompositeOperation_1f405e2ef7c5118b=function(){return C(function(t,e){let n=c(e).globalCompositeOperation,i=W(n,a.__wbindgen_export_1,a.__wbindgen_export_2),o=M;b().setInt32(t+4*1,o,!0),b().setInt32(t+4*0,i,!0)},arguments)},r.wbg.__wbg_height_d3f39e12f0f62121=function(){return f(function(t){let e=c(t).height;return p(e),e},arguments)},r.wbg.__wbg_incrdomdocclient_new=function(){return f(function(t){let e=mt.__wrap(t);return y(e)},arguments)},r.wbg.__wbg_instanceof_CanvasRenderingContext2d_df82a4d3437bf1cc=function(){return f(function(t){let e;try{e=c(t)instanceof CanvasRenderingContext2D}catch(i){e=!1}let n=e;return D(n),n},arguments)},r.wbg.__wbg_instanceof_Element_0af65443936d5154=function(){return f(function(t){let e;try{e=c(t)instanceof Element}catch(i){e=!1}let n=e;return D(n),n},arguments)},r.wbg.__wbg_instanceof_HtmlCanvasElement_2ea67072a7624ac5=function(){return f(function(t){let e;try{e=c(t)instanceof HTMLCanvasElement}catch(i){e=!1}let n=e;return D(n),n},arguments)},r.wbg.__wbg_instanceof_HtmlDivElement_dbc6eb62eb772174=function(){return f(function(t){let e;try{e=c(t)instanceof HTMLDivElement}catch(i){e=!1}let n=e;return D(n),n},arguments)},r.wbg.__wbg_instanceof_HtmlElement_51378c201250b16c=function(){return f(function(t){let e;try{e=c(t)instanceof HTMLElement}catch(i){e=!1}let n=e;return D(n),n},arguments)},r.wbg.__wbg_instanceof_HtmlTemplateElement_7929a67c77198607=function(){return f(function(t){let e;try{e=c(t)instanceof HTMLTemplateElement}catch(i){e=!1}let n=e;return D(n),n},arguments)},r.wbg.__wbg_instanceof_ImageBitmap_d093d508663e313d=function(){return f(function(t){let e;try{e=c(t)instanceof ImageBitmap}catch(i){e=!1}let n=e;return D(n),n},arguments)},r.wbg.__wbg_instanceof_OffscreenCanvasRenderingContext2d_a070fdde7ba760a3=function(){return f(function(t){let e;try{e=c(t)instanceof OffscreenCanvasRenderingContext2D}catch(i){e=!1}let n=e;return D(n),n},arguments)},r.wbg.__wbg_instanceof_OffscreenCanvas_d55760945f91bf51=function(){return f(function(t){let e;try{e=c(t)instanceof OffscreenCanvas}catch(i){e=!1}let n=e;return D(n),n},arguments)},r.wbg.__wbg_instanceof_Promise_935168b8f4b49db3=function(){return f(function(t){let e;try{e=c(t)instanceof Promise}catch(i){e=!1}let n=e;return D(n),n},arguments)},r.wbg.__wbg_instanceof_SvgGraphicsElement_8b2cbd8116680c53=function(){return f(function(t){let e;try{e=c(t)instanceof SVGGraphicsElement}catch(i){e=!1}let n=e;return D(n),n},arguments)},r.wbg.__wbg_instanceof_SvgsvgElement_6a0d878e0d0f979c=function(){return f(function(t){let e;try{e=c(t)instanceof SVGSVGElement}catch(i){e=!1}let n=e;return D(n),n},arguments)},r.wbg.__wbg_instanceof_Window_def73ea0955fc569=function(){return f(function(t){let e;try{e=c(t)instanceof Window}catch(i){e=!1}let n=e;return D(n),n},arguments)},r.wbg.__wbg_instanceof_WorkerGlobalScope_dbdbdea7e3b56493=function(){return f(function(t){let e;try{e=c(t)instanceof WorkerGlobalScope}catch(i){e=!1}let n=e;return D(n),n},arguments)},r.wbg.__wbg_lastElementChild_1269b660ec3e6985=function(){return f(function(t){let e=c(t).lastElementChild;return R(e)?0:y(e)},arguments)},r.wbg.__wbg_length_a446193dc22c12f8=function(){return f(function(t){let e=c(t).length;return p(e),e},arguments)},r.wbg.__wbg_log_1ae1e9f741096e91=function(){return f(function(t,e){console.log(c(t),c(e))},arguments)},r.wbg.__wbg_log_c222819a41e063d3=function(){return f(function(t){console.log(c(t))},arguments)},r.wbg.__wbg_measureText_f0f078704231c37f=function(){return C(function(t,e,n){let i=c(t).measureText(I(e,n));return y(i)},arguments)},r.wbg.__wbg_new_23a2665fac83c611=function(){return f(function(t,e){try{var n={a:t,b:e},i=(s,_)=>{let d=n.a;n.a=0;try{return yi(d,n.b,s,_)}finally{n.a=d}};let o=new Promise(i);return y(o)}finally{n.a=n.b=0}},arguments)},r.wbg.__wbg_new_2ef971087cb43792=function(){return C(function(t,e){let n=new OffscreenCanvas(t>>>0,e>>>0);return y(n)},arguments)},r.wbg.__wbg_new_405e22f390576ce2=function(){return f(function(){let t=new Object;return y(t)},arguments)},r.wbg.__wbg_new_6377da097a44ce6e=function(){return C(function(){let t=new Image;return y(t)},arguments)},r.wbg.__wbg_new_78feb108b6472713=function(){return f(function(){let t=new Array;return y(t)},arguments)},r.wbg.__wbg_new_8a6f238a6ece86ea=function(){return f(function(){let t=new Error;return y(t)},arguments)},r.wbg.__wbg_new_a12002a7f91c75be=function(){return f(function(t){let e=new Uint8Array(c(t));return y(e)},arguments)},r.wbg.__wbg_new_c68d7209be747379=function(){return f(function(t,e){let n=new Error(I(t,e));return y(n)},arguments)},r.wbg.__wbg_newnoargs_105ed471475aaf50=function(){return f(function(t,e){let n=new Function(I(t,e));return y(n)},arguments)},r.wbg.__wbg_newwithbyteoffsetandlength_d97e637ebe145a9a=function(){return f(function(t,e,n){let i=new Uint8Array(c(t),e>>>0,n>>>0);return y(i)},arguments)},r.wbg.__wbg_newwithlength_a381634e90c276d4=function(){return f(function(t){let e=new Uint8Array(t>>>0);return y(e)},arguments)},r.wbg.__wbg_newwithpathstring_e9586ab3affcd4fd=function(){return C(function(t,e){let n=new Path2D(I(t,e));return y(n)},arguments)},r.wbg.__wbg_newwithu8arraysequenceandoptions_068570c487f69127=function(){return C(function(t,e){let n=new Blob(c(t),c(e));return y(n)},arguments)},r.wbg.__wbg_nextElementSibling_8472709bec4de113=function(){return f(function(t){let e=c(t).nextElementSibling;return R(e)?0:y(e)},arguments)},r.wbg.__wbg_push_737cfc8c1432c2c6=function(){return f(function(t,e){let n=c(t).push(c(e));return p(n),n},arguments)},r.wbg.__wbg_putImageData_4c5aa10f3b3e4924=function(){return C(function(t,e,n,i){c(t).putImageData(c(e),n,i)},arguments)},r.wbg.__wbg_putImageData_6d5d5ef6ee83898b=function(){return C(function(t,e,n,i){c(t).putImageData(c(e),n,i)},arguments)},r.wbg.__wbg_queueMicrotask_97d92b4fcc8a61c5=function(){return f(function(t){queueMicrotask(c(t))},arguments)},r.wbg.__wbg_queueMicrotask_d3219def82552485=function(){return f(function(t){let e=c(t).queueMicrotask;return y(e)},arguments)},r.wbg.__wbg_removeProperty_0e85471f4dfc00ae=function(){return C(function(t,e,n,i){let o=c(e).removeProperty(I(n,i)),s=W(o,a.__wbindgen_export_1,a.__wbindgen_export_2),_=M;b().setInt32(t+4*1,_,!0),b().setInt32(t+4*0,s,!0)},arguments)},r.wbg.__wbg_remove_e2d2659f3128c045=function(){return f(function(t){c(t).remove()},arguments)},r.wbg.__wbg_renderpageimageoptions_unwrap=function(){return f(function(t){let e=ot.__unwrap(A(t));return p(e),e},arguments)},r.wbg.__wbg_replaceWith_9ce9927e3141d0f6=function(){return C(function(t,e){c(t).replaceWith(c(e))},arguments)},r.wbg.__wbg_resolve_4851785c9c5f573d=function(){return f(function(t){let e=Promise.resolve(c(t));return y(e)},arguments)},r.wbg.__wbg_restore_1ef50af0835a4649=function(){return f(function(t){c(t).restore()},arguments)},r.wbg.__wbg_restore_cc5ae2746f7b5043=function(){return f(function(t){c(t).restore()},arguments)},r.wbg.__wbg_revokeObjectURL_27267efebeb457c7=function(){return C(function(t,e){URL.revokeObjectURL(I(t,e))},arguments)},r.wbg.__wbg_save_5f563096e64939da=function(){return f(function(t){c(t).save()},arguments)},r.wbg.__wbg_save_c675a7a4bbd44e4a=function(){return f(function(t){c(t).save()},arguments)},r.wbg.__wbg_setAttribute_2704501201f15687=function(){return C(function(t,e,n,i,o){c(t).setAttribute(I(e,n),I(i,o))},arguments)},r.wbg.__wbg_setLineDash_0e3f3e194352a774=function(){return C(function(t,e){c(t).setLineDash(c(e))},arguments)},r.wbg.__wbg_setLineDash_325e094206df53e9=function(){return C(function(t,e){c(t).setLineDash(c(e))},arguments)},r.wbg.__wbg_setProperty_f2cf326652b9a713=function(){return C(function(t,e,n,i,o){c(t).setProperty(I(e,n),I(i,o))},arguments)},r.wbg.__wbg_setTransform_8c4d954cafb34b75=function(){return C(function(t,e,n,i,o,s,_){c(t).setTransform(e,n,i,o,s,_)},arguments)},r.wbg.__wbg_setTransform_da2f0baec3f09522=function(){return C(function(t,e,n,i,o,s,_){c(t).setTransform(e,n,i,o,s,_)},arguments)},r.wbg.__wbg_set_37837023f3d740e8=function(){return f(function(t,e,n){c(t)[e>>>0]=A(n)},arguments)},r.wbg.__wbg_set_65595bdd868b3009=function(){return f(function(t,e,n){c(t).set(c(e),n>>>0)},arguments)},r.wbg.__wbg_set_bb8cecf6a62b9f46=function(){return C(function(t,e,n){let i=Reflect.set(c(t),c(e),c(n));return D(i),i},arguments)},r.wbg.__wbg_setfillStyle_2205fca942c641ba=function(){return f(function(t,e,n){c(t).fillStyle=I(e,n)},arguments)},r.wbg.__wbg_setfillStyle_cb059a69ce15cc28=function(){return f(function(t,e,n){c(t).fillStyle=I(e,n)},arguments)},r.wbg.__wbg_setfont_4c3584ef2f5c9f7e=function(){return f(function(t,e,n){c(t).font=I(e,n)},arguments)},r.wbg.__wbg_setglobalCompositeOperation_9a7a92bac2fb7ffd=function(){return C(function(t,e,n){c(t).globalCompositeOperation=I(e,n)},arguments)},r.wbg.__wbg_setglobalCompositeOperation_b000e874f8f4a9d3=function(){return C(function(t,e,n){c(t).globalCompositeOperation=I(e,n)},arguments)},r.wbg.__wbg_setheight_da683a33fa99843c=function(){return f(function(t,e){c(t).height=e>>>0},arguments)},r.wbg.__wbg_setinnerHTML_31bde41f835786f7=function(){return f(function(t,e,n){c(t).innerHTML=I(e,n)},arguments)},r.wbg.__wbg_setlineCap_3a3987ad3f03b31d=function(){return f(function(t,e,n){c(t).lineCap=I(e,n)},arguments)},r.wbg.__wbg_setlineCap_52b6d742c95a5630=function(){return f(function(t,e,n){c(t).lineCap=I(e,n)},arguments)},r.wbg.__wbg_setlineDashOffset_030d80d07cd52ee4=function(){return f(function(t,e){c(t).lineDashOffset=e},arguments)},r.wbg.__wbg_setlineDashOffset_59f274962f6a0553=function(){return f(function(t,e){c(t).lineDashOffset=e},arguments)},r.wbg.__wbg_setlineJoin_79ca64e7e9efaff7=function(){return f(function(t,e,n){c(t).lineJoin=I(e,n)},arguments)},r.wbg.__wbg_setlineJoin_7e005d90ef83d627=function(){return f(function(t,e,n){c(t).lineJoin=I(e,n)},arguments)},r.wbg.__wbg_setlineWidth_3c8b7156949a9f4b=function(){return f(function(t,e){c(t).lineWidth=e},arguments)},r.wbg.__wbg_setlineWidth_ec730c524f09baa9=function(){return f(function(t,e){c(t).lineWidth=e},arguments)},r.wbg.__wbg_setmiterLimit_26162c359bb28eb2=function(){return f(function(t,e){c(t).miterLimit=e},arguments)},r.wbg.__wbg_setmiterLimit_9ffca64ec692501d=function(){return f(function(t,e){c(t).miterLimit=e},arguments)},r.wbg.__wbg_setonerror_e94ca1221abc457f=function(){return f(function(t,e){c(t).onerror=c(e)},arguments)},r.wbg.__wbg_setonload_264a0d330b7166fb=function(){return f(function(t,e){c(t).onload=c(e)},arguments)},r.wbg.__wbg_setsrc_c239193cc7ab0470=function(){return f(function(t,e,n){c(t).src=I(e,n)},arguments)},r.wbg.__wbg_setstrokeStyle_070920f27992b9a6=function(){return f(function(t,e,n){c(t).strokeStyle=I(e,n)},arguments)},r.wbg.__wbg_setstrokeStyle_415833f3f0eb5076=function(){return f(function(t,e,n){c(t).strokeStyle=I(e,n)},arguments)},r.wbg.__wbg_settype_39ed370d3edd403c=function(){return f(function(t,e,n){c(t).type=I(e,n)},arguments)},r.wbg.__wbg_setwidth_c5fed9f5e7f0b406=function(){return f(function(t,e){c(t).width=e>>>0},arguments)},r.wbg.__wbg_stack_0ed75d68575b0f3c=function(){return f(function(t,e){let n=c(e).stack,i=W(n,a.__wbindgen_export_1,a.__wbindgen_export_2),o=M;b().setInt32(t+4*1,o,!0),b().setInt32(t+4*0,i,!0)},arguments)},r.wbg.__wbg_static_accessor_GLOBAL_88a902d13a557d07=function(){return f(function(){let t=typeof globalThis=="undefined"?null:globalThis;return R(t)?0:y(t)},arguments)},r.wbg.__wbg_static_accessor_GLOBAL_THIS_56578be7e9f832b0=function(){return f(function(){let t=typeof globalThis=="undefined"?null:globalThis;return R(t)?0:y(t)},arguments)},r.wbg.__wbg_static_accessor_SELF_37c5d418e4bf5819=function(){return f(function(){let t=typeof self=="undefined"?null:self;return R(t)?0:y(t)},arguments)},r.wbg.__wbg_static_accessor_WINDOW_5de37043a91a9c40=function(){return f(function(){let t=typeof window=="undefined"?null:window;return R(t)?0:y(t)},arguments)},r.wbg.__wbg_stringify_f7ed6987935b4a24=function(){return C(function(t){let e=JSON.stringify(c(t));return y(e)},arguments)},r.wbg.__wbg_stroke_1b0348380fb5a54b=function(){return f(function(t,e){c(t).stroke(c(e))},arguments)},r.wbg.__wbg_stroke_e9b15e77122a9be9=function(){return f(function(t,e){c(t).stroke(c(e))},arguments)},r.wbg.__wbg_style_fb30c14e5815805c=function(){return f(function(t){let e=c(t).style;return y(e)},arguments)},r.wbg.__wbg_then_44b73946d2fb3e7d=function(){return f(function(t,e){let n=c(t).then(c(e));return y(n)},arguments)},r.wbg.__wbg_then_48b406749878a531=function(){return f(function(t,e,n){let i=c(t).then(c(e),c(n));return y(i)},arguments)},r.wbg.__wbg_transferToImageBitmap_4b1cc41c0f7e5de5=function(){return C(function(t){let e=c(t).transferToImageBitmap();return y(e)},arguments)},r.wbg.__wbg_typstrenderer_new=function(){return f(function(t){let e=vt.__wrap(t);return y(e)},arguments)},r.wbg.__wbg_warn_4ca3906c248c47c4=function(){return f(function(t){console.warn(c(t))},arguments)},r.wbg.__wbg_width_2fafd30484634e26=function(){return f(function(t){return c(t).width},arguments)},r.wbg.__wbg_width_4f334fc47ef03de1=function(){return f(function(t){let e=c(t).width;return p(e),e},arguments)},r.wbg.__wbindgen_cb_drop=function(t){let e=A(t).original;if(e.cnt--==1)return e.a=0,!0;let n=!1;return D(n),n},r.wbg.__wbindgen_closure_wrapper1054=function(){return f(function(t,e,n){let i=fi(t,e,480,mi);return y(i)},arguments)},r.wbg.__wbindgen_closure_wrapper986=function(){return f(function(t,e,n){let i=Dr(t,e,448,hi);return y(i)},arguments)},r.wbg.__wbindgen_closure_wrapper987=function(){return f(function(t,e,n){let i=Dr(t,e,448,bi);return y(i)},arguments)},r.wbg.__wbindgen_debug_string=function(t,e){let n=Oe(c(e)),i=W(n,a.__wbindgen_export_1,a.__wbindgen_export_2),o=M;b().setInt32(t+4*1,o,!0),b().setInt32(t+4*0,i,!0)},r.wbg.__wbindgen_is_function=function(t){let e=typeof c(t)=="function";return D(e),e},r.wbg.__wbindgen_is_undefined=function(t){let e=c(t)===void 0;return D(e),e},r.wbg.__wbindgen_jsval_eq=function(t,e){let n=c(t)===c(e);return D(n),n},r.wbg.__wbindgen_memory=function(){let t=a.memory;return y(t)},r.wbg.__wbindgen_number_new=function(t){return y(t)},r.wbg.__wbindgen_object_clone_ref=function(t){let e=c(t);return y(e)},r.wbg.__wbindgen_object_drop_ref=function(t){A(t)},r.wbg.__wbindgen_string_get=function(t,e){let n=c(e),i=typeof n=="string"?n:void 0;var o=R(i)?0:W(i,a.__wbindgen_export_1,a.__wbindgen_export_2),s=M;b().setInt32(t+4*1,s,!0),b().setInt32(t+4*0,o,!0)},r.wbg.__wbindgen_string_new=function(t,e){let n=I(t,e);return y(n)},r.wbg.__wbindgen_throw=function(t,e){throw new Error(I(t,e))},r}function Xr(r,t){return a=r.exports,Qr.__wbindgen_wasm_module=t,nt=null,Lt=null,Mt=null,a}function ki(r){if(a!==void 0)return a;typeof r!="undefined"&&(Object.getPrototypeOf(r)===Object.prototype?{module:r}=r:console.warn("using deprecated parameters for `initSync()`; pass a single object instead"));let t=Kr();r instanceof WebAssembly.Module||(r=new WebAssembly.Module(r));let e=new WebAssembly.Instance(r,t);return Xr(e,r)}async function Qr(r){if(a!==void 0)return a;typeof r!="undefined"&&(Object.getPrototypeOf(r)===Object.prototype?{module_or_path:r}=r:console.warn("using deprecated parameters for the initialization function; pass a single object instead")),typeof r=="undefined"&&(r=Zr("typst_ts_renderer_bg.wasm",Ci.url));let t=Kr();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));let{instance:e,module:n}=await xi(await r,t);return Xr(e,n)}function We(r){Zr=r}var Ci,a,Q,bt,Jr,Mt,M,Yt,di,nt,Zt,Lt,jr,Wr,ee,$r,mt,zr,it,Nr,yt,Ur,ot,Vr,z,qr,De,Te,vt,Hr,Be,vi,je,Gr,xt,Yr,Zr,re=j(()=>{Ci={},Q=new Array(128).fill(void 0);Q.push(void 0,null,!0,!1);bt=Q.length;Jr=typeof TextDecoder!="undefined"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder!="undefined"&&Jr.decode();Mt=null;M=0,Yt=typeof TextEncoder!="undefined"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},di=typeof Yt.encodeInto=="function"?function(r,t){return Yt.encodeInto(r,t)}:function(r,t){let e=Yt.encode(r);return t.set(e),{read:r.length,written:e.length}};nt=null;Zt=typeof FinalizationRegistry=="undefined"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(r=>{a.__wbindgen_export_4.get(r.dtor)(r.a,r.b)});Lt=null;jr=["nonzero","evenodd"],Wr=typeof FinalizationRegistry=="undefined"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(r=>a.__wbg_createsessionoptions_free(r>>>0,1)),ee=class{__destroy_into_raw(){let t=this.__wbg_ptr;return this.__wbg_ptr=0,Wr.unregister(this),t}free(){let t=this.__destroy_into_raw();a.__wbg_createsessionoptions_free(t,0)}constructor(){let t=a.createsessionoptions_new();return this.__wbg_ptr=t>>>0,Wr.register(this,this.__wbg_ptr,this),this}set format(t){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");p(this.__wbg_ptr);let e=W(t,a.__wbindgen_export_1,a.__wbindgen_export_2),n=M;a.createsessionoptions_set_format(this.__wbg_ptr,e,n)}set artifact_content(t){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");p(this.__wbg_ptr);let e=te(t,a.__wbindgen_export_1),n=M;a.createsessionoptions_set_artifact_content(this.__wbg_ptr,e,n)}},$r=typeof FinalizationRegistry=="undefined"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(r=>a.__wbg_incrdomdocclient_free(r>>>0,1)),mt=class{constructor(){throw new Error("cannot invoke `new` directly")}static __wrap(t){t=t>>>0;let e=Object.create(mt.prototype);return e.__wbg_ptr=t,$r.register(e,e.__wbg_ptr,e),e}__destroy_into_raw(){let t=this.__wbg_ptr;return this.__wbg_ptr=0,$r.unregister(this),t}free(){let t=this.__destroy_into_raw();a.__wbg_incrdomdocclient_free(t,0)}bind_functions(t){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");p(this.__wbg_ptr),a.incrdomdocclient_bind_functions(this.__wbg_ptr,y(t))}relayout(t,e,n,i){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");p(this.__wbg_ptr);let o=a.incrdomdocclient_relayout(this.__wbg_ptr,t,e,n,i);return A(o)}need_repaint(t,e,n,i,o,s){try{if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");let w=a.__wbindgen_add_to_stack_pointer(-16);p(this.__wbg_ptr),p(t),p(s),a.incrdomdocclient_need_repaint(w,this.__wbg_ptr,t,e,n,i,o,s);var _=b().getInt32(w+4*0,!0),d=b().getInt32(w+4*1,!0),l=b().getInt32(w+4*2,!0);if(l)throw A(d);return _!==0}finally{a.__wbindgen_add_to_stack_pointer(16)}}repaint(t,e,n,i,o,s){try{if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");let w=a.__wbindgen_add_to_stack_pointer(-16);p(this.__wbg_ptr),p(t),p(s),a.incrdomdocclient_repaint(w,this.__wbg_ptr,t,e,n,i,o,s);var _=b().getInt32(w+4*0,!0),d=b().getInt32(w+4*1,!0),l=b().getInt32(w+4*2,!0);if(l)throw A(d);return A(_)}finally{a.__wbindgen_add_to_stack_pointer(16)}}},zr=typeof FinalizationRegistry=="undefined"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(r=>a.__wbg_pageinfo_free(r>>>0,1)),it=class{constructor(){throw new Error("cannot invoke `new` directly")}static __wrap(t){t=t>>>0;let e=Object.create(it.prototype);return e.__wbg_ptr=t,zr.register(e,e.__wbg_ptr,e),e}__destroy_into_raw(){let t=this.__wbg_ptr;return this.__wbg_ptr=0,zr.unregister(this),t}free(){let t=this.__destroy_into_raw();a.__wbg_pageinfo_free(t,0)}get page_off(){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");return p(this.__wbg_ptr),a.pageinfo_page_off(this.__wbg_ptr)>>>0}get width_pt(){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");return p(this.__wbg_ptr),a.pageinfo_width_pt(this.__wbg_ptr)}get height_pt(){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");return p(this.__wbg_ptr),a.pageinfo_height_pt(this.__wbg_ptr)}},Nr=typeof FinalizationRegistry=="undefined"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(r=>a.__wbg_pagesinfo_free(r>>>0,1)),yt=class{constructor(){throw new Error("cannot invoke `new` directly")}static __wrap(t){t=t>>>0;let e=Object.create(yt.prototype);return e.__wbg_ptr=t,Nr.register(e,e.__wbg_ptr,e),e}__destroy_into_raw(){let t=this.__wbg_ptr;return this.__wbg_ptr=0,Nr.unregister(this),t}free(){let t=this.__destroy_into_raw();a.__wbg_pagesinfo_free(t,0)}get page_count(){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");return p(this.__wbg_ptr),a.pagesinfo_page_count(this.__wbg_ptr)>>>0}page_by_number(t){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");p(this.__wbg_ptr),p(t);let e=a.pagesinfo_page_by_number(this.__wbg_ptr,t);return e===0?void 0:it.__wrap(e)}page(t){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");p(this.__wbg_ptr),p(t);let e=a.pagesinfo_page(this.__wbg_ptr,t);return it.__wrap(e)}width(){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");return p(this.__wbg_ptr),a.pagesinfo_width(this.__wbg_ptr)}height(){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");return p(this.__wbg_ptr),a.pagesinfo_height(this.__wbg_ptr)}},Ur=typeof FinalizationRegistry=="undefined"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(r=>a.__wbg_renderpageimageoptions_free(r>>>0,1)),ot=class{static __unwrap(t){return t instanceof ot?t.__destroy_into_raw():0}__destroy_into_raw(){let t=this.__wbg_ptr;return this.__wbg_ptr=0,Ur.unregister(this),t}free(){let t=this.__destroy_into_raw();a.__wbg_renderpageimageoptions_free(t,0)}constructor(){let t=a.renderpageimageoptions_new();return this.__wbg_ptr=t>>>0,Ur.register(this,this.__wbg_ptr,this),this}get pixel_per_pt(){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");p(this.__wbg_ptr);let t=a.renderpageimageoptions_pixel_per_pt(this.__wbg_ptr);return t===4294967297?void 0:t}set pixel_per_pt(t){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");p(this.__wbg_ptr),R(t)||p(t),a.renderpageimageoptions_set_pixel_per_pt(this.__wbg_ptr,R(t)?4294967297:Math.fround(t))}get background_color(){try{if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");let n=a.__wbindgen_add_to_stack_pointer(-16);p(this.__wbg_ptr),a.renderpageimageoptions_background_color(n,this.__wbg_ptr);var t=b().getInt32(n+4*0,!0),e=b().getInt32(n+4*1,!0);let i;return t!==0&&(i=I(t,e).slice(),a.__wbindgen_export_3(t,e*1,1)),i}finally{a.__wbindgen_add_to_stack_pointer(16)}}set background_color(t){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");p(this.__wbg_ptr);var e=R(t)?0:W(t,a.__wbindgen_export_1,a.__wbindgen_export_2),n=M;a.renderpageimageoptions_set_background_color(this.__wbg_ptr,e,n)}get page_off(){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");return p(this.__wbg_ptr),a.renderpageimageoptions_page_off(this.__wbg_ptr)>>>0}set page_off(t){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");p(this.__wbg_ptr),p(t),a.renderpageimageoptions_set_page_off(this.__wbg_ptr,t)}get cache_key(){try{if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");let n=a.__wbindgen_add_to_stack_pointer(-16);p(this.__wbg_ptr),a.renderpageimageoptions_cache_key(n,this.__wbg_ptr);var t=b().getInt32(n+4*0,!0),e=b().getInt32(n+4*1,!0);let i;return t!==0&&(i=I(t,e).slice(),a.__wbindgen_export_3(t,e*1,1)),i}finally{a.__wbindgen_add_to_stack_pointer(16)}}set cache_key(t){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");p(this.__wbg_ptr);var e=R(t)?0:W(t,a.__wbindgen_export_1,a.__wbindgen_export_2),n=M;a.renderpageimageoptions_set_cache_key(this.__wbg_ptr,e,n)}get data_selection(){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");p(this.__wbg_ptr);let t=a.renderpageimageoptions_data_selection(this.__wbg_ptr);return t===4294967297?void 0:t}set data_selection(t){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");p(this.__wbg_ptr),R(t)||p(t),a.renderpageimageoptions_set_data_selection(this.__wbg_ptr,R(t)?4294967297:t>>>0)}},Vr=typeof FinalizationRegistry=="undefined"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(r=>a.__wbg_rendersession_free(r>>>0,1)),z=class{constructor(){throw new Error("cannot invoke `new` directly")}static __wrap(t){t=t>>>0;let e=Object.create(z.prototype);return e.__wbg_ptr=t,Vr.register(e,e.__wbg_ptr,e),e}__destroy_into_raw(){let t=this.__wbg_ptr;return this.__wbg_ptr=0,Vr.unregister(this),t}free(){let t=this.__destroy_into_raw();a.__wbg_rendersession_free(t,0)}get pixel_per_pt(){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");p(this.__wbg_ptr);let t=a.rendersession_pixel_per_pt(this.__wbg_ptr);return t===4294967297?void 0:t}set pixel_per_pt(t){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");p(this.__wbg_ptr),R(t)||p(t),a.rendersession_set_pixel_per_pt(this.__wbg_ptr,R(t)?4294967297:Math.fround(t))}get background_color(){try{if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");let n=a.__wbindgen_add_to_stack_pointer(-16);p(this.__wbg_ptr),a.rendersession_background_color(n,this.__wbg_ptr);var t=b().getInt32(n+4*0,!0),e=b().getInt32(n+4*1,!0);let i;return t!==0&&(i=I(t,e).slice(),a.__wbindgen_export_3(t,e*1,1)),i}finally{a.__wbindgen_add_to_stack_pointer(16)}}set background_color(t){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");p(this.__wbg_ptr);var e=R(t)?0:W(t,a.__wbindgen_export_1,a.__wbindgen_export_2),n=M;a.rendersession_set_background_color(this.__wbg_ptr,e,n)}get pages_info(){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");p(this.__wbg_ptr);let t=a.rendersession_pages_info(this.__wbg_ptr);return yt.__wrap(t)}get doc_width(){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");return p(this.__wbg_ptr),a.rendersession_doc_width(this.__wbg_ptr)}get doc_height(){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");return p(this.__wbg_ptr),a.rendersession_doc_height(this.__wbg_ptr)}source_span(t){try{if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");let s=a.__wbindgen_add_to_stack_pointer(-16);p(this.__wbg_ptr);let _=wi(t,a.__wbindgen_export_1),d=M;a.rendersession_source_span(s,this.__wbg_ptr,_,d);var e=b().getInt32(s+4*0,!0),n=b().getInt32(s+4*1,!0),i=b().getInt32(s+4*2,!0),o=b().getInt32(s+4*3,!0);if(o)throw A(i);let l;return e!==0&&(l=I(e,n).slice(),a.__wbindgen_export_3(e,n*1,1)),l}finally{a.__wbindgen_add_to_stack_pointer(16)}}render_in_window(t,e,n,i){let o,s;try{if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");let l=a.__wbindgen_add_to_stack_pointer(-16);p(this.__wbg_ptr),a.rendersession_render_in_window(l,this.__wbg_ptr,t,e,n,i);var _=b().getInt32(l+4*0,!0),d=b().getInt32(l+4*1,!0);return o=_,s=d,I(_,d)}finally{a.__wbindgen_add_to_stack_pointer(16),a.__wbindgen_export_3(o,s,1)}}},qr=typeof FinalizationRegistry=="undefined"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(r=>a.__wbg_rendersessionoptions_free(r>>>0,1)),De=class{__destroy_into_raw(){let t=this.__wbg_ptr;return this.__wbg_ptr=0,qr.unregister(this),t}free(){let t=this.__destroy_into_raw();a.__wbg_rendersessionoptions_free(t,0)}constructor(){let t=a.rendersessionoptions_new();return this.__wbg_ptr=t>>>0,qr.register(this,this.__wbg_ptr,this),this}get pixel_per_pt(){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");p(this.__wbg_ptr);let t=a.rendersession_pixel_per_pt(this.__wbg_ptr);return t===4294967297?void 0:t}set pixel_per_pt(t){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");p(this.__wbg_ptr),R(t)||p(t),a.rendersession_set_pixel_per_pt(this.__wbg_ptr,R(t)?4294967297:Math.fround(t))}get background_color(){try{if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");let n=a.__wbindgen_add_to_stack_pointer(-16);p(this.__wbg_ptr),a.rendersessionoptions_background_color(n,this.__wbg_ptr);var t=b().getInt32(n+4*0,!0),e=b().getInt32(n+4*1,!0);let i;return t!==0&&(i=I(t,e).slice(),a.__wbindgen_export_3(t,e*1,1)),i}finally{a.__wbindgen_add_to_stack_pointer(16)}}set background_color(t){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");p(this.__wbg_ptr);var e=R(t)?0:W(t,a.__wbindgen_export_1,a.__wbindgen_export_2),n=M;a.rendersessionoptions_set_background_color(this.__wbg_ptr,e,n)}get format(){try{if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");let n=a.__wbindgen_add_to_stack_pointer(-16);p(this.__wbg_ptr),a.rendersessionoptions_format(n,this.__wbg_ptr);var t=b().getInt32(n+4*0,!0),e=b().getInt32(n+4*1,!0);let i;return t!==0&&(i=I(t,e).slice(),a.__wbindgen_export_3(t,e*1,1)),i}finally{a.__wbindgen_add_to_stack_pointer(16)}}set format(t){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");p(this.__wbg_ptr);var e=R(t)?0:W(t,a.__wbindgen_export_1,a.__wbindgen_export_2),n=M;a.rendersessionoptions_set_format(this.__wbg_ptr,e,n)}},Te=typeof FinalizationRegistry=="undefined"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(r=>a.__wbg_typstrenderer_free(r>>>0,1)),vt=class{static __wrap(t){t=t>>>0;let e=Object.create(vt.prototype);return e.__wbg_ptr=t,Te.register(e,e.__wbg_ptr,e),e}__destroy_into_raw(){let t=this.__wbg_ptr;return this.__wbg_ptr=0,Te.unregister(this),t}free(){let t=this.__destroy_into_raw();a.__wbg_typstrenderer_free(t,0)}create_worker(t){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");p(this.__wbg_ptr);let e=a.typstrenderer_create_worker(this.__wbg_ptr,y(t));return A(e)}create_worker_bridge(){try{if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");let i=this.__destroy_into_raw(),o=a.__wbindgen_add_to_stack_pointer(-16);p(i),a.typstrenderer_create_worker_bridge(o,i);var t=b().getInt32(o+4*0,!0),e=b().getInt32(o+4*1,!0),n=b().getInt32(o+4*2,!0);if(n)throw A(e);return xt.__wrap(t)}finally{a.__wbindgen_add_to_stack_pointer(16)}}mount_dom(t,e){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");if(p(this.__wbg_ptr),J(t,z),t.__wbg_ptr===0)throw new Error("Attempt to use a moved value");let n=a.typstrenderer_mount_dom(this.__wbg_ptr,t.__wbg_ptr,y(e));return A(n)}load_glyph_pack(t){try{if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");let i=a.__wbindgen_add_to_stack_pointer(-16);p(this.__wbg_ptr),a.typstrenderer_load_glyph_pack(i,this.__wbg_ptr,y(t));var e=b().getInt32(i+4*0,!0),n=b().getInt32(i+4*1,!0);if(n)throw A(e)}finally{a.__wbindgen_add_to_stack_pointer(16)}}render_page_to_canvas(t,e,n){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");if(p(this.__wbg_ptr),J(t,z),t.__wbg_ptr===0)throw new Error("Attempt to use a moved value");let i=0;if(!R(n)){if(J(n,ot),n.__wbg_ptr===0)throw new Error("Attempt to use a moved value");i=n.__destroy_into_raw()}let o=a.typstrenderer_render_page_to_canvas(this.__wbg_ptr,t.__wbg_ptr,y(e),i);return A(o)}render_svg_diff(t,e,n,i,o){let s,_;try{if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");let w=a.__wbindgen_add_to_stack_pointer(-16);if(p(this.__wbg_ptr),J(t,z),t.__wbg_ptr===0)throw new Error("Attempt to use a moved value");a.typstrenderer_render_svg_diff(w,this.__wbg_ptr,t.__wbg_ptr,e,n,i,o);var d=b().getInt32(w+4*0,!0),l=b().getInt32(w+4*1,!0);return s=d,_=l,I(d,l)}finally{a.__wbindgen_add_to_stack_pointer(16),a.__wbindgen_export_3(s,_,1)}}svg_data(t,e){let n,i;try{if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");let m=a.__wbindgen_add_to_stack_pointer(-16);if(p(this.__wbg_ptr),J(t,z),t.__wbg_ptr===0)throw new Error("Attempt to use a moved value");R(e)||p(e),a.typstrenderer_svg_data(m,this.__wbg_ptr,t.__wbg_ptr,R(e)?4294967297:e>>>0);var o=b().getInt32(m+4*0,!0),s=b().getInt32(m+4*1,!0),_=b().getInt32(m+4*2,!0),d=b().getInt32(m+4*3,!0),l=o,w=s;if(d)throw l=0,w=0,A(_);return n=l,i=w,I(l,w)}finally{a.__wbindgen_add_to_stack_pointer(16),a.__wbindgen_export_3(n,i,1)}}get_customs(t){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");if(p(this.__wbg_ptr),J(t,z),t.__wbg_ptr===0)throw new Error("Attempt to use a moved value");let e=a.typstrenderer_get_customs(this.__wbg_ptr,t.__wbg_ptr);return A(e)}render_svg(t,e){try{if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");let s=a.__wbindgen_add_to_stack_pointer(-16);if(p(this.__wbg_ptr),J(t,z),t.__wbg_ptr===0)throw new Error("Attempt to use a moved value");a.typstrenderer_render_svg(s,this.__wbg_ptr,t.__wbg_ptr,y(e));var n=b().getInt32(s+4*0,!0),i=b().getInt32(s+4*1,!0),o=b().getInt32(s+4*2,!0);if(o)throw A(i);return n!==0}finally{a.__wbindgen_add_to_stack_pointer(16)}}constructor(){let t=a.typstrenderer_new();return this.__wbg_ptr=t>>>0,Te.register(this,this.__wbg_ptr,this),this}create_session(t){try{if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");let o=a.__wbindgen_add_to_stack_pointer(-16);p(this.__wbg_ptr);let s=0;if(!R(t)){if(J(t,ee),t.__wbg_ptr===0)throw new Error("Attempt to use a moved value");s=t.__destroy_into_raw()}a.typstrenderer_create_session(o,this.__wbg_ptr,s);var e=b().getInt32(o+4*0,!0),n=b().getInt32(o+4*1,!0),i=b().getInt32(o+4*2,!0);if(i)throw A(n);return z.__wrap(e)}finally{a.__wbindgen_add_to_stack_pointer(16)}}reset(t){try{if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");let i=a.__wbindgen_add_to_stack_pointer(-16);if(p(this.__wbg_ptr),J(t,z),t.__wbg_ptr===0)throw new Error("Attempt to use a moved value");a.typstrenderer_reset(i,this.__wbg_ptr,t.__wbg_ptr);var e=b().getInt32(i+4*0,!0),n=b().getInt32(i+4*1,!0);if(n)throw A(e)}finally{a.__wbindgen_add_to_stack_pointer(16)}}manipulate_data(t,e,n){try{if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");let s=a.__wbindgen_add_to_stack_pointer(-16);if(p(this.__wbg_ptr),J(t,z),t.__wbg_ptr===0)throw new Error("Attempt to use a moved value");let _=W(e,a.__wbindgen_export_1,a.__wbindgen_export_2),d=M,l=te(n,a.__wbindgen_export_1),w=M;a.typstrenderer_manipulate_data(s,this.__wbg_ptr,t.__wbg_ptr,_,d,l,w);var i=b().getInt32(s+4*0,!0),o=b().getInt32(s+4*1,!0);if(o)throw A(i)}finally{a.__wbindgen_add_to_stack_pointer(16)}}session_from_artifact(t,e){try{if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");let s=a.__wbindgen_add_to_stack_pointer(-16);p(this.__wbg_ptr);let _=te(t,a.__wbindgen_export_1),d=M,l=W(e,a.__wbindgen_export_1,a.__wbindgen_export_2),w=M;a.typstrenderer_session_from_artifact(s,this.__wbg_ptr,_,d,l,w);var n=b().getInt32(s+4*0,!0),i=b().getInt32(s+4*1,!0),o=b().getInt32(s+4*2,!0);if(o)throw A(i);return z.__wrap(n)}finally{a.__wbindgen_add_to_stack_pointer(16)}}},Hr=typeof FinalizationRegistry=="undefined"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(r=>a.__wbg_typstrendererbuilder_free(r>>>0,1)),Be=class{__destroy_into_raw(){let t=this.__wbg_ptr;return this.__wbg_ptr=0,Hr.unregister(this),t}free(){let t=this.__destroy_into_raw();a.__wbg_typstrendererbuilder_free(t,0)}constructor(){try{let i=a.__wbindgen_add_to_stack_pointer(-16);a.typstrendererbuilder_new(i);var t=b().getInt32(i+4*0,!0),e=b().getInt32(i+4*1,!0),n=b().getInt32(i+4*2,!0);if(n)throw A(e);return this.__wbg_ptr=t>>>0,Hr.register(this,this.__wbg_ptr,this),this}finally{a.__wbindgen_add_to_stack_pointer(16)}}build(){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");let t=this.__destroy_into_raw();p(t);let e=a.typstrendererbuilder_build(t);return A(e)}add_glyph_pack(t){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");p(this.__wbg_ptr);let e=a.typstrendererbuilder_add_glyph_pack(this.__wbg_ptr,y(t));return A(e)}add_raw_font(t){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");p(this.__wbg_ptr);let e=a.typstrendererbuilder_add_raw_font(this.__wbg_ptr,y(t));return A(e)}add_web_fonts(t){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");p(this.__wbg_ptr);let e=a.typstrendererbuilder_add_web_fonts(this.__wbg_ptr,y(t));return A(e)}},vi=typeof FinalizationRegistry=="undefined"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(r=>a.__wbg_typstworker_free(r>>>0,1)),je=class{constructor(){throw new Error("cannot invoke `new` directly")}__destroy_into_raw(){let t=this.__wbg_ptr;return this.__wbg_ptr=0,vi.unregister(this),t}free(){let t=this.__destroy_into_raw();a.__wbg_typstworker_free(t,0)}manipulate_data(t,e){try{if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");let s=a.__wbindgen_add_to_stack_pointer(-16);p(this.__wbg_ptr);let _=W(t,a.__wbindgen_export_1,a.__wbindgen_export_2),d=M;a.typstworker_manipulate_data(s,this.__wbg_ptr,_,d,y(e));var n=b().getInt32(s+4*0,!0),i=b().getInt32(s+4*1,!0),o=b().getInt32(s+4*2,!0);if(o)throw A(i);return A(n)}finally{a.__wbindgen_add_to_stack_pointer(16)}}get_pages_info(){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");p(this.__wbg_ptr);let t=a.typstworker_get_pages_info(this.__wbg_ptr);return A(t)}render_canvas(t,e,n){try{if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");let _=a.__wbindgen_add_to_stack_pointer(-16);p(this.__wbg_ptr);let d=te(t,a.__wbindgen_export_1),l=M,w=Br(e,a.__wbindgen_export_1),m=M,L=Br(n,a.__wbindgen_export_1),F=M;a.typstworker_render_canvas(_,this.__wbg_ptr,d,l,w,m,L,F);var i=b().getInt32(_+4*0,!0),o=b().getInt32(_+4*1,!0),s=b().getInt32(_+4*2,!0);if(s)throw A(o);return A(i)}finally{a.__wbindgen_add_to_stack_pointer(16)}}},Gr=typeof FinalizationRegistry=="undefined"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(r=>a.__wbg_workerbridge_free(r>>>0,1)),xt=class{constructor(){throw new Error("cannot invoke `new` directly")}static __wrap(t){t=t>>>0;let e=Object.create(xt.prototype);return e.__wbg_ptr=t,Gr.register(e,e.__wbg_ptr,e),e}__destroy_into_raw(){let t=this.__wbg_ptr;return this.__wbg_ptr=0,Gr.unregister(this),t}free(){let t=this.__destroy_into_raw();a.__wbg_workerbridge_free(t,0)}};Yr=Qr,Zr=async function(r,t){throw new Error("Cannot import wasm module without importer: "+r+" "+t)}});var $e={};Z($e,{CreateSessionOptions:()=>ee,IncrDomDocClient:()=>mt,PageInfo:()=>it,PagesInfo:()=>yt,RenderPageImageOptions:()=>ot,RenderSession:()=>z,RenderSessionOptions:()=>De,TypstRenderer:()=>vt,TypstRendererBuilder:()=>Be,TypstWorker:()=>je,WorkerBridge:()=>xt,default:()=>Ei,initSync:()=>ki,renderer_build_info:()=>pi,setImportWasmModule:()=>We});var Ei,Ii,Si,ze=j(()=>{re();re();re();Ei=Yr,Ii=async function(r,t){let e=new Function("m","return import(m)"),{readFileSync:n}=await e("fs"),i=new URL(r,t);return await n(i).buffer},Si=typeof process!="undefined"&&process.versions!=null&&process.versions.node!=null;Si&&We(Ii)});var Ne={};Z(Ne,{RenderSession:()=>Ct,TypstRendererDriver:()=>Tt,TypstWorker:()=>ne,createTypstRenderer:()=>Ri,createTypstSvgRenderer:()=>Pi,rendererBuildInfo:()=>Mi});function Ri(){return new Tt}function Pi(){return new Tt}async function Mi(){return(await Promise.resolve().then(()=>(ze(),$e))).renderer_build_info()}var Li,Ct,kt,Fi,ne,Ai,tn,Tt,Ue=j(()=>{St();Pr();ye();me();Or();Ct=class{constructor(t,e){g(this,"plugin");g(this,Li);this.plugin=t,this[E]=e}set backgroundColor(t){t!==void 0&&(this[E].background_color=t)}get backgroundColor(){return this[E].background_color}set pixelPerPt(t){t!==void 0&&(this[E].pixel_per_pt=t)}get pixelPerPt(){return this[E].pixel_per_pt}reset(){this.plugin.resetSession(this)}get doc_width(){return this[E].doc_width}get docWidth(){return this[E].doc_width}get doc_height(){return this[E].doc_height}get docHeight(){return this[E].doc_height}retrievePagesInfo(){let t=this[E].pages_info,e=[],n=t.page_count;for(let i=0;i<n;i++){let o=t.page(i);e.push({pageOffset:o.page_off,width:o.width_pt,height:o.height_pt})}return e}getSourceLoc(t){return this[E].source_span(t)}renderSvg(t){return this.plugin.renderSvg({renderSession:this,...t})}renderToSvg(t){return this.plugin.renderToSvg({renderSession:this,...t})}renderCanvas(t){return this.plugin.renderCanvas({renderSession:this,...t})}manipulateData(t){this.plugin.manipulateData({renderSession:this,...t})}renderSvgDiff(t){return this.plugin.renderSvgDiff({renderSession:this,...t})}get_source_loc(t){return this[E].source_span(t)}render_in_window(t,e,n,i){return this[E].render_in_window(t,e,n,i)}merge_delta(t){this.plugin.manipulateData({renderSession:this,action:"merge",data:t})}};Li=E;(function(r){r[r.Delete=0]="Delete",r[r.New=1]="New",r[r.Update=2]="Update"})(kt||(kt={}));ne=class{constructor(t,e){g(this,"plugin");g(this,Fi);g(this,"managedCanvasElemList",new Map);g(this,"canvasCounter",Math.random());this.plugin=t,this[E]=e}manipulateData(t,e){return this[E].manipulate_data(t,e)}renderCanvas(t){let e=this.managedCanvasElemList;for(let[_,d]of e)d[0]=kt.Delete;for(let _ of t){let d=_.canvas,l=d.dataset.manageId,w=kt.Update;l||(l=this.canvasCounter.toFixed(5),this.canvasCounter+=1,d.dataset.manageId=l,w=kt.New);let m=e.get(l);if(m&&m[0]!==kt.Delete)throw new Error("cannot update a canvas for two times in batch");e.set(l,[w,{..._}])}let n=Array.from(e.entries()),i=new Uint8Array(n.length),o=new Array(n.length),s=n.map(([_,[d,l]],w)=>(d||e.delete(_),i[w]=d,o[w]=l.canvas,this.plugin.canvasOptionsToRust(l)));return this[E].render_canvas(i,o,s)}async retrievePagesInfo(){let t=await this[E].get_pages_info();console.log(t);let e=[],n=t.page_count;for(let i=0;i<n;i++){let o=t.page(i);e.push({pageOffset:o.page_off,width:o.width_pt,height:o.height_pt})}return e}};Fi=E;Ai=r=>new lt(async t=>await r.default(t));tn=!0,Tt=class{constructor(){g(this,"renderer");g(this,"rendererJs")}async init(t){var n;this.rendererJs=await(((n=t==null?void 0:t.getWrapper)==null?void 0:n.call(t))||Promise.resolve().then(()=>(ze(),$e)));let e=this.rendererJs.TypstRendererBuilder;this.renderer=await Vt(t,Ai(this.rendererJs),e,{})}loadGlyphPack(t){return Promise.resolve()}createOptionsToRust(t){let e=new this.rendererJs.CreateSessionOptions;return t.format!==void 0&&(e.format=t.format),t.artifactContent!==void 0&&(e.artifact_content=t.artifactContent),e}canvasOptionsToRust(t){let e=new this.rendererJs.RenderPageImageOptions;if(t.pageOffset===void 0)throw new Error("pageOffset is required in reflexo v0.5.0");if(e.page_off=t.pageOffset,t.cacheKey!==void 0&&(e.cache_key=t.cacheKey),t.backgroundColor!==void 0&&(e.background_color=t.backgroundColor),t.pixelPerPt!==void 0&&(e.pixel_per_pt=t.pixelPerPt),t.dataSelection!==void 0){let n=0;t.dataSelection.body?n|=1<<0:t.canvas&&tn&&(tn=!1,console.warn("dataSelection.body is not set but providing canvas for body")),(t.dataSelection.text||t.dataSelection.annotation)&&console.error("dataSelection.text and dataSelection.annotation are deprecated"),t.dataSelection.semantics&&(n|=1<<3),e.data_selection=n}return e}retrievePagesInfoFromSession(t){return t.retrievePagesInfo()}renderCanvas(t){return this.withinOptionSession(t,async e=>this.renderer.render_page_to_canvas(e[E],t.canvas||void 0,this.canvasOptionsToRust(t)))}async inAnimationFrame(t){return new Promise((e,n)=>{requestAnimationFrame(()=>{try{e(t())}catch(i){n(i)}})})}async renderDisplayLayer(t,e,n){let o=t[E].pages_info.page_count,s=async(w,m)=>{let F=e[w].getContext("2d");if(!F)throw new Error("canvas context is null");return await this.renderCanvas({...n,canvas:F,renderSession:t,pageOffset:m})},_=performance.now(),d=await(async()=>{let w=[];for(let m=0;m<o;m++)w.push(await this.inAnimationFrame(()=>s(m,m)));return w})(),l=performance.now();return console.log(`display layer used: render = ${(l-_).toFixed(1)}ms`),d}renderTextLayer(t,e){let n=performance.now();t.forEach((o,s)=>{o.innerHTML=e[s].htmlSemantics[0]});let i=performance.now();console.log(`text layer used: render = ${(i-n).toFixed(1)}ms`)}async render(t){if("format"in t&&t.format!=="vector"&&["serde_json","js","ir"].includes(t.format))throw new Error(`deprecated format ${t.format}, please use vector format`);return this.renderToCanvas(t)}async renderDom(t){if("format"in t&&t.format!=="vector"&&["serde_json","js","ir"].includes(t.format))throw new Error(`deprecated format ${t.format}, please use vector format`);return this.withinOptionSession(t,async e=>{let n=new Qt({...t,renderMode:"dom",hookedElem:t.container,kModule:e,renderer:this});return await n.impl.mountDom(t.pixelPerPt),n})}async renderToCanvas(t){let e,n,i=t.container;i.style.visibility="hidden";let o=async(s,_)=>{try{n=await this.renderDisplayLayer(e,s,t),_()}finally{i.style.visibility="visible"}};return this.withinOptionSession(t,async s=>{var m;if(e=s,e[E].pages_info.page_count===0)throw new Error("No page found in session");if(t.pixelPerPt!==void 0&&t.pixelPerPt<=0)throw new Error("Invalid typst.RenderOptions.pixelPerPt, should be a positive number "+t.pixelPerPt);let _=t.backgroundColor;if(_!==void 0&&!/^#[0-9a-f]{6}$/.test(_))throw new Error("Invalid typst.backgroundColor color for matching ^#?[0-9a-f]{6}$ "+_);e.pixelPerPt=(m=t.pixelPerPt)!=null?m:dt.PIXEL_PER_PT,e.backgroundColor=_!=null?_:"#ffffff";let d=performance.now(),l=new Kt(this.retrievePagesInfoFromSession(e),i,t),w=performance.now();console.log(`layer used: retrieve = ${(w-d).toFixed(1)}ms`),await o(l.canvasList,()=>l.resetLayout()),this.renderTextLayer(l.textLayerList,n)})}createModule(t){return Promise.resolve(new Ct(this,this.renderer.create_session(t&&this.createOptionsToRust({format:"vector",artifactContent:t}))))}async createWorkerV0(t){return new ne(this,await this.renderer.create_worker(t))}workerBridge(){return this.renderer.create_worker_bridge()}renderSvg(t,e){if(t instanceof Ct||e)throw new Error("removed api, please use renderToSvg({ renderSession, container }) instead");return this.withinOptionSession(t,async n=>{let i;return t.data_selection&&(i=0,t.data_selection.body&&(i|=1<<0),t.data_selection.defs&&(i|=1<<1),t.data_selection.css&&(i|=1<<2),t.data_selection.js&&(i|=1<<3)),Promise.resolve(this.renderer.svg_data(n[E],i))})}renderSvgDiff(t){return t.window?this.renderer.render_svg_diff(t.renderSession[E],t.window.lo.x,t.window.lo.y,t.window.hi.x,t.window.hi.y):this.renderer.render_svg_diff(t.renderSession[E],0,0,1e33,1e33)}renderToSvg(t){return this.withinOptionSession(t,async e=>Promise.resolve(this.renderer.render_svg(e[E],t.container)))}getCustomV1(t){return Promise.resolve(this.renderer.get_customs(t.renderSession[E]))}resetSession(t){return this.renderer.reset(t[E])}manipulateData(t){var e;return this.renderer.manipulate_data(t.renderSession[E],(e=t.action)!=null?e:"reset",t.data)}withinOptionSession(t,e){function n(i){return"artifactContent"in i}if("renderSession"in t)return e(t.renderSession);if(n(t))return this.runWithSession(t,e);throw new Error("Invalid render options, should be one of RenderByContentOptions|RenderBySessionOptions")}async runWithSession(t,e){let n=t,i=e;e||(n=void 0,i=t);let o=this.renderer.create_session(n&&this.createOptionsToRust(n));try{let s=await i(new Ct(this,o));return o.free(),s}catch(s){throw o.free(),s}}}});var on={};Z(on,{createGlobalRenderer:()=>nn,getGlobalRenderer:()=>rn,withGlobalRenderer:()=>Ti});function rn(){return en?qe:void 0}function nn(r,t){let e=qe||r();return Ve!==void 0?Ve:Ve=(async()=>(en=!0,await e.init(t),qe=e))()}function Ti(r,t,e,n){let i=rn();if(i){e(i);return}nn(r,t).then(e).catch(n)}var qe,Ve,en,sn=j(()=>{en=!1});var Di={};Z(Di,{default:()=>oe});module.exports=mn(Di);var se=require("obsidian");var Dt=require("obsidian");var U=require("@codemirror/view"),ce=require("@codemirror/state");var Ye=require("@codemirror/view"),Wt=require("@codemirror/language"),k=require("@lezer/highlight"),yn="#e5c07b",Ge="#e06c75",vn="#56b6c2",xn="#ffffff",jt="#abb2bf",_e="#7d8799",kn="#61afef",Cn="#98c379",Je="#d19a66",En="#c678dd",In="#21252b",Ke="#2c313a",Xe="#282c34",ae="#353a42",Sn="#3E4451",Qe="#528bff";var An=Ye.EditorView.theme({"&":{color:jt,backgroundColor:Xe},".cm-content":{caretColor:Qe},".cm-cursor, .cm-dropCursor":{borderLeftColor:Qe},"&.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground, .cm-selectionBackground, .cm-content ::selection":{backgroundColor:Sn},".cm-panels":{backgroundColor:In,color:jt},".cm-panels.cm-panels-top":{borderBottom:"2px solid black"},".cm-panels.cm-panels-bottom":{borderTop:"2px solid black"},".cm-searchMatch":{backgroundColor:"#72a1ff59",outline:"1px solid #457dff"},".cm-searchMatch.cm-searchMatch-selected":{backgroundColor:"#6199ff2f"},".cm-activeLine":{backgroundColor:"#6699ff0b"},".cm-selectionMatch":{backgroundColor:"#aafe661a"},"&.cm-focused .cm-matchingBracket, &.cm-focused .cm-nonmatchingBracket":{backgroundColor:"#bad0f847"},".cm-gutters":{backgroundColor:Xe,color:_e,border:"none"},".cm-activeLineGutter":{backgroundColor:Ke},".cm-foldPlaceholder":{backgroundColor:"transparent",border:"none",color:"#ddd"},".cm-tooltip":{border:"none",backgroundColor:ae},".cm-tooltip .cm-tooltip-arrow:before":{borderTopColor:"transparent",borderBottomColor:"transparent"},".cm-tooltip .cm-tooltip-arrow:after":{borderTopColor:ae,borderBottomColor:ae},".cm-tooltip-autocomplete":{"& > ul > li[aria-selected]":{backgroundColor:Ke,color:jt}}},{dark:!0}),Rn=Wt.HighlightStyle.define([{tag:k.tags.keyword,color:En},{tag:[k.tags.name,k.tags.deleted,k.tags.character,k.tags.propertyName,k.tags.macroName],color:Ge},{tag:[k.tags.function(k.tags.variableName),k.tags.labelName],color:kn},{tag:[k.tags.color,k.tags.constant(k.tags.name),k.tags.standard(k.tags.name)],color:Je},{tag:[k.tags.definition(k.tags.name),k.tags.separator],color:jt},{tag:[k.tags.typeName,k.tags.className,k.tags.number,k.tags.changed,k.tags.annotation,k.tags.modifier,k.tags.self,k.tags.namespace],color:yn},{tag:[k.tags.operator,k.tags.operatorKeyword,k.tags.url,k.tags.escape,k.tags.regexp,k.tags.link,k.tags.special(k.tags.string)],color:vn},{tag:[k.tags.meta,k.tags.comment],color:_e},{tag:k.tags.strong,fontWeight:"bold"},{tag:k.tags.emphasis,fontStyle:"italic"},{tag:k.tags.strikethrough,textDecoration:"line-through"},{tag:k.tags.link,color:_e,textDecoration:"underline"},{tag:k.tags.heading,fontWeight:"bold",color:Ge},{tag:[k.tags.atom,k.tags.bool,k.tags.special(k.tags.variableName)],color:Je},{tag:[k.tags.processingInstruction,k.tags.string,k.tags.inserted],color:Cn},{tag:k.tags.invalid,color:xn}]),Ze=[An,(0,Wt.syntaxHighlighting)(Rn)];var _t=require("@codemirror/commands"),tr=require("@codemirror/language"),er=require("@codemirror/autocomplete"),zt=require("@codemirror/search"),$t=class{constructor(t,e,n){this.editorView=null;this.content="";this.container=t,this.app=e,this.onContentChange=n}initialize(t=""){this.content=t,this.createEditor()}createEditor(){this.container.empty();let t=this.container.createDiv("typst-editor-container"),e=document.body.classList.contains("theme-dark"),n=[(0,U.lineNumbers)(),(0,U.dropCursor)(),(0,U.rectangularSelection)(),(0,U.highlightActiveLine)(),(0,_t.history)(),U.EditorView.lineWrapping,(0,tr.bracketMatching)(),(0,er.closeBrackets)(),(0,zt.highlightSelectionMatches)(),ce.EditorState.allowMultipleSelections.of(!0),U.keymap.of([_t.indentWithTab,..._t.defaultKeymap,...zt.searchKeymap]),...e?[Ze]:[],U.EditorView.updateListener.of(i=>{i.docChanged&&(this.content=i.state.doc.toString(),this.onContentChange&&this.onContentChange(this.content))})];this.editorView=new U.EditorView({state:ce.EditorState.create({doc:this.content,extensions:n}),parent:t})}getContent(){return this.editorView?this.editorView.state.doc.toString():this.content}setContent(t){if(this.editorView){let e=this.editorView.state.update({changes:{from:0,to:this.editorView.state.doc.length,insert:t}});this.editorView.dispatch(e)}this.content=t}focus(){var t;(t=this.editorView)==null||t.focus()}destroy(){this.editorView&&(this.editorView.destroy(),this.editorView=null)}};var He=require("obsidian");de();var ut=class{constructor(){g(this,"mTimes",new Map);g(this,"mData",new Map)}reset(){this.mTimes.clear(),this.mData.clear()}insertFile(t,e,n){this.mTimes.set(t,n),this.mData.set(t,e)}removeFile(t){this.mTimes.delete(t),this.mData.delete(t)}getMTime(t){if(t.startsWith("/@memory/")&&this.mTimes.has(t))return this.mTimes.get(t)}isFile(){return!0}getRealPath(t){return t}readAll(t){if(t.startsWith("/@memory/")&&this.mData.has(t))return this.mData.get(t)}};var It=class{constructor(t){g(this,"am");g(this,"cache",new Map);this.am=t}resolvePath(t){return`https://packages.typst.org/preview/${t.name}-${t.version}.tar.gz`}pullPackageData(t){let e=new XMLHttpRequest;if(e.overrideMimeType("text/plain; charset=x-user-defined"),e.open("GET",this.resolvePath(t),!1),e.send(null),e.status===200&&(e.response instanceof String||typeof e.response=="string"))return Uint8Array.from(e.response,n=>n.charCodeAt(0))}resolve(t,e){if(t.namespace!=="preview")return;let n=this.resolvePath(t);if(this.cache.has(n))return this.cache.get(n)();let i=this.pullPackageData(t);if(!i)return;let o=`/@memory/fetch/packages/preview/${t.namespace}/${t.name}/${t.version}`,s=[];e.untar(i,(d,l,w)=>{s.push([o+"/"+d,l,new Date(w)])});let _=()=>{for(let[d,l,w]of s)this.am.insertFile(d,l,w);return o};return this.cache.set(n,_),_()}};function ir(r){return Math.random().toString(36).replace("0.",r||"")}var Oi=typeof process!="undefined"&&process.versions!=null&&process.versions.node!=null,q=class{constructor(t){g(this,"mainFilePath");g(this,"cc");g(this,"ex");g(this,"providers");g(this,"ccOptions");g(this,"exOptions");g(this,"prepareUseOnce");this.cc=(t==null?void 0:t.compiler)||q.buildLocalCompiler,this.ex=(t==null?void 0:t.renderer)||q.buildLocalRenderer,this.mainFilePath="/main.typ",this.providers=[]}setCompiler(t){this.cc=t}async getCompiler(){return typeof this.cc=="function"?this.cc=await this.cc():this.cc}setRenderer(t){this.ex=t}async getRenderer(){return typeof this.ex=="function"?this.ex=await this.ex():this.ex}use(...t){if(!this.providers)throw new Error("already prepare uses for instances");this.providers.push(...t)}static preloadFontFromUrl(t){return q.preloadFonts([t])}static preloadFontData(t){return q.preloadFonts([t])}static preloadFonts(t){return{key:"access-model",forRoles:["compiler"],provides:[ct(t)]}}static disableDefaultFontAssets(){return{key:"access-model",forRoles:["compiler"],provides:[rr()]}}static preloadFontAssets(t){return{key:"access-model",forRoles:["compiler"],provides:[nr(t)]}}static withAccessModel(t){return{key:"access-model",forRoles:["compiler"],provides:[ue(t)]}}static withPackageRegistry(t){return{key:"package-registry",forRoles:["compiler"],provides:[Nt(t)]}}static fetchPackageRegistry(t){let e=t||new ut,n=[...t?[]:[ue(e)],Nt(new It(e))];return{key:"package-registry$fetch",forRoles:["compiler"],provides:n}}static fetchPackageBy(t,e){class n extends It{pullPackageData(o){return e(o,this.resolvePath(o))}}return{key:"package-registry$lambda",forRoles:["compiler"],provides:[Nt(new n(t))]}}setCompilerInitOptions(t){this.requireIsUninitialized("compiler",this.cc),this.ccOptions=t}setRendererInitOptions(t){this.requireIsUninitialized("renderer",this.ex),this.exOptions=t}setMainFilePath(t){this.mainFilePath=t}getMainFilePath(){return this.mainFilePath}removeTmp(t){return t.mainFilePath.startsWith("/tmp/")?this.unmapShadow(t.mainFilePath):Promise.resolve()}async addSource(t,e){(await this.getCompiler()).addSource(t,e)}async resetShadow(){(await this.getCompiler()).resetShadow()}async mapShadow(t,e){(await this.getCompiler()).mapShadow(t,e)}async unmapShadow(t){(await this.getCompiler()).unmapShadow(t)}async vector(t){let e=await this.getCompileOptions(t);return(await this.getCompiler()).compile(e).then(n=>n.result).finally(()=>this.removeTmp(e))}async pdf(t){let e=await this.getCompileOptions(t);return e.format="pdf",(await this.getCompiler()).compile(e).then(n=>n.result).finally(()=>this.removeTmp(e))}async svg(t){return this.transientRender(t,(e,n)=>e.renderSvg({...t,renderSession:n}))}async canvas(t,e){return this.transientRender(e,(n,i)=>n.renderToCanvas({container:t,...e,renderSession:i}))}async query(t){let e=await this.getCompileOptions(t);return(await this.getCompiler()).query({...t,...e}).finally(()=>this.removeTmp(e))}async getSemanticTokenLegend(){return(await this.getCompiler()).getSemanticTokenLegend()}async getSemanticTokens(t){let e=await this.getCompileOptions(t);return(await this.getCompiler()).getSemanticTokens({mainFilePath:e.mainFilePath,resultId:t.resultId}).finally(()=>this.removeTmp(e))}async getCompileOptions(t){if(t===void 0)return{mainFilePath:this.mainFilePath,diagnostics:"none"};if(typeof t=="string")throw new Error("please specify opts as {mainContent: '...'} or {mainFilePath: '...'}");if("mainFilePath"in t)return{...t,diagnostics:"none"};{let e=`/tmp/${ir()}.typ`;return await this.addSource(e,t.mainContent),{mainFilePath:e,inputs:t.inputs,diagnostics:"none"}}}async getVector(t){if(t&&"vectorData"in t)return t.vectorData;let e=await this.getCompileOptions(t);return(await this.getCompiler()).compile(e).then(n=>n.result).finally(()=>this.removeTmp(e))}async transientRender(t,e){let n=await this.getRenderer();if(!n)throw new Error("does not provide renderer instance");let i=await this.getVector(t);return await n.runWithSession(async o=>(n.manipulateData({renderSession:o,action:"reset",data:i}),e(n,o)))}async prepareUse(){return this.prepareUseOnce?this.prepareUseOnce:this.prepareUseOnce=this.doPrepareUse()}async doPrepareUse(){if(!this.providers)return;let t=await Promise.all(this.providers.map(_=>typeof _=="function"?_():_));if(this.providers=[],st==this&&!t.some(_=>_.key.includes("package-registry")||_.key.includes("access-model")))if(Oi){let _=new Function("m","return import(m)");try{let d=new ut,{default:l}=await _("sync-request");st.use(q.withAccessModel(d),q.fetchPackageBy(d,(w,m)=>{let L=l("GET",m);if(L.statusCode===200)return L.getBody(void 0)}))}catch(d){}}else st.use(q.fetchPackageRegistry());let e=await Promise.all(this.providers.map(_=>typeof _=="function"?_():_)),n=this.ccOptions||(this.ccOptions={}),i=n.beforeBuild||(n.beforeBuild=[]),o=this.exOptions||(this.exOptions={}),s=o.beforeBuild||(o.beforeBuild=[]);for(let _ of[...t,...e])_.forRoles.includes("compiler")&&(this.requireIsUninitialized("compiler",this.cc),i.push(..._.provides)),_.forRoles.includes("renderer")&&(this.requireIsUninitialized("renderer",this.ex),s.push(..._.provides));this.providers=void 0}requireIsUninitialized(t,e,n){if(e&&typeof e!="function")throw new Error(`${t} has been initialized: ${e}`)}static async buildLocalCompiler(){let{createTypstCompiler:t}=await Promise.resolve().then(()=>(Pe(),Ae));await this.prepareUse();let e=t();return await e.init(this.ccOptions),e}static async buildGlobalCompiler(){let{createGlobalCompiler:t}=await Promise.resolve().then(()=>(Rr(),Ar)),{createTypstCompiler:e}=await Promise.resolve().then(()=>(Pe(),Ae));return await this.prepareUse(),t(e,this.ccOptions)}static async buildLocalRenderer(){let{createTypstRenderer:t}=await Promise.resolve().then(()=>(Ue(),Ne));await this.prepareUse();let e=t();return await e.init(this.exOptions),e}static async buildGlobalRenderer(){let{createGlobalRenderer:t}=await Promise.resolve().then(()=>(sn(),on)),{createTypstRenderer:e}=await Promise.resolve().then(()=>(Ue(),Ne));return await this.prepareUse(),t(e,this.exOptions)}},st=new q({compiler:q.buildGlobalCompiler,renderer:q.buildGlobalRenderer});var Et=class{constructor(){this.initialized=!1}static getInstance(){return Et.instance||(Et.instance=new Et),Et.instance}async ensureInitialized(){if(!this.initialized)try{st.setCompilerInitOptions({getModule:()=>"https://cdn.jsdelivr.net/npm/@myriaddreamin/typst-ts-web-compiler/pkg/typst_ts_web_compiler_bg.wasm"}),st.setRendererInitOptions({getModule:()=>"https://cdn.jsdelivr.net/npm/@myriaddreamin/typst-ts-renderer/pkg/typst_ts_renderer_bg.wasm"}),this.initialized=!0}catch(t){throw console.error("Failed to initialize Typst compiler:",t),new He.Notice("Failed to initialize Typst compiler"),t}}async compileToSvg(t){try{return await this.ensureInitialized(),await st.svg({mainContent:t})}catch(e){console.error("Typst compilation failed:",e);let n=e.message||"Unknown compilation error";return new He.Notice(`Typst compilation failed: ${n}`),null}}destroy(){this.initialized=!1}},Ot=Et;Ot.instance=null;var at=class extends Dt.TextFileView{constructor(){super(...arguments);this.currentMode="source";this.modeIconContainer=null;this.typstEditor=null;this.fileContent=""}getViewType(){return"typst-view"}getDisplayText(){var e;return((e=this.file)==null?void 0:e.basename)||"Typst File"}getIcon(){return"typst-file"}async onOpen(){await super.onOpen(),this.addModeIcon()}onClose(){return this.typstEditor&&(this.typstEditor.destroy(),this.typstEditor=null),super.onClose()}addModeIcon(){let e=this.containerEl.querySelector(".view-actions");e&&(this.modeIconContainer=e.createDiv("clickable-icon"),this.modeIconContainer.addClass("view-action"),this.modeIconContainer.addEventListener("click",()=>{this.toggleMode()}),this.updateModeIcon())}async toggleMode(){if(this.currentMode==="source"){let e=this.getViewData(),i=await Ot.getInstance().compileToSvg(e);if(!i)return;this.currentMode="reading",this.updateModeIcon(),this.showReadingMode(i)}else this.currentMode="source",this.updateModeIcon(),this.showSourceMode()}getCurrentMode(){return this.currentMode}updateModeIcon(){this.modeIconContainer&&(this.modeIconContainer.empty(),this.currentMode==="source"?((0,Dt.setIcon)(this.modeIconContainer,"pencil-line"),this.modeIconContainer.setAttribute("aria-label","Currently in source mode. Click to switch to reading mode.")):((0,Dt.setIcon)(this.modeIconContainer,"book-open"),this.modeIconContainer.setAttribute("aria-label","Currently in reading mode. Click to switch to source mode.")))}async setViewData(e,n){this.fileContent=e,this.currentMode==="source"?this.showSourceMode():this.showReadingMode()}getViewData(){return this.currentMode==="source"&&this.typstEditor?this.typstEditor.getContent():this.fileContent}showSourceMode(){let e=this.containerEl.querySelector(".view-content");e&&(e.empty(),this.typstEditor&&(this.typstEditor.destroy(),this.typstEditor=null),this.typstEditor=new $t(e,this.app,n=>{this.fileContent=n,this.requestSave()}),this.typstEditor.initialize(this.fileContent))}showReadingMode(e){let n=this.containerEl.querySelector(".view-content");if(n){n.empty(),this.typstEditor&&(this.typstEditor.destroy(),this.typstEditor=null);let i=n.createDiv("typst-reading-mode");i.innerHTML=`
        <div class="typst-rendered-content">
          ${e}
        </div>
      `}}clear(){this.fileContent="",this.typstEditor&&this.typstEditor.setContent("")}};var an=require("obsidian");var H=require("obsidian"),ie=class extends H.Modal{constructor(e,n){super(e);this.fileName="";this.plugin=n}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"Create New Typst File"}),new H.Setting(e).setName("File name").setDesc("Enter the name of the Typst file (without .typ extension)").addText(s=>{s.setPlaceholder("note").setValue(this.fileName).onChange(_=>{this.fileName=_}),s.inputEl.focus(),s.inputEl.select(),s.inputEl.addEventListener("keydown",_=>{_.key==="Enter"&&this.createFile()})});let n=e.createDiv("modal-button-container");n.createEl("button",{text:"Cancel"}).addEventListener("click",()=>{this.close()}),n.createEl("button",{text:"Create",cls:"mod-cta"}).addEventListener("click",()=>{this.createFile()})}async createFile(){if(!this.fileName.trim()){new H.Notice("Please enter a file name");return}try{let e=this.fileName.trim(),n=(0,H.normalizePath)(`${e}.typ`),i=this.app.vault.getAbstractFileByPath(n);if(i&&i instanceof H.TFile){new H.Notice("File already exists"),this.app.workspace.getLeaf(!0).openFile(i),this.close();return}let o=await this.app.vault.create(n,"",{});this.app.workspace.getLeaf(!0).openFile(o),this.close()}catch(e){console.error("Error creating Typst file:",e),new H.Notice("Error creating file")}}onClose(){let{contentEl:e}=this;e.empty()}};function _n(r){r.addCommand({id:"create-typst-file",name:"Create new Typst file",callback:()=>{new ie(r.app,r).open()}}),r.addCommand({id:"toggle-typst-mode",name:"Toggle between source and reading mode",checkCallback:t=>{let e=r.app.workspace.getActiveViewOfType(at);if(e instanceof at){if(!t){e.toggleMode();let n=e.getCurrentMode()}return!0}return t||new an.Notice("Must be in a Typst (.typ) file"),!1}})}var cn='<svg xmlns="http://www.w3.org/2000/svg" xml:space="preserve" viewBox="0 0 700 700"><path d="M367.7 477.4c0 25.2 3.6 42.1 10.9 50.7 7.3 8.6 20.7 12.9 40.2 12.9 19.5 0 44.9-9.9 76-29.8l19.9 32.8c-58.3 48.4-106.3 72.5-144.1 72.5s-67.6-9.1-89.4-27.3c-21.9-18.2-32.8-50.5-32.8-96.9V232h-49.7l-8-36.8 57.6-17.9v-48.7L367.5 74v109.3l117.2-8.9L474 239l-106.3-4v242.4z" fill="currentColor"/></svg>';var oe=class extends se.Plugin{async onload(){(0,se.addIcon)("typst-file",cn),this.registerExtensions(["typ"],"typst-view"),this.registerView("typst-view",t=>new at(t)),_n(this)}onunload(){}};
